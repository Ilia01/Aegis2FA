{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"2FA Authentication Service","text":"<p>Deploy with $0/month</p> <p>Use TOTP 2FA (Google Authenticator) with absolutely no external services required!</p>"},{"location":"#what-is-this","title":"What is this?","text":"<p>A production-ready Two-Factor Authentication service that you can integrate into your applications. Provides enterprise-grade 2FA capabilities via REST API with a showcase frontend for testing.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Multiple 2FA Methods: TOTP, SMS, Email, Backup Codes</li> <li>Trusted Devices: Skip 2FA on trusted devices for 30 days</li> <li>API Key Management: Secure third-party integration</li> <li>Webhook Support: Real-time event notifications</li> <li>Zero-Budget Option: Deploy for free with TOTP only</li> <li>Full Test Coverage: 80%+ test coverage with comprehensive test suite</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li> <p> Getting Started</p> <p>Get up and running in 5 minutes</p> <p> Quick Start</p> </li> <li> <p> API Reference</p> <p>Interactive API documentation with Swagger UI</p> <p> Explore API</p> </li> <li> <p> Deployment</p> <p>Deploy to production or cloud platforms</p> <p> Deployment Guide</p> </li> <li> <p> Integration Guide</p> <p>Learn how to integrate into your app</p> <p> Integration</p> </li> </ul>"},{"location":"#supported-2fa-methods","title":"Supported 2FA Methods","text":"TOTPSMSEmailBackup Codes <p>Time-based One-Time Password using Google Authenticator, Authy, or any TOTP app.</p> <p>Cost: Free (no external services)</p> <p>Setup Time: &lt; 1 minute</p> <p> TOTP Setup Guide</p> <p>Send verification codes via SMS using Twilio.</p> <p>Cost: Twilio charges apply</p> <p>Setup Time: 5-10 minutes</p> <p> SMS Setup Guide</p> <p>Send verification codes via email using any SMTP provider.</p> <p>Cost: Free (Gmail: 500 emails/day)</p> <p>Setup Time: 5 minutes</p> <p> Email Setup Guide</p> <p>One-time use recovery codes for account recovery.</p> <p>Cost: Free</p> <p>Included: Auto-generated on 2FA setup</p> <p> Learn More</p>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<pre><code>graph LR\n    A[Your App] --&gt;|REST API| B[2FA Backend]\n    B --&gt; C[PostgreSQL]\n    B --&gt; D[Redis]\n    B --&gt; E[Twilio]\n    B --&gt; F[SMTP]\n    G[Frontend Demo] -.-&gt;|Optional| B</code></pre> <p>Backend: Express.js + TypeScript + Prisma + Redis Frontend: Next.js 15 + Tailwind CSS Database: PostgreSQL + Redis Security: Argon2 hashing, JWT tokens, rate limiting</p> <p> Detailed Architecture</p>"},{"location":"#integration-approaches","title":"Integration Approaches","text":""},{"location":"#option-1-direct-api-integration-recommended","title":"Option 1: Direct API Integration (Recommended)","text":"<p>Integrate the 2FA service into your existing application by calling the REST API endpoints.</p> <pre><code># Start 2FA service\ndocker-compose up -d\n\n# Call from your app\ncurl -X POST http://localhost:3001/api/auth/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"user@example.com\",\"username\":\"user\",\"password\":\"SecurePass123!\"}'\n</code></pre> <p> API Integration Guide</p>"},{"location":"#option-2-sdk-integration-coming-soon","title":"Option 2: SDK Integration (Coming Soon)","text":"<p>Use our SDK to simplify integration (roadmap Phase 8).</p> <pre><code>import { TwoFactorAuth } from '@Ilia01/2fa-sdk';\n\nconst tfa = new TwoFactorAuth({ apiUrl: 'http://localhost:3001/api' });\nawait tfa.setupTOTP(userId);\n</code></pre>"},{"location":"#tech-stack","title":"Tech Stack","text":"BackendFrontendDevOps <ul> <li>Node.js 18+</li> <li>Express.js</li> <li>TypeScript</li> <li>PostgreSQL 14+ (Prisma ORM)</li> <li>Redis 6+</li> <li>Argon2 password hashing</li> <li>Speakeasy (TOTP)</li> <li>Twilio (SMS)</li> <li>Nodemailer (Email)</li> </ul> <ul> <li>Next.js 15 (App Router with Turbopack)</li> <li>TypeScript</li> <li>Tailwind CSS</li> <li>shadcn/ui Components</li> <li>Axios with interceptors</li> <li>QR code generation</li> </ul> <ul> <li>Docker &amp; Docker Compose</li> <li>GitHub Actions CI/CD</li> <li>Security scanning (CodeQL, Trivy, TruffleHog)</li> <li>Automated testing</li> <li>Health checks</li> <li>Monitoring ready</li> </ul>"},{"location":"#project-status","title":"Project Status","text":"<ul> <li> Phase 1-4: Backend API Service (User auth, TOTP, SMS, Email, Backup codes)</li> <li> Phase 5: Showcase Frontend (Next.js with dark theme, 2FA wizard)</li> <li> Phase 6: Service Enhancements (API keys, webhooks, health checks, Docker)</li> <li> Phase 7: Admin Dashboard (User management, audit logs, analytics)</li> <li> Phase 8: Client SDK (NPM package, React hooks, Python client)</li> </ul> <p> Full Roadmap</p>"},{"location":"#security","title":"Security","text":"<p>This service implements industry-standard security practices:</p> <ul> <li>\u2705 Argon2id password hashing</li> <li>\u2705 JWT authentication with refresh tokens</li> <li>\u2705 Rate limiting on all sensitive endpoints</li> <li>\u2705 CSRF protection</li> <li>\u2705 Helmet security headers</li> <li>\u2705 Input validation and sanitization</li> <li>\u2705 SQL injection prevention (parameterized queries)</li> <li>\u2705 Audit logging for security events</li> </ul> <p>Security Disclosure</p> <p>Found a security vulnerability? Please email security@example.com instead of opening a public issue.</p>"},{"location":"#community-support","title":"Community &amp; Support","text":"<ul> <li>Documentation: You're reading it!</li> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> <li>Contributing: Contributing Guide</li> </ul>"},{"location":"#license","title":"License","text":"<p>This project is licensed under the MIT License - see the LICENSE file for details.</p>   **Ready to get started?**  [Quick Start](getting-started/quick-start.md){ .md-button .md-button--primary } [View on GitHub](https://github.com/Ilia01/Aegis2FA){ .md-button }"},{"location":"INTEGRATION/","title":"2FA Service Integration Guide","text":"<p>Complete guide for integrating the 2FA Authentication Service into your application.</p>"},{"location":"INTEGRATION/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>Quick Start</li> <li>Docker Deployment</li> <li>API Key Authentication</li> <li>Integration Patterns</li> <li>Webhook Configuration</li> <li>Code Examples</li> <li>Security Best Practices</li> </ol>"},{"location":"INTEGRATION/#overview","title":"Overview","text":"<p>The 2FA Authentication Service is a standalone microservice that provides enterprise-grade two-factor authentication for your applications. It supports multiple 2FA methods (TOTP, SMS, Email) and can be integrated via REST API.</p>"},{"location":"INTEGRATION/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Your App       \u2502  &lt;\u2500\u2500\u2500&gt;   \u2502  2FA Service     \u2502\n\u2502  (Any Language) \u2502   REST   \u2502  (Docker/K8s)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   API    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                      \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502                \u2502\n                        PostgreSQL         Redis\n</code></pre>"},{"location":"INTEGRATION/#integration-methods","title":"Integration Methods","text":"<ol> <li>User Token Authentication: Your users log in directly to the 2FA service</li> <li>API Key Authentication: Your app makes requests on behalf of users (recommended for B2B)</li> <li>Webhook Events: Receive real-time notifications about 2FA events</li> </ol>"},{"location":"INTEGRATION/#quick-start","title":"Quick Start","text":""},{"location":"INTEGRATION/#1-deploy-the-service","title":"1. Deploy the Service","text":"<p>Using Docker Compose (recommended):</p> <pre><code># Clone the repository\ngit clone https://github.com/Ilia01/Aegis2FA-service.git\ncd 2fa-service\n\n# Create environment file\ncp .env.example .env\n\n# Generate secrets\nnode -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\n\n# Update .env with your secrets:\n# - JWT_ACCESS_SECRET\n# - JWT_REFRESH_SECRET\n# - DEVICE_TOKEN_SECRET\n# - POSTGRES_PASSWORD\n\n# Start the service\ndocker-compose up -d\n\n# Run database migrations\ndocker-compose exec backend npx prisma migrate deploy\n</code></pre> <p>The service will be available at <code>http://localhost:3001</code></p>"},{"location":"INTEGRATION/#2-create-a-user-account","title":"2. Create a User Account","text":"<pre><code>curl -X POST http://localhost:3001/api/auth/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"admin@yourapp.com\",\n    \"username\": \"admin\",\n    \"password\": \"SecurePassword123!\"\n  }'\n</code></pre>"},{"location":"INTEGRATION/#3-generate-api-key","title":"3. Generate API Key","text":"<pre><code># Login first\nLOGIN_RESPONSE=$(curl -X POST http://localhost:3001/api/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"emailOrUsername\": \"admin\", \"password\": \"SecurePassword123!\"}')\n\nACCESS_TOKEN=$(echo $LOGIN_RESPONSE | jq -r '.data.accessToken')\n\n# Create API key\ncurl -X POST http://localhost:3001/api/api-keys \\\n  -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Production App\",\n    \"scopes\": [\"2fa:read\", \"2fa:write\"],\n    \"rateLimit\": 5000\n  }'\n</code></pre> <p>Save the returned API key securely - it won't be shown again!</p>"},{"location":"INTEGRATION/#docker-deployment","title":"Docker Deployment","text":""},{"location":"INTEGRATION/#production-deployment","title":"Production Deployment","text":"<pre><code># Production deployment\ndocker-compose up -d\n\n# View logs\ndocker-compose logs -f backend\n\n# Scale workers\ndocker-compose up -d --scale worker=3\n</code></pre>"},{"location":"INTEGRATION/#development-mode","title":"Development Mode","text":"<pre><code># Development with hot-reload\ndocker-compose -f docker-compose.dev.yml up\n\n# Your code changes will auto-reload\n</code></pre>"},{"location":"INTEGRATION/#environment-variables","title":"Environment Variables","text":"<p>Required for production:</p> <pre><code># Database\nDATABASE_URL=postgresql://user:password@postgres:5432/db\n\n# Redis\nREDIS_HOST=redis\nREDIS_PORT=6379\n\n# JWT Secrets (generate with: node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\")\nJWT_ACCESS_SECRET=&lt;64-char-secret&gt;\nJWT_REFRESH_SECRET=&lt;64-char-secret&gt;\nDEVICE_TOKEN_SECRET=&lt;64-char-secret&gt;\n\n# CORS (comma-separated)\nCORS_ORIGINS=https://yourapp.com,https://admin.yourapp.com\n\n# Optional: Twilio (for SMS)\nTWILIO_ACCOUNT_SID=\nTWILIO_AUTH_TOKEN=\nTWILIO_PHONE_NUMBER=\n\n# Optional: Email (SMTP)\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\nEMAIL_USER=\nEMAIL_PASSWORD=\nEMAIL_FROM=noreply@yourapp.com\n</code></pre>"},{"location":"INTEGRATION/#api-key-authentication","title":"API Key Authentication","text":""},{"location":"INTEGRATION/#creating-api-keys","title":"Creating API Keys","text":"<p>API keys allow your application to interact with the 2FA service without requiring individual user login.</p> <pre><code>// Step 1: Create API key (one-time setup)\nconst response = await fetch('http://2fa-service:3001/api/api-keys', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${userAccessToken}`,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    name: 'Production App',\n    scopes: ['2fa:read', '2fa:write', 'webhooks:read', 'webhooks:write'],\n    rateLimit: 10000, // requests per hour\n    expiresAt: '2025-12-31T23:59:59Z' // optional\n  })\n});\n\nconst { apiKey } = await response.json();\n// Save apiKey securely (e.g., environment variable)\n</code></pre>"},{"location":"INTEGRATION/#using-api-keys","title":"Using API Keys","text":"<pre><code>// Use API key for subsequent requests\nconst response = await fetch('http://2fa-service:3001/api/2fa/totp/setup', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${apiKey}`, // or\n    'X-API-Key': apiKey,\n    'Content-Type': 'application/json'\n  }\n});\n</code></pre>"},{"location":"INTEGRATION/#available-scopes","title":"Available Scopes","text":"<ul> <li><code>*</code> - Full access (use cautiously)</li> <li><code>2fa:read</code> - View 2FA methods and status</li> <li><code>2fa:write</code> - Enable/disable 2FA methods</li> <li><code>user:read</code> - View user information</li> <li><code>webhooks:read</code> - View webhooks</li> <li><code>webhooks:write</code> - Create/update webhooks</li> </ul>"},{"location":"INTEGRATION/#integration-patterns","title":"Integration Patterns","text":""},{"location":"INTEGRATION/#pattern-1-proxy-integration-recommended","title":"Pattern 1: Proxy Integration (Recommended)","text":"<p>Your app acts as a proxy between users and the 2FA service.</p> <pre><code>// backend/routes/auth.js\napp.post('/api/auth/login', async (req, res) =&gt; {\n  const { email, password } = req.body;\n\n  // 1. Verify user in your database\n  const user = await db.users.findByEmail(email);\n  if (!user || !await bcrypt.compare(password, user.passwordHash)) {\n    return res.status(401).json({ error: 'Invalid credentials' });\n  }\n\n  // 2. Check if 2FA is enabled for this user\n  const twoFAResponse = await fetch('http://2fa-service:3001/api/2fa/methods', {\n    headers: { 'X-API-Key': process.env.TFA_API_KEY }\n  });\n\n  const { data: methods } = await twoFAResponse.json();\n  const has2FA = methods.length &gt; 0;\n\n  if (has2FA) {\n    // Return indication that 2FA is required\n    return res.json({\n      requiresTwoFactor: true,\n      userId: user.id,\n      // Don't send session token yet\n    });\n  }\n\n  // 3. No 2FA - create session\n  const sessionToken = createSession(user.id);\n  res.json({ sessionToken, user });\n});\n\napp.post('/api/auth/verify-2fa', async (req, res) =&gt; {\n  const { userId, code } = req.body;\n\n  // Verify code with 2FA service\n  const response = await fetch('http://2fa-service:3001/api/2fa/verify', {\n    method: 'POST',\n    headers: {\n      'X-API-Key': process.env.TFA_API_KEY,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ code, userId })\n  });\n\n  if (response.ok) {\n    const sessionToken = createSession(userId);\n    return res.json({ sessionToken });\n  }\n\n  res.status(401).json({ error: '2FA verification failed' });\n});\n</code></pre>"},{"location":"INTEGRATION/#pattern-2-direct-integration","title":"Pattern 2: Direct Integration","text":"<p>Users interact directly with the 2FA service.</p> <pre><code>// frontend/auth.js\nasync function login(email, password) {\n  // Step 1: Login to 2FA service\n  const response = await fetch('http://2fa-service:3001/api/auth/login', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ emailOrUsername: email, password })\n  });\n\n  const data = await response.json();\n\n  if (data.requiresTwoFactor) {\n    // Step 2: Prompt for 2FA code\n    const code = await prompt2FA();\n\n    // Step 3: Verify 2FA\n    const verifyResponse = await fetch('http://2fa-service:3001/api/2fa/verify', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        tempToken: data.tempToken,\n        code\n      })\n    });\n\n    const verifyData = await verifyResponse.json();\n    return verifyData.accessToken;\n  }\n\n  return data.accessToken;\n}\n</code></pre>"},{"location":"INTEGRATION/#webhook-configuration","title":"Webhook Configuration","text":"<p>Webhooks notify your application about 2FA events in real-time.</p>"},{"location":"INTEGRATION/#1-create-webhook-endpoint","title":"1. Create Webhook Endpoint","text":"<pre><code>// backend/webhooks/2fa.js\napp.post('/webhooks/2fa', (req, res) =&gt; {\n  const signature = req.headers['x-webhook-signature'];\n  const event = req.headers['x-webhook-event'];\n  const payload = JSON.stringify(req.body);\n\n  // Verify signature\n  const crypto = require('crypto');\n  const expectedSignature = crypto\n    .createHmac('sha256', process.env.WEBHOOK_SECRET)\n    .update(payload)\n    .digest('hex');\n\n  if (signature !== expectedSignature) {\n    return res.status(401).json({ error: 'Invalid signature' });\n  }\n\n  // Handle events\n  switch (event) {\n    case '2fa.enabled':\n      console.log(`User ${req.body.data.userId} enabled 2FA`);\n      // Update your database, send notification, etc.\n      break;\n\n    case '2fa.verified':\n      console.log(`User ${req.body.data.userId} verified 2FA`);\n      break;\n\n    case '2fa.failed':\n      console.log(`User ${req.body.data.userId} failed 2FA attempt`);\n      // Track failed attempts, lock account after X failures\n      break;\n  }\n\n  res.json({ success: true });\n});\n</code></pre>"},{"location":"INTEGRATION/#2-register-webhook","title":"2. Register Webhook","text":"<pre><code>curl -X POST http://localhost:3001/api/webhooks \\\n  -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"url\": \"https://yourapp.com/webhooks/2fa\",\n    \"events\": [\"2fa.enabled\", \"2fa.verified\", \"2fa.failed\"]\n  }'\n</code></pre> <p>Save the webhook secret returned - you need it to verify signatures!</p>"},{"location":"INTEGRATION/#3-test-webhook","title":"3. Test Webhook","text":"<pre><code>curl -X POST http://localhost:3001/api/webhooks/{webhookId}/test \\\n  -H \"Authorization: Bearer $ACCESS_TOKEN\"\n</code></pre>"},{"location":"INTEGRATION/#supported-events","title":"Supported Events","text":"<ul> <li><code>2fa.enabled</code> - User enables 2FA</li> <li><code>2fa.disabled</code> - User disables 2FA</li> <li><code>2fa.verified</code> - 2FA code verified successfully</li> <li><code>2fa.failed</code> - 2FA verification failed</li> <li><code>user.login</code> - User logged in</li> <li><code>user.logout</code> - User logged out</li> </ul>"},{"location":"INTEGRATION/#code-examples","title":"Code Examples","text":""},{"location":"INTEGRATION/#nodejsexpress","title":"Node.js/Express","text":"<pre><code>const axios = require('axios');\n\nclass TwoFactorAuthClient {\n  constructor(apiKey, baseURL = 'http://localhost:3001/api') {\n    this.client = axios.create({\n      baseURL,\n      headers: { 'X-API-Key': apiKey }\n    });\n  }\n\n  async setupTOTP(userId) {\n    const response = await this.client.post('/2fa/totp/setup', { userId });\n    return response.data; // Returns QR code and secret\n  }\n\n  async verifyTOTP(userId, code) {\n    const response = await this.client.post('/2fa/totp/verify-setup', {\n      userId,\n      code\n    });\n    return response.data; // Returns backup codes\n  }\n\n  async verify2FA(tempToken, code) {\n    const response = await this.client.post('/2fa/verify', {\n      tempToken,\n      code\n    });\n    return response.data; // Returns access token\n  }\n}\n\n// Usage\nconst tfaClient = new TwoFactorAuthClient(process.env.TFA_API_KEY);\nconst { qrCode, secret } = await tfaClient.setupTOTP('user-id');\n</code></pre>"},{"location":"INTEGRATION/#python","title":"Python","text":"<pre><code>import requests\nimport hmac\nimport hashlib\n\nclass TwoFactorAuthClient:\n    def __init__(self, api_key, base_url='http://localhost:3001/api'):\n        self.api_key = api_key\n        self.base_url = base_url\n\n    def _headers(self):\n        return {'X-API-Key': self.api_key, 'Content-Type': 'application/json'}\n\n    def setup_totp(self, user_id):\n        response = requests.post(\n            f'{self.base_url}/2fa/totp/setup',\n            json={'userId': user_id},\n            headers=self._headers()\n        )\n        return response.json()\n\n    def verify_2fa(self, temp_token, code):\n        response = requests.post(\n            f'{self.base_url}/2fa/verify',\n            json={'tempToken': temp_token, 'code': code},\n            headers=self._headers()\n        )\n        return response.json()\n\n# Usage\nclient = TwoFactorAuthClient(os.getenv('TFA_API_KEY'))\nresult = client.setup_totp('user-id')\nprint(f\"QR Code: {result['data']['qrCode']}\")\n</code></pre>"},{"location":"INTEGRATION/#curl","title":"cURL","text":"<pre><code># Setup TOTP\ncurl -X POST http://localhost:3001/api/2fa/totp/setup \\\n  -H \"X-API-Key: $TFA_API_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"userId\": \"user-123\"}'\n\n# Verify 2FA\ncurl -X POST http://localhost:3001/api/2fa/verify \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"tempToken\": \"...\",\n    \"code\": \"123456\"\n  }'\n</code></pre>"},{"location":"INTEGRATION/#security-best-practices","title":"Security Best Practices","text":""},{"location":"INTEGRATION/#1-api-key-management","title":"1. API Key Management","text":"<ul> <li>Store API keys in environment variables or secret managers (AWS Secrets Manager, HashiCorp Vault)</li> <li>Use different keys for development, staging, and production</li> <li>Rotate keys regularly (use the <code>/api-keys/{id}/rotate</code> endpoint)</li> <li>Set appropriate scopes (principle of least privilege)</li> <li>Monitor API key usage and set rate limits</li> </ul>"},{"location":"INTEGRATION/#2-network-security","title":"2. Network Security","text":"<ul> <li>Run 2FA service in private network (not publicly accessible)</li> <li>Use API gateway or reverse proxy for external access</li> <li>Enable HTTPS/TLS for all traffic</li> <li>Whitelist IP addresses if possible</li> </ul>"},{"location":"INTEGRATION/#3-webhook-security","title":"3. Webhook Security","text":"<ul> <li>Always verify webhook signatures</li> <li>Use HTTPS endpoints for webhooks</li> <li>Implement idempotency (webhooks may be retried)</li> <li>Log all webhook deliveries for audit</li> </ul>"},{"location":"INTEGRATION/#4-database-security","title":"4. Database Security","text":"<ul> <li>Use strong PostgreSQL passwords</li> <li>Enable connection encryption</li> <li>Regular backups</li> <li>Limit database user permissions</li> </ul>"},{"location":"INTEGRATION/#5-monitoring","title":"5. Monitoring","text":"<ul> <li>Monitor health endpoints: <code>/api/health</code></li> <li>Track failed 2FA attempts</li> <li>Alert on webhook delivery failures</li> <li>Monitor API key usage patterns</li> </ul>"},{"location":"INTEGRATION/#health-checks","title":"Health Checks","text":""},{"location":"INTEGRATION/#endpoints","title":"Endpoints","text":"<ul> <li><code>GET /api/health</code> - Comprehensive health check (database, Redis, memory)</li> <li><code>GET /api/health/live</code> - Liveness probe (for Kubernetes)</li> <li><code>GET /api/health/ready</code> - Readiness probe (for load balancers)</li> </ul>"},{"location":"INTEGRATION/#example-response","title":"Example Response","text":"<pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2024-10-18T19:00:00.000Z\",\n  \"service\": \"2FA Authentication Service\",\n  \"version\": \"1.0.0\",\n  \"uptime\": 3600,\n  \"checks\": {\n    \"database\": {\n      \"status\": \"up\",\n      \"responseTime\": 5\n    },\n    \"redis\": {\n      \"status\": \"up\",\n      \"responseTime\": 2\n    },\n    \"memory\": {\n      \"status\": \"up\",\n      \"heapUsed\": 150,\n      \"heapTotal\": 200\n    }\n  }\n}\n</code></pre>"},{"location":"INTEGRATION/#support","title":"Support","text":"<ul> <li>GitHub Issues: https://github.com/Ilia01/Aegis2FA-service/issues</li> <li>Documentation: https://docs.yourservice.com</li> <li>Email: support@yourservice.com</li> </ul>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to this project will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"changelog/#unreleased","title":"Unreleased","text":""},{"location":"changelog/#planned-features","title":"Planned Features","text":"<ul> <li>Admin dashboard for user management</li> <li>Client SDK (JavaScript/TypeScript)</li> <li>Python client library</li> <li>Multi-tenancy support</li> <li>Advanced analytics</li> </ul>"},{"location":"changelog/#100-2024-10-19","title":"1.0.0 - 2024-10-19","text":""},{"location":"changelog/#added-core-features","title":"Added - Core Features","text":""},{"location":"changelog/#backend-api-service","title":"Backend API Service","text":"<ul> <li>User registration with email/username validation</li> <li>JWT-based authentication (access + refresh tokens)</li> <li>Session management with Redis</li> <li>Argon2id password hashing with worker pool optimization</li> <li>Rate limiting on all sensitive endpoints</li> <li>Comprehensive health check endpoints (liveness, readiness)</li> <li>Audit logging for security events</li> </ul>"},{"location":"changelog/#two-factor-authentication","title":"Two-Factor Authentication","text":"<ul> <li>TOTP (Time-based One-Time Password)</li> <li>QR code generation for Google Authenticator/Authy</li> <li>30-second time window with drift tolerance</li> <li>Backup code generation (10 one-time use codes)</li> <li>SMS 2FA via Twilio integration</li> <li>Email 2FA via SMTP/Nodemailer</li> <li>Trusted Devices (30-day device memory)</li> <li>2FA method management (enable, disable, list)</li> </ul>"},{"location":"changelog/#third-party-integration","title":"Third-Party Integration","text":"<ul> <li>API key management with scoped permissions</li> <li>API key rotation and revocation</li> <li>Webhook system with HMAC signatures</li> <li>Event notifications (2FA enabled/verified/failed)</li> <li>Webhook delivery tracking</li> </ul>"},{"location":"changelog/#frontend-showcase","title":"Frontend Showcase","text":"<ul> <li>Next.js 15 with App Router and Turbopack</li> <li>Dark mode optimized UI with Tailwind CSS</li> <li>Complete 2FA setup wizard</li> <li>TOTP QR code display</li> <li>Backup codes generation</li> <li>Trusted device management</li> <li>User dashboard and settings</li> </ul>"},{"location":"changelog/#testing-quality","title":"Testing &amp; Quality","text":"<ul> <li>186 total tests (unit + E2E)</li> <li>80%+ test coverage</li> <li>PostgreSQL + Redis test services</li> <li>Stress testing suite (500 concurrent users)</li> </ul>"},{"location":"changelog/#devops-cicd","title":"DevOps &amp; CI/CD","text":"<ul> <li>Docker &amp; Docker Compose for production</li> <li>Development containers with hot-reload</li> <li>GitHub Actions CI/CD pipelines</li> <li>Backend tests with PostgreSQL/Redis services</li> <li>Frontend build and type checking</li> <li>Security scanning (CodeQL, Trivy, TruffleHog)</li> <li>Automated deployment to production</li> <li>Comprehensive deployment guides</li> <li>Zero-budget deployment documentation</li> </ul>"},{"location":"changelog/#documentation","title":"Documentation","text":"<ul> <li>Complete API documentation</li> <li>Integration guides</li> <li>Deployment guides (Docker, cloud platforms)</li> <li>Contributing guidelines</li> <li>Zero-budget deployment guide</li> </ul>"},{"location":"changelog/#security","title":"Security","text":"<ul> <li>CSRF protection</li> <li>Helmet security headers</li> <li>Input validation and sanitization</li> <li>SQL injection prevention (parameterized queries)</li> <li>Rate limiting</li> <li>Secure session management</li> <li>HTTP-only cookies for refresh tokens</li> </ul>"},{"location":"changelog/#infrastructure","title":"Infrastructure","text":"<ul> <li>PostgreSQL 14+ database with Prisma ORM</li> <li>Redis 6+ for OTP storage and caching</li> <li>BullMQ for async job processing</li> <li>Piscina worker pool for CPU-intensive operations</li> </ul>"},{"location":"changelog/#development-phases","title":"Development Phases","text":""},{"location":"changelog/#phase-1-4-backend-foundation-complete","title":"Phase 1-4: Backend Foundation (Complete)","text":"<ul> <li>User authentication system</li> <li>Password hashing and validation</li> <li>JWT token management</li> <li>Database schema and migrations</li> </ul>"},{"location":"changelog/#phase-5-showcase-frontend-complete","title":"Phase 5: Showcase Frontend (Complete)","text":"<ul> <li>Next.js application</li> <li>2FA setup workflows</li> <li>User dashboard</li> <li>Settings management</li> </ul>"},{"location":"changelog/#phase-6-service-enhancements-complete","title":"Phase 6: Service Enhancements (Complete)","text":"<ul> <li>API key management</li> <li>Webhook system</li> <li>Health monitoring</li> <li>Docker deployment</li> <li>CI/CD pipelines</li> <li>Comprehensive documentation</li> </ul>"},{"location":"changelog/#phase-7-admin-dashboard-planned","title":"Phase 7: Admin Dashboard (Planned)","text":"<ul> <li>User management API</li> <li>Audit logs viewer</li> <li>Analytics and metrics</li> <li>Usage monitoring</li> </ul>"},{"location":"changelog/#phase-8-client-sdk-planned","title":"Phase 8: Client SDK (Planned)","text":"<ul> <li>NPM package (@Ilia01/2fa-sdk)</li> <li>React hooks library</li> <li>Python client</li> <li>Integration examples</li> </ul>"},{"location":"changelog/#migration-guide","title":"Migration Guide","text":""},{"location":"changelog/#from-development-to-v10","title":"From Development to v1.0","text":"<ol> <li>Update environment variables:</li> <li>Ensure all JWT secrets are set (64+ characters)</li> <li>Configure production DATABASE_URL</li> <li> <p>Set CORS_ORIGINS for your domain</p> </li> <li> <p>Run database migrations:    <pre><code>npx prisma migrate deploy\n</code></pre></p> </li> <li> <p>Update Docker images:    <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre></p> </li> <li> <p>Verify deployment:    <pre><code>curl https://your-api.com/api/health\n</code></pre></p> </li> </ol>"},{"location":"changelog/#breaking-changes","title":"Breaking Changes","text":"<p>None - this is the initial release.</p>"},{"location":"changelog/#known-issues","title":"Known Issues","text":""},{"location":"changelog/#free-tier-limitations","title":"Free Tier Limitations","text":"<ul> <li>Free PostgreSQL databases may have connection limits (20-100)</li> <li>Redis free tier limited to 10MB (Upstash)</li> <li>Free hosting may have cold start delays</li> </ul>"},{"location":"changelog/#sms-2fa","title":"SMS 2FA","text":"<ul> <li>Requires paid Twilio account</li> <li>Not available on zero-budget deployment</li> </ul>"},{"location":"changelog/#contributors","title":"Contributors","text":"<p>Thanks to all contributors who helped build this project!</p> <ul> <li>Project initialization and architecture</li> <li>Backend API implementation</li> <li>Frontend showcase application</li> <li>Documentation and guides</li> <li>Testing and quality assurance</li> </ul>"},{"location":"changelog/#support","title":"Support","text":"<ul> <li>Documentation: https://Ilia01.github.io/Aegis2FA</li> <li>GitHub Issues: https://github.com/Ilia01/Aegis2FA/issues</li> <li>Discussions: https://github.com/Ilia01/Aegis2FA/discussions</li> <li>Security: security@example.com</li> </ul>"},{"location":"faq/","title":"Frequently Asked Questions","text":""},{"location":"faq/#general-questions","title":"General Questions","text":""},{"location":"faq/#what-is-this-service","title":"What is this service?","text":"<p>A production-ready Two-Factor Authentication service that you can self-host and integrate into your applications. It provides enterprise-grade 2FA capabilities via REST API.</p>"},{"location":"faq/#is-it-really-free","title":"Is it really free?","text":"<p>Yes! With TOTP 2FA (Google Authenticator), you can deploy and run this service with $0/month using free hosting tiers. See our Zero-Budget Deployment Guide.</p>"},{"location":"faq/#can-i-use-this-in-production","title":"Can I use this in production?","text":"<p>Absolutely! The service includes: - \u2705 80%+ test coverage - \u2705 Security best practices (Argon2, rate limiting, CSRF protection) - \u2705 Health checks and monitoring - \u2705 Docker deployment - \u2705 CI/CD pipelines</p> <p>However, for mission-critical applications, consider using paid tiers for better reliability.</p>"},{"location":"faq/#what-2fa-methods-are-supported","title":"What 2FA methods are supported?","text":"<ul> <li>TOTP (Google Authenticator, Authy) - Free</li> <li>SMS (via Twilio) - Paid</li> <li>Email (via SMTP) - Free with Gmail (500/day limit)</li> <li>Backup Codes - Free</li> <li>Trusted Devices - Free</li> </ul>"},{"location":"faq/#setup-installation","title":"Setup &amp; Installation","text":""},{"location":"faq/#how-long-does-setup-take","title":"How long does setup take?","text":"<ul> <li>Docker (local): 5 minutes</li> <li>Zero-budget deployment: 15-30 minutes</li> <li>Production deployment: 1-2 hours</li> </ul> <p>Follow our Quick Start Guide.</p>"},{"location":"faq/#do-i-need-a-database","title":"Do I need a database?","text":"<p>Yes, PostgreSQL 14+ is required. Free options: - Supabase (500MB free) - Railway (512MB free) - Neon (3GB free)</p>"},{"location":"faq/#do-i-need-redis","title":"Do I need Redis?","text":"<p>Yes, Redis 6+ is required for OTP storage and rate limiting. Free options: - Upstash (10MB free) - Redis Cloud (30MB free)</p>"},{"location":"faq/#can-i-run-this-without-docker","title":"Can I run this without Docker?","text":"<p>Yes! See the manual installation guide.</p>"},{"location":"faq/#totp-google-authenticator","title":"TOTP (Google Authenticator)","text":""},{"location":"faq/#how-does-totp-work","title":"How does TOTP work?","text":"<p>TOTP generates time-based one-time passwords that change every 30 seconds. It works completely offline - no internet connection needed after setup.</p>"},{"location":"faq/#which-authenticator-apps-are-supported","title":"Which authenticator apps are supported?","text":"<p>Any TOTP-compatible app: - Google Authenticator - Authy - Microsoft Authenticator - 1Password - Bitwarden</p>"},{"location":"faq/#what-if-i-lose-my-authenticator-device","title":"What if I lose my authenticator device?","text":"<p>Use your backup codes! You receive 10 one-time use backup codes when setting up 2FA. Store them securely.</p>"},{"location":"faq/#can-i-have-multiple-authenticator-apps","title":"Can I have multiple authenticator apps?","text":"<p>Yes! The same QR code can be scanned by multiple devices. Or use backup codes as a fallback.</p>"},{"location":"faq/#sms-2fa","title":"SMS 2FA","text":""},{"location":"faq/#how-much-does-sms-cost","title":"How much does SMS cost?","text":"<p>SMS 2FA requires a Twilio account (~$0.0075 per SMS). Not included in free tier.</p>"},{"location":"faq/#which-countries-are-supported-for-sms","title":"Which countries are supported for SMS?","text":"<p>Twilio supports 200+ countries. Check Twilio's SMS coverage.</p>"},{"location":"faq/#can-i-use-a-different-sms-provider","title":"Can I use a different SMS provider?","text":"<p>Currently only Twilio is supported. Other providers (AWS SNS, etc.) are on the roadmap.</p>"},{"location":"faq/#email-2fa","title":"Email 2FA","text":""},{"location":"faq/#can-i-use-gmail-for-free","title":"Can I use Gmail for free?","text":"<p>Yes! Gmail allows 500 emails/day on the free tier. Perfect for small applications.</p>"},{"location":"faq/#how-do-i-setup-gmail-for-email-2fa","title":"How do I setup Gmail for Email 2FA?","text":"<ol> <li>Enable 2-Step Verification on your Google account</li> <li>Generate an App Password</li> <li>Add to environment variables</li> </ol> <p>See Email Setup Guide.</p>"},{"location":"faq/#what-other-email-providers-are-supported","title":"What other email providers are supported?","text":"<p>Any SMTP server: - Gmail (500 emails/day free) - SendGrid (100 emails/day free) - Mailgun (5,000 emails/month free) - Custom SMTP server</p>"},{"location":"faq/#integration","title":"Integration","text":""},{"location":"faq/#how-do-i-integrate-this-into-my-app","title":"How do I integrate this into my app?","text":"<p>Three main approaches:</p> <ol> <li>REST API (recommended) - Call endpoints from your app</li> <li>SDK (coming soon) - Use our JavaScript/Python SDK</li> <li>Embed (future) - Embed UI components</li> </ol> <p>See Integration Guide.</p>"},{"location":"faq/#can-i-customize-the-frontend","title":"Can I customize the frontend?","text":"<p>Yes! The included frontend is just a demo. You can: - Use it as-is for testing - Customize it for your brand - Build your own frontend - Integrate directly into your existing UI</p>"},{"location":"faq/#does-it-work-with-nextjs-react-vue","title":"Does it work with Next.js / React / Vue?","text":"<p>Yes! It's a REST API, so it works with any frontend framework or language.</p>"},{"location":"faq/#can-i-use-this-with-mobile-apps","title":"Can I use this with mobile apps?","text":"<p>Yes! The REST API works with: - iOS (Swift) - Android (Kotlin/Java) - React Native - Flutter - Any language that can make HTTP requests</p>"},{"location":"faq/#api-keys-webhooks","title":"API Keys &amp; Webhooks","text":""},{"location":"faq/#what-are-api-keys-for","title":"What are API keys for?","text":"<p>API keys allow third-party services to integrate with your 2FA service. Features: - Scoped permissions - Rate limiting per key - Key rotation - Revocation</p> <p>See API Keys Guide.</p>"},{"location":"faq/#how-do-webhooks-work","title":"How do webhooks work?","text":"<p>Webhooks notify your app of events in real-time: - User enabled 2FA - 2FA verified successfully - 2FA verification failed</p> <p>See Webhooks Guide.</p>"},{"location":"faq/#are-webhooks-secure","title":"Are webhooks secure?","text":"<p>Yes! All webhook requests include an HMAC signature that you can verify.</p>"},{"location":"faq/#security","title":"Security","text":""},{"location":"faq/#how-are-passwords-stored","title":"How are passwords stored?","text":"<p>Passwords are hashed using Argon2id (winner of the Password Hashing Competition), the most secure password hashing algorithm available.</p>"},{"location":"faq/#are-2fa-codes-stored","title":"Are 2FA codes stored?","text":"<p>OTP codes are stored temporarily in Redis with expiration (default: 5 minutes). They are never stored in the database.</p>"},{"location":"faq/#how-long-do-jwt-tokens-last","title":"How long do JWT tokens last?","text":"<ul> <li>Access token: 15 minutes</li> <li>Refresh token: 7 days</li> <li>Temp token (for 2FA): 5 minutes</li> <li>Device token (trusted devices): 30 days</li> </ul>"},{"location":"faq/#is-rate-limiting-enabled","title":"Is rate limiting enabled?","text":"<p>Yes! All endpoints are rate-limited: - Login/Register: 5 requests / 15 minutes - 2FA verification: 10 requests / 15 minutes - Other endpoints: 100 requests / 15 minutes</p>"},{"location":"faq/#what-about-sql-injection-xss","title":"What about SQL injection / XSS?","text":"<p>Protected: - \u2705 Parameterized queries (Prisma ORM) - \u2705 Input validation and sanitization - \u2705 CSRF protection - \u2705 Helmet security headers - \u2705 Content Security Policy</p>"},{"location":"faq/#deployment","title":"Deployment","text":""},{"location":"faq/#where-can-i-deploy-this","title":"Where can I deploy this?","text":"<p>Free options: - Railway (500 hours/month) - Render (750 hours/month) - Fly.io (3 VMs free)</p> <p>Paid options: - AWS (EC2, ECS, Fargate) - Google Cloud (Cloud Run, GKE) - Azure (Container Instances, AKS) - Your own server</p> <p>See Deployment Guide.</p>"},{"location":"faq/#do-i-need-a-domain-name","title":"Do I need a domain name?","text":"<p>Not required, but recommended for production. You can use: - Provider's subdomain (e.g., your-app.railway.app) - Your own domain with custom SSL</p>"},{"location":"faq/#how-do-i-setup-https","title":"How do I setup HTTPS?","text":"<p>See SSL Setup Guide. Free options: - Let's Encrypt (free SSL certificates) - Cloudflare (free SSL + CDN)</p>"},{"location":"faq/#can-i-scale-horizontally","title":"Can I scale horizontally?","text":"<p>Yes! You can run multiple backend instances behind a load balancer. See Scaling Guide.</p>"},{"location":"faq/#troubleshooting","title":"Troubleshooting","text":""},{"location":"faq/#database-connection-errors","title":"Database connection errors","text":"<p>Check: 1. PostgreSQL is running 2. DATABASE_URL is correct 3. Database exists and is accessible 4. Connection pool limit not exceeded</p>"},{"location":"faq/#redis-connection-errors","title":"Redis connection errors","text":"<p>Check: 1. Redis is running 2. REDIS_HOST and REDIS_PORT are correct 3. Redis password (if required) 4. Firewall rules</p>"},{"location":"faq/#invalid-totp-code-errors","title":"\"Invalid TOTP code\" errors","text":"<p>Common causes: - Time sync issue (check device time) - Wrong secret used - Code expired (30-second window) - Rate limit exceeded</p>"},{"location":"faq/#port-already-in-use","title":"Port already in use","text":"<p>Change ports in <code>docker-compose.yml</code>:</p> <pre><code>backend:\n  ports:\n    - \"3002:3001\"  # Changed from 3001\n</code></pre>"},{"location":"faq/#tests-failing","title":"Tests failing","text":"<p>Ensure: 1. PostgreSQL test database exists 2. Redis is running 3. Run <code>npx prisma migrate deploy</code> first 4. No other services using test ports</p>"},{"location":"faq/#performance","title":"Performance","text":""},{"location":"faq/#how-many-users-can-it-handle","title":"How many users can it handle?","text":"<p>Depends on your infrastructure: - Free tier: 100-500 users - \\(10/month server**: 1,000-5,000 users - **\\)50/month server: 10,000+ users</p> <p>With proper caching and optimization, it can scale to millions of users.</p>"},{"location":"faq/#whats-the-latency","title":"What's the latency?","text":"<p>Typical response times: - Login: 100-300ms (Argon2 hashing) - TOTP verification: 10-50ms - SMS/Email delivery: 1-5 seconds - Other endpoints: &lt; 50ms</p>"},{"location":"faq/#can-i-improve-performance","title":"Can I improve performance?","text":"<p>Yes! See Performance Guide: - Increase worker pool size - Add Redis caching - Use connection pooling - Enable HTTP/2 - Add CDN</p>"},{"location":"faq/#contributing","title":"Contributing","text":""},{"location":"faq/#how-can-i-contribute","title":"How can I contribute?","text":"<p>See Contributing Guide. We welcome: - Bug reports - Feature requests - Documentation improvements - Code contributions - Security reports</p>"},{"location":"faq/#i-found-a-security-vulnerability","title":"I found a security vulnerability","text":"<p>Please email security@example.com instead of opening a public issue. We'll respond within 48 hours.</p>"},{"location":"faq/#can-i-fork-this-project","title":"Can I fork this project?","text":"<p>Yes! It's MIT licensed. You can: - Use it commercially - Modify it - Distribute it - Use it privately</p> <p>Just include the original license.</p>"},{"location":"faq/#still-have-questions","title":"Still Have Questions?","text":"<ul> <li>GitHub Discussions: Ask the community</li> <li>GitHub Issues: Report bugs</li> <li>Email: support@example.com</li> </ul>"},{"location":"api/","title":"Interactive API Documentation","text":"<p>Try it out!</p> <p>This page provides interactive API documentation. You can test all endpoints directly in your browser!</p>"},{"location":"api/#quick-start","title":"Quick Start","text":"<ol> <li>Obtain an access token: Call <code>/auth/register</code> or <code>/auth/login</code></li> <li>Authorize: Click the \"Authorize\" button below and paste your token</li> <li>Try endpoints: Click \"Try it out\" on any endpoint to test it</li> </ol>"},{"location":"api/#authentication","title":"Authentication","text":"<p>Most endpoints require a JWT Bearer token. Include it in the <code>Authorization</code> header:</p> <pre><code>Authorization: Bearer &lt;your_access_token&gt;\n</code></pre>"},{"location":"api/#swagger-ui","title":"Swagger UI","text":""},{"location":"api/#need-help","title":"Need Help?","text":"<ul> <li>Authentication Guide - Detailed auth flow documentation</li> <li>Two-Factor Auth Guide - 2FA setup and verification</li> <li>Integration Examples - Code examples for common scenarios</li> <li>Error Codes - Complete error reference</li> </ul>"},{"location":"api/#rate-limiting","title":"Rate Limiting","text":"<p>All API endpoints are rate-limited to prevent abuse:</p> Endpoint Limit Default 100 requests / 15 minutes Login/Register 5 requests / 15 minutes 2FA Verification 10 requests / 15 minutes <p>Exceeding the rate limit returns HTTP 429 (Too Many Requests).</p>"},{"location":"api/#response-format","title":"Response Format","text":"<p>All responses follow this format:</p>"},{"location":"api/#success-response","title":"Success Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    // Response data here\n  }\n}\n</code></pre>"},{"location":"api/#error-response","title":"Error Response","text":"<pre><code>{\n  \"success\": false,\n  \"error\": \"Error message here\"\n}\n</code></pre>"},{"location":"api/#common-http-status-codes","title":"Common HTTP Status Codes","text":"Code Meaning Description 200 OK Request successful 201 Created Resource created successfully 400 Bad Request Validation error or invalid input 401 Unauthorized Missing or invalid authentication token 403 Forbidden Valid token but insufficient permissions 404 Not Found Resource not found 409 Conflict Resource already exists (e.g., duplicate email) 429 Too Many Requests Rate limit exceeded 500 Internal Server Error Server error (check logs) 503 Service Unavailable Service is down or unhealthy"},{"location":"api/authentication/","title":"Authentication API","text":"<p>Complete guide to authentication endpoints.</p>"},{"location":"api/authentication/#register","title":"Register","text":"<p>Create a new user account.</p>"},{"location":"api/authentication/#request","title":"Request","text":"<pre><code>POST /auth/register\nContent-Type: application/json\n\n{\n  \"email\": \"user@example.com\",\n  \"username\": \"johndoe\",\n  \"password\": \"SecureP@ssw0rd123!\"\n}\n</code></pre>"},{"location":"api/authentication/#response","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"user\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"email\": \"user@example.com\",\n      \"username\": \"johndoe\",\n      \"emailVerified\": false,\n      \"twoFactorEnabled\": false,\n      \"createdAt\": \"2024-10-19T12:00:00.000Z\",\n      \"updatedAt\": \"2024-10-19T12:00:00.000Z\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/authentication/#errors","title":"Errors","text":"Status Error Description 400 Validation error Invalid email, username, or password format 409 Email already registered Account exists with this email 409 Username already taken Account exists with this username 429 Too many requests Rate limit exceeded (5 requests / 15 min)"},{"location":"api/authentication/#password-requirements","title":"Password Requirements","text":"<ul> <li>Minimum 8 characters</li> <li>At least one uppercase letter</li> <li>At least one lowercase letter</li> <li>At least one number</li> <li>At least one special character</li> </ul>"},{"location":"api/authentication/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>Limit: 5 requests per 15 minutes</li> <li>Identifier: IP address</li> </ul>"},{"location":"api/authentication/#login","title":"Login","text":"<p>Authenticate a user and obtain tokens.</p>"},{"location":"api/authentication/#without-2fa","title":"Without 2FA","text":"<pre><code>POST /auth/login\nContent-Type: application/json\n\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecureP@ssw0rd123!\"\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n  }\n}\n</code></pre>"},{"location":"api/authentication/#with-2fa-enabled","title":"With 2FA Enabled","text":"<pre><code>POST /auth/login\nContent-Type: application/json\n\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecureP@ssw0rd123!\",\n  \"deviceToken\": \"optional_device_token_if_trusted\"\n}\n</code></pre> <p>Response (2FA Required):</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"requires2FA\": true,\n    \"availableMethods\": [\"totp\", \"sms\", \"email\"]\n  }\n}\n</code></pre> <p>Response (Trusted Device):</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n  }\n}\n</code></pre>"},{"location":"api/authentication/#next-steps-after-2fa-required","title":"Next Steps After 2FA Required","text":"<ol> <li>For TOTP: User enters code from authenticator app \u2192 Call POST /2fa/verify</li> <li>For SMS/Email: Request code \u2192 Call POST /2fa/send-code \u2192 Call POST /2fa/verify</li> </ol>"},{"location":"api/authentication/#errors_1","title":"Errors","text":"Status Error Description 400 Validation error Invalid email or password format 401 Invalid credentials Email or password incorrect 429 Too many requests Rate limit exceeded (5 requests / 15 min)"},{"location":"api/authentication/#rate-limiting_1","title":"Rate Limiting","text":"<ul> <li>Limit: 5 requests per 15 minutes</li> <li>Identifier: IP address</li> </ul>"},{"location":"api/authentication/#refresh-token","title":"Refresh Token","text":"<p>Obtain a new access token using a refresh token.</p>"},{"location":"api/authentication/#request_1","title":"Request","text":"<pre><code>POST /auth/refresh\nContent-Type: application/json\n\n{\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n}\n</code></pre>"},{"location":"api/authentication/#response_1","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n  }\n}\n</code></pre> <p>Token Rotation</p> <p>The refresh token is rotated on each refresh. The old refresh token is invalidated and a new one is issued.</p>"},{"location":"api/authentication/#errors_2","title":"Errors","text":"Status Error Description 401 Invalid refresh token Token invalid, expired, or revoked 429 Too many requests Rate limit exceeded (10 requests / 15 min)"},{"location":"api/authentication/#rate-limiting_2","title":"Rate Limiting","text":"<ul> <li>Limit: 10 requests per 15 minutes</li> <li>Identifier: User ID</li> </ul>"},{"location":"api/authentication/#get-current-user","title":"Get Current User","text":"<p>Retrieve the authenticated user's profile.</p>"},{"location":"api/authentication/#request_2","title":"Request","text":"<pre><code>GET /auth/me\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/authentication/#response_2","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"email\": \"user@example.com\",\n    \"username\": \"johndoe\",\n    \"emailVerified\": true,\n    \"twoFactorEnabled\": true,\n    \"createdAt\": \"2024-10-19T12:00:00.000Z\",\n    \"updatedAt\": \"2024-10-19T12:00:00.000Z\"\n  }\n}\n</code></pre>"},{"location":"api/authentication/#errors_3","title":"Errors","text":"Status Error Description 401 Unauthorized Missing or invalid access token"},{"location":"api/authentication/#logout","title":"Logout","text":"<p>End the current session and revoke the refresh token.</p>"},{"location":"api/authentication/#request_3","title":"Request","text":"<pre><code>POST /auth/logout\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/authentication/#response_3","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"Logged out successfully\"\n  }\n}\n</code></pre> <p>Access Token</p> <p>The access token cannot be revoked (it's stateless). It will remain valid until expiration (15 minutes). The refresh token is immediately invalidated.</p>"},{"location":"api/authentication/#errors_4","title":"Errors","text":"Status Error Description 401 Unauthorized Missing or invalid access token"},{"location":"api/authentication/#revoke-all-sessions","title":"Revoke All Sessions","text":"<p>Logout from all devices by revoking all refresh tokens.</p>"},{"location":"api/authentication/#request_4","title":"Request","text":"<pre><code>POST /auth/revoke-sessions\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/authentication/#response_4","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"All sessions revoked\",\n    \"revokedCount\": 5\n  }\n}\n</code></pre>"},{"location":"api/authentication/#use-cases","title":"Use Cases","text":"<ul> <li>User suspects account compromise</li> <li>Lost device</li> <li>Security precaution</li> </ul>"},{"location":"api/authentication/#errors_5","title":"Errors","text":"Status Error Description 401 Unauthorized Missing or invalid access token"},{"location":"api/authentication/#token-lifetimes","title":"Token Lifetimes","text":"Token Type Lifetime Renewal Storage Access Token 15 minutes Via refresh token Client memory (don't persist) Refresh Token 7 days Rotated on each refresh Secure storage (HttpOnly cookie recommended) Temp Token 5 minutes Cannot be renewed Client memory"},{"location":"api/authentication/#security-best-practices","title":"Security Best Practices","text":""},{"location":"api/authentication/#client-side","title":"Client-Side","text":"<ol> <li>Store access token in memory only (React state, Vuex, etc.)</li> <li>Store refresh token securely:</li> <li>Web: HttpOnly cookie (server-side set)</li> <li>Mobile: Secure keychain/keystore</li> <li>Never in localStorage or sessionStorage</li> <li>Clear tokens on logout</li> <li>Implement token refresh before expiration</li> </ol>"},{"location":"api/authentication/#server-side","title":"Server-Side","text":"<ol> <li>Use HTTPS only in production</li> <li>Set HttpOnly, Secure, SameSite cookies for refresh tokens</li> <li>Implement CSRF protection for cookie-based auth</li> <li>Log all authentication events for audit trail</li> </ol>"},{"location":"api/authentication/#example-complete-login-flow","title":"Example: Complete Login Flow","text":""},{"location":"api/authentication/#react-example","title":"React Example","text":"<pre><code>import axios from 'axios'\n\ninterface LoginResponse {\n  accessToken?: string\n  refreshToken?: string\n  tempToken?: string\n  requires2FA?: boolean\n  availableMethods?: string[]\n}\n\nasync function login(email: string, password: string): Promise&lt;LoginResponse&gt; {\n  const { data } = await axios.post('/auth/login', { email, password })\n\n  if (data.data.requires2FA) {\n    // Store temp token\n    sessionStorage.setItem('tempToken', data.data.tempToken)\n    // Redirect to 2FA page\n    return data.data\n  }\n\n  // Store tokens\n  localStorage.setItem('accessToken', data.data.accessToken) // \u26a0\ufe0f Not recommended\n  // Better: Store in memory only\n  return data.data\n}\n\nasync function refreshAccessToken(refreshToken: string): Promise&lt;string&gt; {\n  const { data } = await axios.post('/auth/refresh', { refreshToken })\n  return data.data.accessToken\n}\n\n// Axios interceptor for auto-refresh\naxios.interceptors.response.use(\n  response =&gt; response,\n  async error =&gt; {\n    if (error.response?.status === 401 &amp;&amp; error.config &amp;&amp; !error.config._retry) {\n      error.config._retry = true\n      const refreshToken = getRefreshToken() // Your storage method\n      const newAccessToken = await refreshAccessToken(refreshToken)\n      error.config.headers.Authorization = `Bearer ${newAccessToken}`\n      return axios(error.config)\n    }\n    return Promise.reject(error)\n  }\n)\n</code></pre>"},{"location":"api/authentication/#nodejs-example","title":"Node.js Example","text":"<pre><code>const axios = require('axios')\n\nasync function login(email, password) {\n  try {\n    const response = await axios.post('https://your-api.com/auth/login', {\n      email,\n      password\n    })\n\n    if (response.data.data.requires2FA) {\n      console.log('2FA required:', response.data.data.availableMethods)\n      return response.data.data\n    }\n\n    console.log('Login successful')\n    return response.data.data\n  } catch (error) {\n    if (error.response?.status === 401) {\n      console.error('Invalid credentials')\n    } else if (error.response?.status === 429) {\n      console.error('Too many login attempts. Please try again later.')\n    }\n    throw error\n  }\n}\n</code></pre>"},{"location":"api/authentication/#python-example","title":"Python Example","text":"<pre><code>import requests\n\ndef login(email: str, password: str) -&gt; dict:\n    response = requests.post('https://your-api.com/auth/login', json={\n        'email': email,\n        'password': password\n    })\n\n    response.raise_for_status()\n    data = response.json()['data']\n\n    if data.get('requires2FA'):\n        print(f\"2FA required: {data['availableMethods']}\")\n        return data\n\n    print(\"Login successful\")\n    return data\n</code></pre>"},{"location":"api/authentication/#related-endpoints","title":"Related Endpoints","text":"<ul> <li>Two-Factor Authentication - Setup and verify 2FA</li> <li>Password Reset - Reset forgotten password</li> <li>Email Verification - Verify email address</li> </ul>"},{"location":"api/authentication/#rate-limits-summary","title":"Rate Limits Summary","text":"Endpoint Limit Window <code>/auth/register</code> 5 requests 15 minutes <code>/auth/login</code> 5 requests 15 minutes <code>/auth/refresh</code> 10 requests 15 minutes <code>/auth/me</code> 100 requests 15 minutes <code>/auth/logout</code> 100 requests 15 minutes <code>/auth/revoke-sessions</code> 10 requests 15 minutes"},{"location":"api/authentication/#next-steps","title":"Next Steps","text":"<ul> <li>Setup 2FA - Enable two-factor authentication</li> <li>Integration Guide - Integrate into your app</li> <li>Error Codes - Complete error reference</li> </ul>"},{"location":"api/two-factor/","title":"Two-Factor Authentication API","text":"<p>Complete guide to 2FA setup, verification, and management.</p>"},{"location":"api/two-factor/#totp-time-based-one-time-password","title":"TOTP (Time-Based One-Time Password)","text":""},{"location":"api/two-factor/#setup-totp","title":"Setup TOTP","text":"<p>Initiate TOTP setup and receive QR code.</p>"},{"location":"api/two-factor/#request","title":"Request","text":"<pre><code>POST /2fa/totp/setup\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"qrCode\": \"data:image/png;base64,iVBORw0KGgoAAAANS...\",\n    \"secret\": \"JBSWY3DPEHPK3PXP\",\n    \"backupCodes\": [\n      \"A1B2C3D4E5\",\n      \"F6G7H8I9J0\",\n      \"K1L2M3N4O5\",\n      \"P6Q7R8S9T0\",\n      \"U1V2W3X4Y5\",\n      \"Z6A7B8C9D0\",\n      \"E1F2G3H4I5\",\n      \"J6K7L8M9N0\",\n      \"O1P2Q3R4S5\",\n      \"T6U7V8W9X0\"\n    ]\n  }\n}\n</code></pre> <p>Important</p> <ul> <li>Save backup codes securely (print or download)</li> <li>Backup codes are shown only once</li> <li>QR code should be scanned immediately</li> <li>Secret can be entered manually if QR scan fails</li> </ul>"},{"location":"api/two-factor/#next-steps","title":"Next Steps","text":"<ol> <li>Scan QR code with authenticator app (Google Authenticator, Authy, etc.)</li> <li>Or manually enter secret into authenticator app</li> <li>Save backup codes securely</li> <li>Verify setup with a code from your authenticator app</li> </ol>"},{"location":"api/two-factor/#verify-totp-setup","title":"Verify TOTP Setup","text":"<p>Confirm TOTP setup by verifying a code from the authenticator app.</p>"},{"location":"api/two-factor/#request_1","title":"Request","text":"<pre><code>POST /2fa/totp/verify-setup\nAuthorization: Bearer &lt;access_token&gt;\nContent-Type: application/json\n\n{\n  \"code\": \"123456\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_1","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"enabled\": true,\n    \"method\": \"totp\"\n  }\n}\n</code></pre> <p>TOTP Enabled</p> <p>TOTP is now active. Future logins will require a code from your authenticator app.</p>"},{"location":"api/two-factor/#errors","title":"Errors","text":"Status Error Description 400 Invalid code Code is incorrect or expired 400 Setup not initiated Must call <code>/2fa/totp/setup</code> first 401 Unauthorized Missing or invalid access token 429 Too many requests Rate limit exceeded (10 requests / 15 min)"},{"location":"api/two-factor/#disable-totp","title":"Disable TOTP","text":"<p>Remove TOTP 2FA from your account.</p>"},{"location":"api/two-factor/#request_2","title":"Request","text":"<pre><code>DELETE /2fa/totp\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_2","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"TOTP disabled successfully\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#sms-2fa","title":"SMS 2FA","text":"<p>Requirements</p> <p>SMS 2FA requires a configured Twilio account. Not available on free/zero-budget deployments.</p>"},{"location":"api/two-factor/#setup-sms-2fa","title":"Setup SMS 2FA","text":"<p>Configure SMS-based 2FA.</p>"},{"location":"api/two-factor/#request_3","title":"Request","text":"<pre><code>POST /2fa/sms/setup\nAuthorization: Bearer &lt;access_token&gt;\nContent-Type: application/json\n\n{\n  \"phoneNumber\": \"+1234567890\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_3","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"phoneNumber\": \"+1234567890\",\n    \"codeSent\": true,\n    \"message\": \"Verification code sent to +123****7890\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#next-steps_1","title":"Next Steps","text":"<ol> <li>Check your phone for SMS with 6-digit code</li> <li>Call <code>/2fa/sms/verify-setup</code> with the code</li> </ol>"},{"location":"api/two-factor/#verify-sms-setup","title":"Verify SMS Setup","text":"<p>Confirm SMS 2FA setup with the code received via SMS.</p>"},{"location":"api/two-factor/#request_4","title":"Request","text":"<pre><code>POST /2fa/sms/verify-setup\nAuthorization: Bearer &lt;access_token&gt;\nContent-Type: application/json\n\n{\n  \"code\": \"123456\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_4","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"enabled\": true,\n    \"method\": \"sms\",\n    \"phoneNumber\": \"+123****7890\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#email-2fa","title":"Email 2FA","text":""},{"location":"api/two-factor/#setup-email-2fa","title":"Setup Email 2FA","text":"<p>Configure email-based 2FA.</p>"},{"location":"api/two-factor/#request_5","title":"Request","text":"<pre><code>POST /2fa/email/setup\nAuthorization: Bearer &lt;access_token&gt;\nContent-Type: application/json\n\n{\n  \"email\": \"user@example.com\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_5","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"email\": \"use****@example.com\",\n    \"codeSent\": true,\n    \"message\": \"Verification code sent to use****@example.com\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#next-steps_2","title":"Next Steps","text":"<ol> <li>Check your email for 6-digit code</li> <li>Call <code>/2fa/email/verify-setup</code> with the code</li> </ol>"},{"location":"api/two-factor/#verify-email-setup","title":"Verify Email Setup","text":"<p>Confirm Email 2FA setup with the code received via email.</p>"},{"location":"api/two-factor/#request_6","title":"Request","text":"<pre><code>POST /2fa/email/verify-setup\nAuthorization: Bearer &lt;access_token&gt;\nContent-Type: application/json\n\n{\n  \"code\": \"123456\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_6","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"enabled\": true,\n    \"method\": \"email\",\n    \"email\": \"use****@example.com\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#2fa-verification","title":"2FA Verification","text":""},{"location":"api/two-factor/#send-otp-code","title":"Send OTP Code","text":"<p>Request a one-time password via SMS or Email.</p> <p>TOTP vs SMS/Email</p> <ul> <li>TOTP: Codes are generated offline by your authenticator app. No need to call this endpoint.</li> <li>SMS/Email: Codes are sent on-demand. Call this endpoint to receive a code.</li> </ul>"},{"location":"api/two-factor/#request_7","title":"Request","text":"<pre><code>POST /2fa/send-code\nContent-Type: application/json\n\n{\n  \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"method\": \"sms\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_7","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"codeSent\": true,\n    \"method\": \"sms\",\n    \"expiresIn\": 300\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#parameters","title":"Parameters","text":"Field Type Required Description <code>tempToken</code> string Yes Temporary token from login response <code>method</code> string Yes \"sms\" or \"email\""},{"location":"api/two-factor/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>SMS: 5 requests per hour</li> <li>Email: 10 requests per hour</li> </ul>"},{"location":"api/two-factor/#verify-2fa-code","title":"Verify 2FA Code","text":"<p>Verify a 2FA code and complete authentication.</p>"},{"location":"api/two-factor/#request_8","title":"Request","text":"<pre><code>POST /2fa/verify\nContent-Type: application/json\n\n{\n  \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"code\": \"123456\",\n  \"trustDevice\": false\n}\n</code></pre>"},{"location":"api/two-factor/#response-success","title":"Response (Success)","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"deviceToken\": \"eyJhbGciOiJIUzI1NiIs...\"\n  }\n}\n</code></pre> <p>Device Token</p> <p><code>deviceToken</code> is only included if <code>trustDevice: true</code>. Store this token to skip 2FA on future logins from this device for 30 days.</p>"},{"location":"api/two-factor/#parameters_1","title":"Parameters","text":"Field Type Required Description <code>tempToken</code> string Yes Temporary token from login response <code>code</code> string Yes 6-digit code from authenticator/SMS/email <code>trustDevice</code> boolean No If true, skip 2FA on this device for 30 days"},{"location":"api/two-factor/#errors_1","title":"Errors","text":"Status Error Description 400 Invalid code Code is incorrect or expired 400 Invalid temp token Temp token expired or invalid 429 Too many requests Rate limit exceeded (10 requests / 15 min)"},{"location":"api/two-factor/#verify-backup-code","title":"Verify Backup Code","text":"<p>Use a backup code if primary 2FA method is unavailable.</p>"},{"location":"api/two-factor/#request_9","title":"Request","text":"<pre><code>POST /2fa/verify-backup-code\nContent-Type: application/json\n\n{\n  \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"backupCode\": \"A1B2C3D4E5\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_8","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"remainingCodes\": 9\n  }\n}\n</code></pre> <p>One-Time Use</p> <p>Each backup code can only be used once. Generate new codes when you run low.</p>"},{"location":"api/two-factor/#resend-otp-code","title":"Resend OTP Code","text":"<p>Resend the OTP code via SMS or Email.</p>"},{"location":"api/two-factor/#request_10","title":"Request","text":"<pre><code>POST /2fa/resend\nContent-Type: application/json\n\n{\n  \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"method\": \"sms\"\n}\n</code></pre>"},{"location":"api/two-factor/#response_9","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"codeSent\": true,\n    \"method\": \"sms\",\n    \"expiresIn\": 300\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#rate-limiting_1","title":"Rate Limiting","text":"<p>Same as <code>/2fa/send-code</code>: - SMS: 5 requests per hour - Email: 10 requests per hour</p>"},{"location":"api/two-factor/#backup-codes","title":"Backup Codes","text":""},{"location":"api/two-factor/#generate-backup-codes","title":"Generate Backup Codes","text":"<p>Generate a new set of 10 backup codes.</p> <p>Previous Codes Invalidated</p> <p>Generating new backup codes will invalidate all previous unused codes.</p>"},{"location":"api/two-factor/#request_11","title":"Request","text":"<pre><code>POST /2fa/backup-codes/generate\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_10","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"backupCodes\": [\n      \"A1B2C3D4E5\",\n      \"F6G7H8I9J0\",\n      \"K1L2M3N4O5\",\n      \"P6Q7R8S9T0\",\n      \"U1V2W3X4Y5\",\n      \"Z6A7B8C9D0\",\n      \"E1F2G3H4I5\",\n      \"J6K7L8M9N0\",\n      \"O1P2Q3R4S5\",\n      \"T6U7V8W9X0\"\n    ]\n  }\n}\n</code></pre> <p>Save Immediately</p> <p>Backup codes are shown only once. Print or download them securely.</p>"},{"location":"api/two-factor/#count-remaining-backup-codes","title":"Count Remaining Backup Codes","text":"<p>Check how many unused backup codes you have.</p>"},{"location":"api/two-factor/#request_12","title":"Request","text":"<pre><code>GET /2fa/backup-codes/count\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_11","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"remaining\": 7,\n    \"total\": 10\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#2fa-methods-management","title":"2FA Methods Management","text":""},{"location":"api/two-factor/#list-all-2fa-methods","title":"List All 2FA Methods","text":"<p>Get all enabled 2FA methods for the current user.</p>"},{"location":"api/two-factor/#request_13","title":"Request","text":"<pre><code>GET /2fa/methods\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_12","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"methods\": [\n      {\n        \"id\": \"uuid-1\",\n        \"type\": \"totp\",\n        \"enabled\": true,\n        \"verifiedAt\": \"2024-10-19T12:00:00.000Z\",\n        \"createdAt\": \"2024-10-19T12:00:00.000Z\"\n      },\n      {\n        \"id\": \"uuid-2\",\n        \"type\": \"sms\",\n        \"enabled\": true,\n        \"phoneNumber\": \"+123****7890\",\n        \"verifiedAt\": \"2024-10-20T12:00:00.000Z\",\n        \"createdAt\": \"2024-10-20T12:00:00.000Z\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#remove-2fa-method","title":"Remove 2FA Method","text":"<p>Disable and remove a specific 2FA method.</p> <p>Last Method</p> <p>You cannot remove your last 2FA method if 2FA is enabled. Disable 2FA entirely first, or add another method.</p>"},{"location":"api/two-factor/#request_14","title":"Request","text":"<pre><code>DELETE /2fa/methods/{methodId}\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_13","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"2FA method removed successfully\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#trusted-devices","title":"Trusted Devices","text":""},{"location":"api/two-factor/#list-trusted-devices","title":"List Trusted Devices","text":"<p>Get all devices trusted for 2FA bypass.</p>"},{"location":"api/two-factor/#request_15","title":"Request","text":"<pre><code>GET /2fa/devices\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_14","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"devices\": [\n      {\n        \"id\": \"uuid-1\",\n        \"deviceName\": \"Chrome on MacBook Pro\",\n        \"ipAddress\": \"192.168.1.100\",\n        \"userAgent\": \"Mozilla/5.0...\",\n        \"createdAt\": \"2024-10-19T12:00:00.000Z\",\n        \"lastUsedAt\": \"2024-10-25T08:30:00.000Z\",\n        \"expiresAt\": \"2024-11-18T12:00:00.000Z\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#remove-trusted-device","title":"Remove Trusted Device","text":"<p>Revoke trust for a specific device.</p>"},{"location":"api/two-factor/#request_16","title":"Request","text":"<pre><code>DELETE /2fa/devices/{deviceId}\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_15","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"Trusted device removed successfully\"\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#remove-all-trusted-devices","title":"Remove All Trusted Devices","text":"<p>Revoke trust for all devices (force 2FA on next login from all devices).</p>"},{"location":"api/two-factor/#request_17","title":"Request","text":"<pre><code>DELETE /2fa/devices\nAuthorization: Bearer &lt;access_token&gt;\n</code></pre>"},{"location":"api/two-factor/#response_16","title":"Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"message\": \"All trusted devices removed\",\n    \"removedCount\": 3\n  }\n}\n</code></pre>"},{"location":"api/two-factor/#complete-setup-examples","title":"Complete Setup Examples","text":""},{"location":"api/two-factor/#example-1-setup-totp","title":"Example 1: Setup TOTP","text":"<pre><code>// 1. Initiate setup\nconst setupResponse = await fetch('/2fa/totp/setup', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${accessToken}`\n  }\n})\nconst { qrCode, secret, backupCodes } = await setupResponse.json()\n\n// 2. Display QR code to user\ndisplayQRCode(qrCode)\n\n// 3. Save backup codes\nsaveBackupCodes(backupCodes)\n\n// 4. User scans QR code and enters code from app\nconst userCode = await promptUserForCode()\n\n// 5. Verify setup\nconst verifyResponse = await fetch('/2fa/totp/verify-setup', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${accessToken}`,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ code: userCode })\n})\n\nif (verifyResponse.ok) {\n  console.log('TOTP enabled successfully!')\n}\n</code></pre>"},{"location":"api/two-factor/#example-2-login-with-totp","title":"Example 2: Login with TOTP","text":"<pre><code>// 1. Initial login\nconst loginResponse = await fetch('/auth/login', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ email, password })\n})\nconst loginData = await loginResponse.json()\n\nif (loginData.data.requires2FA) {\n  // 2. Prompt user for TOTP code\n  const code = await promptUserForCode()\n\n  // 3. Verify 2FA\n  const verifyResponse = await fetch('/2fa/verify', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      tempToken: loginData.data.tempToken,\n      code: code,\n      trustDevice: true // Optional: skip 2FA for 30 days\n    })\n  })\n\n  const { accessToken, refreshToken, deviceToken } = await verifyResponse.json()\n\n  // Store tokens\n  storeTokens(accessToken, refreshToken, deviceToken)\n}\n</code></pre>"},{"location":"api/two-factor/#example-3-login-with-sms-2fa","title":"Example 3: Login with SMS 2FA","text":"<pre><code>// 1. Initial login\nconst loginResponse = await fetch('/auth/login', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ email, password })\n})\nconst loginData = await loginResponse.json()\n\nif (loginData.data.requires2FA) {\n  // 2. Request SMS code\n  await fetch('/2fa/send-code', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      tempToken: loginData.data.tempToken,\n      method: 'sms'\n    })\n  })\n\n  // 3. Prompt user for code from SMS\n  const code = await promptUserForCode()\n\n  // 4. Verify 2FA\n  const verifyResponse = await fetch('/2fa/verify', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      tempToken: loginData.data.tempToken,\n      code: code\n    })\n  })\n\n  const { accessToken, refreshToken } = await verifyResponse.json()\n  storeTokens(accessToken, refreshToken)\n}\n</code></pre>"},{"location":"api/two-factor/#rate-limits-summary","title":"Rate Limits Summary","text":"Endpoint Limit Window <code>/2fa/*/setup</code> 10 requests 15 minutes <code>/2fa/*/verify-setup</code> 10 requests 15 minutes <code>/2fa/send-code</code> (SMS) 5 requests 1 hour <code>/2fa/send-code</code> (Email) 10 requests 1 hour <code>/2fa/verify</code> 10 requests 15 minutes <code>/2fa/verify-backup-code</code> 5 requests 15 minutes Other 2FA endpoints 100 requests 15 minutes"},{"location":"api/two-factor/#next-steps_3","title":"Next Steps","text":"<ul> <li>Authentication API - Login and registration</li> <li>Integration Guide - Integrate into your app</li> <li>Security Best Practices - Security guidelines</li> </ul>"},{"location":"architecture/authentication-flow/","title":"Authentication Flow","text":"<p>This document details the authentication and authorization flows in the 2FA Authentication Service.</p>"},{"location":"architecture/authentication-flow/#user-registration","title":"User Registration","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant Worker as Argon2 Worker\n    participant DB as PostgreSQL\n    participant Audit as Audit Service\n\n    Client-&gt;&gt;API: POST /auth/register&lt;br/&gt;{email, username, password}\n    API-&gt;&gt;API: Validate input (Zod)\n    API-&gt;&gt;API: Check rate limit\n\n    API-&gt;&gt;AuthSvc: Register user\n    AuthSvc-&gt;&gt;DB: Check email exists\n    DB--&gt;&gt;AuthSvc: Email available\n\n    AuthSvc-&gt;&gt;Worker: Hash password (Argon2id)\n    Note over Worker: CPU-intensive operation&lt;br/&gt;in worker pool\n    Worker--&gt;&gt;AuthSvc: Hashed password\n\n    AuthSvc-&gt;&gt;DB: Create user record\n    DB--&gt;&gt;AuthSvc: User created\n\n    AuthSvc-&gt;&gt;AuthSvc: Generate JWT tokens\n    AuthSvc-&gt;&gt;DB: Store refresh token\n    AuthSvc-&gt;&gt;Audit: Log registration event\n\n    AuthSvc--&gt;&gt;API: Return tokens\n    API--&gt;&gt;Client: 201 Created&lt;br/&gt;{accessToken, refreshToken, user}</code></pre>"},{"location":"architecture/authentication-flow/#registration-request","title":"Registration Request","text":"<pre><code>POST /auth/register\n{\n  \"email\": \"user@example.com\",\n  \"username\": \"johndoe\",\n  \"password\": \"SecureP@ssw0rd123!\"\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#registration-response","title":"Registration Response","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"user\": {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"username\": \"johndoe\",\n      \"twoFactorEnabled\": false,\n      \"createdAt\": \"2024-10-19T00:00:00.000Z\"\n    }\n  }\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#login-without-2fa","title":"Login Without 2FA","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant Worker as Argon2 Worker\n    participant DB as PostgreSQL\n    participant Redis\n    participant Audit as Audit Service\n\n    Client-&gt;&gt;API: POST /auth/login&lt;br/&gt;{email, password}\n    API-&gt;&gt;API: Validate input\n    API-&gt;&gt;API: Check rate limit\n\n    API-&gt;&gt;AuthSvc: Authenticate user\n    AuthSvc-&gt;&gt;DB: Query user by email\n    DB--&gt;&gt;AuthSvc: User data\n\n    AuthSvc-&gt;&gt;Worker: Verify password (Argon2)\n    Worker--&gt;&gt;AuthSvc: Password valid\n\n    AuthSvc-&gt;&gt;DB: Check 2FA enabled\n    DB--&gt;&gt;AuthSvc: 2FA disabled\n\n    AuthSvc-&gt;&gt;AuthSvc: Generate JWT tokens\n    AuthSvc-&gt;&gt;DB: Store refresh token\n    AuthSvc-&gt;&gt;Redis: Store session\n    AuthSvc-&gt;&gt;Audit: Log login success\n\n    AuthSvc--&gt;&gt;API: Return tokens\n    API--&gt;&gt;Client: 200 OK&lt;br/&gt;{accessToken, refreshToken}</code></pre>"},{"location":"architecture/authentication-flow/#login-with-2fa-totp","title":"Login With 2FA (TOTP)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant TFASvc as 2FA Service\n    participant Worker as Argon2 Worker\n    participant DB as PostgreSQL\n    participant Redis\n    participant Audit as Audit Service\n\n    rect rgb(200, 220, 240)\n    Note over Client,Audit: Step 1: Initial Authentication\n    Client-&gt;&gt;API: POST /auth/login&lt;br/&gt;{email, password}\n    API-&gt;&gt;AuthSvc: Authenticate\n    AuthSvc-&gt;&gt;DB: Query user\n    AuthSvc-&gt;&gt;Worker: Verify password\n    Worker--&gt;&gt;AuthSvc: Valid\n\n    AuthSvc-&gt;&gt;DB: Check 2FA enabled\n    DB--&gt;&gt;AuthSvc: TOTP enabled\n\n    AuthSvc-&gt;&gt;Redis: Store temp token (5 min TTL)\n    AuthSvc--&gt;&gt;API: Return temp token\n    API--&gt;&gt;Client: 200 OK&lt;br/&gt;{tempToken, requires2FA: true, method: \"totp\"}\n    end\n\n    rect rgb(200, 240, 220)\n    Note over Client,Audit: Step 2: Client Prompts for TOTP Code\n    Client-&gt;&gt;Client: Show TOTP input\n    Note over Client: User opens Google Authenticator&lt;br/&gt;and enters 6-digit code\n    end\n\n    rect rgb(240, 220, 200)\n    Note over Client,Audit: Step 3: 2FA Verification\n    Client-&gt;&gt;API: POST /2fa/verify&lt;br/&gt;{tempToken, code: \"123456\"}\n    API-&gt;&gt;TFASvc: Verify TOTP code\n    TFASvc-&gt;&gt;DB: Get user's TOTP secret\n    TFASvc-&gt;&gt;TFASvc: Generate expected codes&lt;br/&gt;(with time drift tolerance)\n\n    alt Code valid\n        TFASvc-&gt;&gt;AuthSvc: Generate JWT tokens\n        AuthSvc-&gt;&gt;DB: Store refresh token\n        AuthSvc-&gt;&gt;Redis: Store session\n        AuthSvc-&gt;&gt;Audit: Log 2FA success\n        TFASvc--&gt;&gt;API: Return tokens\n        API--&gt;&gt;Client: 200 OK&lt;br/&gt;{accessToken, refreshToken}\n    else Code invalid\n        TFASvc-&gt;&gt;Audit: Log 2FA failure\n        TFASvc--&gt;&gt;API: Invalid code\n        API--&gt;&gt;Client: 401 Unauthorized\n    end\n    end</code></pre>"},{"location":"architecture/authentication-flow/#login-with-2fa-smsemail","title":"Login With 2FA (SMS/Email)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant TFASvc as 2FA Service\n    participant Redis\n    participant Twilio\n    participant SMTP\n    participant Audit\n\n    rect rgb(200, 220, 240)\n    Note over Client,Audit: Step 1: Initial Authentication\n    Client-&gt;&gt;API: POST /auth/login&lt;br/&gt;{email, password}\n    API-&gt;&gt;AuthSvc: Authenticate\n    AuthSvc-&gt;&gt;AuthSvc: Verify password\n    AuthSvc-&gt;&gt;Redis: Store temp token\n    AuthSvc--&gt;&gt;Client: {tempToken, requires2FA: true,&lt;br/&gt;availableMethods: [\"sms\", \"email\"]}\n    end\n\n    rect rgb(200, 240, 220)\n    Note over Client,Audit: Step 2: Client Selects 2FA Method\n    Client-&gt;&gt;API: POST /2fa/send-code&lt;br/&gt;{tempToken, method: \"sms\"}\n    API-&gt;&gt;TFASvc: Send SMS code\n    TFASvc-&gt;&gt;TFASvc: Generate 6-digit OTP\n    TFASvc-&gt;&gt;Redis: Store OTP (5 min TTL)\n    TFASvc-&gt;&gt;Twilio: Send SMS\n    Twilio--&gt;&gt;TFASvc: SMS sent\n    TFASvc--&gt;&gt;Client: 200 OK {codeSent: true}\n    end\n\n    rect rgb(240, 220, 200)\n    Note over Client,Audit: Step 3: User Receives &amp; Enters Code\n    Twilio-&gt;&gt;Client: SMS: \"Your code is: 123456\"\n    Client-&gt;&gt;Client: User enters code\n    Client-&gt;&gt;API: POST /2fa/verify&lt;br/&gt;{tempToken, code: \"123456\"}\n    API-&gt;&gt;TFASvc: Verify code\n    TFASvc-&gt;&gt;Redis: Get stored OTP\n    Redis--&gt;&gt;TFASvc: OTP: \"123456\"\n    TFASvc-&gt;&gt;TFASvc: Compare codes\n\n    alt Code valid\n        TFASvc-&gt;&gt;Redis: Delete OTP\n        TFASvc-&gt;&gt;AuthSvc: Generate tokens\n        TFASvc-&gt;&gt;Audit: Log success\n        TFASvc--&gt;&gt;Client: {accessToken, refreshToken}\n    else Code invalid\n        TFASvc-&gt;&gt;Audit: Log failure\n        TFASvc--&gt;&gt;Client: 401 Unauthorized\n    end\n    end</code></pre>"},{"location":"architecture/authentication-flow/#token-refresh","title":"Token Refresh","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant DB as PostgreSQL\n    participant Redis\n\n    Client-&gt;&gt;API: POST /auth/refresh&lt;br/&gt;{refreshToken}\n    API-&gt;&gt;AuthSvc: Refresh tokens\n    AuthSvc-&gt;&gt;AuthSvc: Verify refresh token signature\n    AuthSvc-&gt;&gt;DB: Check refresh token exists\n    DB--&gt;&gt;AuthSvc: Token valid\n\n    alt Token valid and not expired\n        AuthSvc-&gt;&gt;AuthSvc: Generate new access token\n        AuthSvc-&gt;&gt;DB: Rotate refresh token\n        AuthSvc-&gt;&gt;Redis: Update session\n        AuthSvc--&gt;&gt;API: Return new tokens\n        API--&gt;&gt;Client: 200 OK&lt;br/&gt;{accessToken, refreshToken}\n    else Token invalid or expired\n        AuthSvc-&gt;&gt;DB: Delete refresh token\n        AuthSvc-&gt;&gt;Redis: Delete session\n        AuthSvc--&gt;&gt;API: Unauthorized\n        API--&gt;&gt;Client: 401 Unauthorized\n    end</code></pre>"},{"location":"architecture/authentication-flow/#logout","title":"Logout","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant DB as PostgreSQL\n    participant Redis\n\n    Client-&gt;&gt;API: POST /auth/logout&lt;br/&gt;Authorization: Bearer &lt;accessToken&gt;\n    API-&gt;&gt;API: Verify access token\n    API-&gt;&gt;AuthSvc: Logout user\n    AuthSvc-&gt;&gt;DB: Delete refresh token\n    AuthSvc-&gt;&gt;Redis: Delete session\n    AuthSvc--&gt;&gt;API: Success\n    API--&gt;&gt;Client: 200 OK</code></pre>"},{"location":"architecture/authentication-flow/#2fa-setup-totp","title":"2FA Setup (TOTP)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant TFASvc as 2FA Service\n    participant DB as PostgreSQL\n    participant QR as QR Code Generator\n\n    Client-&gt;&gt;API: POST /2fa/totp/setup&lt;br/&gt;Authorization: Bearer &lt;token&gt;\n    API-&gt;&gt;TFASvc: Setup TOTP\n    TFASvc-&gt;&gt;TFASvc: Generate secret key\n    TFASvc-&gt;&gt;QR: Generate QR code\n    QR--&gt;&gt;TFASvc: QR code data URL\n    TFASvc-&gt;&gt;TFASvc: Generate backup codes (10)\n    TFASvc-&gt;&gt;DB: Store secret (encrypted)&lt;br/&gt;Store backup codes (hashed)\n    TFASvc--&gt;&gt;API: Return setup data\n    API--&gt;&gt;Client: 200 OK&lt;br/&gt;{qrCode, secret, backupCodes}\n\n    Note over Client: User scans QR code&lt;br/&gt;with authenticator app\n\n    Client-&gt;&gt;API: POST /2fa/totp/verify-setup&lt;br/&gt;{code: \"123456\"}\n    API-&gt;&gt;TFASvc: Verify setup code\n    TFASvc-&gt;&gt;DB: Get temp secret\n    TFASvc-&gt;&gt;TFASvc: Verify code\n\n    alt Code valid\n        TFASvc-&gt;&gt;DB: Enable TOTP for user&lt;br/&gt;Mark secret as verified\n        TFASvc--&gt;&gt;Client: 200 OK {enabled: true}\n    else Code invalid\n        TFASvc--&gt;&gt;Client: 400 Invalid code\n    end</code></pre>"},{"location":"architecture/authentication-flow/#trusted-device-flow","title":"Trusted Device Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant TFASvc as 2FA Service\n    participant DB as PostgreSQL\n    participant Redis\n\n    Note over Client: User logs in with 2FA\n\n    Client-&gt;&gt;API: POST /2fa/verify&lt;br/&gt;{tempToken, code, trustDevice: true}\n    API-&gt;&gt;TFASvc: Verify 2FA\n    TFASvc-&gt;&gt;TFASvc: Verify code\n\n    alt Code valid and trustDevice=true\n        TFASvc-&gt;&gt;TFASvc: Generate device token (30 days)\n        TFASvc-&gt;&gt;DB: Store trusted device\n        TFASvc-&gt;&gt;Redis: Cache device token\n        TFASvc--&gt;&gt;Client: {accessToken, refreshToken,&lt;br/&gt;deviceToken}\n        Note over Client: Client stores deviceToken&lt;br/&gt;in localStorage/keychain\n    end\n\n    Note over Client: Next login from same device\n\n    Client-&gt;&gt;API: POST /auth/login&lt;br/&gt;{email, password,&lt;br/&gt;deviceToken}\n    API-&gt;&gt;TFASvc: Check device token\n    TFASvc-&gt;&gt;Redis: Get cached device\n    alt Device token valid\n        TFASvc--&gt;&gt;API: Skip 2FA\n        API-&gt;&gt;API: Generate tokens directly\n        API--&gt;&gt;Client: {accessToken, refreshToken}\n    else Device token invalid/expired\n        API--&gt;&gt;Client: {requires2FA: true}\n    end</code></pre>"},{"location":"architecture/authentication-flow/#api-key-authentication","title":"API Key Authentication","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthMW as Auth Middleware\n    participant DB as PostgreSQL\n    participant Redis\n\n    Client-&gt;&gt;API: GET /api/endpoint&lt;br/&gt;X-API-Key: &lt;api_key&gt;\n    API-&gt;&gt;AuthMW: Authenticate API key\n    AuthMW-&gt;&gt;Redis: Check cached key\n\n    alt Cache hit\n        Redis--&gt;&gt;AuthMW: Key data\n    else Cache miss\n        AuthMW-&gt;&gt;DB: Query API key\n        DB--&gt;&gt;AuthMW: Key data\n        AuthMW-&gt;&gt;Redis: Cache key data (1 hour)\n    end\n\n    AuthMW-&gt;&gt;AuthMW: Verify key active\n    AuthMW-&gt;&gt;AuthMW: Check scopes\n    AuthMW-&gt;&gt;AuthMW: Check rate limit\n\n    alt Valid key and authorized\n        AuthMW-&gt;&gt;API: Proceed\n        API--&gt;&gt;Client: 200 OK {data}\n    else Invalid or unauthorized\n        AuthMW--&gt;&gt;Client: 401/403 Error\n    end</code></pre>"},{"location":"architecture/authentication-flow/#token-types-and-lifetimes","title":"Token Types and Lifetimes","text":"Token Type Purpose Lifetime Storage Access Token API authorization 15 minutes Client memory Refresh Token Obtain new access token 7 days Database + Client storage Temp Token Hold 2FA session 5 minutes Redis only Device Token Trust device for 2FA 30 days Database + Client storage API Key Third-party integration Until revoked Database"},{"location":"architecture/authentication-flow/#security-features","title":"Security Features","text":""},{"location":"architecture/authentication-flow/#password-requirements","title":"Password Requirements","text":"<ul> <li>Minimum 8 characters</li> <li>At least one uppercase letter</li> <li>At least one lowercase letter</li> <li>At least one number</li> <li>At least one special character</li> </ul>"},{"location":"architecture/authentication-flow/#rate-limiting","title":"Rate Limiting","text":"Endpoint Limit <code>/auth/register</code> 5 requests / 15 minutes <code>/auth/login</code> 5 requests / 15 minutes <code>/2fa/verify</code> 10 requests / 15 minutes <code>/auth/refresh</code> 10 requests / 15 minutes Other endpoints 100 requests / 15 minutes"},{"location":"architecture/authentication-flow/#password-hashing","title":"Password Hashing","text":"<ul> <li>Algorithm: Argon2id</li> <li>Memory: 64MB</li> <li>Iterations: 3</li> <li>Parallelism: 4</li> <li>Worker Pool: Piscina (prevents event loop blocking)</li> </ul>"},{"location":"architecture/authentication-flow/#jwt-security","title":"JWT Security","text":"<ul> <li>Algorithm: HS256 (HMAC with SHA-256)</li> <li>Secrets: Minimum 64 characters, cryptographically random</li> <li>Rotation: Refresh tokens rotated on each refresh</li> <li>Revocation: Refresh tokens stored in database for revocation</li> </ul>"},{"location":"architecture/authentication-flow/#error-responses","title":"Error Responses","text":""},{"location":"architecture/authentication-flow/#invalid-credentials","title":"Invalid Credentials","text":"<pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid email or password\"\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#2fa-required","title":"2FA Required","text":"<pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"tempToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"requires2FA\": true,\n    \"availableMethods\": [\"totp\", \"sms\", \"email\"]\n  }\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#invalid-2fa-code","title":"Invalid 2FA Code","text":"<pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid verification code\"\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#rate-limit-exceeded","title":"Rate Limit Exceeded","text":"<pre><code>{\n  \"success\": false,\n  \"error\": \"Too many requests. Please try again later.\"\n}\n</code></pre>"},{"location":"architecture/authentication-flow/#next-steps","title":"Next Steps","text":"<ul> <li>Database Schema - Data model and relationships</li> <li>Security Architecture - Security controls</li> <li>API Reference - Detailed endpoint documentation</li> </ul>"},{"location":"architecture/database-schema/","title":"Database Schema","text":""},{"location":"architecture/database-schema/#entity-relationship-diagram","title":"Entity Relationship Diagram","text":"<pre><code>erDiagram\n    User ||--o{ TwoFactorMethod : has\n    User ||--o{ BackupCode : has\n    User ||--o{ TrustedDevice : has\n    User ||--o{ Session : has\n    User ||--o{ AuditLog : creates\n    User ||--o{ ApiKey : owns\n    User ||--o{ Webhook : owns\n    Webhook ||--o{ WebhookDelivery : has\n\n    User {\n        uuid id PK\n        string email UK\n        string username UK\n        string passwordHash\n        boolean emailVerified\n        boolean twoFactorEnabled\n        boolean isActive\n        timestamp createdAt\n        timestamp updatedAt\n    }\n\n    TwoFactorMethod {\n        uuid id PK\n        uuid userId FK\n        string type\n        boolean enabled\n        string secret\n        string phoneNumber\n        string email\n        timestamp verifiedAt\n        timestamp createdAt\n        timestamp updatedAt\n    }\n\n    BackupCode {\n        uuid id PK\n        uuid userId FK\n        string codeHash\n        timestamp usedAt\n        timestamp createdAt\n    }\n\n    TrustedDevice {\n        uuid id PK\n        uuid userId FK\n        string deviceToken UK\n        string deviceName\n        string ipAddress\n        string userAgent\n        timestamp expiresAt\n        timestamp createdAt\n        timestamp lastUsedAt\n    }\n\n    Session {\n        uuid id PK\n        uuid userId FK\n        string refreshToken UK\n        string ipAddress\n        string userAgent\n        timestamp expiresAt\n        timestamp createdAt\n        timestamp lastUsedAt\n    }\n\n    AuditLog {\n        uuid id PK\n        uuid userId FK\n        string action\n        string details\n        string ipAddress\n        string userAgent\n        boolean success\n        timestamp createdAt\n    }\n\n    ApiKey {\n        uuid id PK\n        uuid userId FK\n        string name\n        string keyHash UK\n        string keyPrefix\n        string[] scopes\n        timestamp expiresAt\n        timestamp lastUsedAt\n        boolean isActive\n        int rateLimit\n        timestamp createdAt\n        timestamp updatedAt\n    }\n\n    Webhook {\n        uuid id PK\n        uuid userId FK\n        string url\n        string[] events\n        string secret\n        boolean isActive\n        int failureCount\n        timestamp lastSuccess\n        timestamp lastFailure\n        timestamp createdAt\n        timestamp updatedAt\n    }\n\n    WebhookDelivery {\n        uuid id PK\n        uuid webhookId FK\n        string event\n        string payload\n        int statusCode\n        string response\n        int attempt\n        boolean success\n        string error\n        timestamp deliveredAt\n    }</code></pre>"},{"location":"architecture/database-schema/#tables","title":"Tables","text":""},{"location":"architecture/database-schema/#user","title":"User","text":"<p>Central user entity. All authentication and 2FA settings are linked to a user.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Unique user identifier <code>email</code> String Unique, Not Null User's email address <code>username</code> String Unique, Not Null Username for display <code>passwordHash</code> String Not Null Argon2id hashed password <code>emailVerified</code> Boolean Default: false Email verification status <code>twoFactorEnabled</code> Boolean Default: false Whether user has any 2FA enabled <code>isActive</code> Boolean Default: true Account status (for soft delete) <code>createdAt</code> Timestamp Default: now() Account creation time <code>updatedAt</code> Timestamp Auto-update Last profile update time <p>Relationships: - Has many <code>TwoFactorMethod</code> - Has many <code>BackupCode</code> - Has many <code>TrustedDevice</code> - Has many <code>Session</code> - Has many <code>AuditLog</code> - Has many <code>ApiKey</code> - Has many <code>Webhook</code></p> <p>Indexes: - Primary: <code>id</code> - Unique: <code>email</code> - Unique: <code>username</code></p>"},{"location":"architecture/database-schema/#twofactormethod","title":"TwoFactorMethod","text":"<p>Stores 2FA configuration per user. Each user can have multiple 2FA methods enabled.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Method identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>type</code> String Not Null Method type: \"totp\", \"sms\", \"email\" <code>enabled</code> Boolean Default: true Whether method is active <code>secret</code> String Nullable TOTP secret (encrypted) <code>phoneNumber</code> String Nullable Phone for SMS 2FA <code>email</code> String Nullable Email for Email 2FA <code>verifiedAt</code> Timestamp Nullable When method was verified <code>createdAt</code> Timestamp Default: now() Creation time <code>updatedAt</code> Timestamp Auto-update Last update time <p>Relationships: - Belongs to <code>User</code></p> <p>Indexes: - Primary: <code>id</code> - Unique: <code>(userId, type)</code> - Prevents duplicate method types per user</p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete methods when user is deleted</p>"},{"location":"architecture/database-schema/#backupcode","title":"BackupCode","text":"<p>One-time use backup codes for account recovery when primary 2FA is unavailable.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Code identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>codeHash</code> String Not Null Hashed backup code (bcrypt) <code>usedAt</code> Timestamp Nullable When code was used (NULL = unused) <code>createdAt</code> Timestamp Default: now() Creation time <p>Relationships: - Belongs to <code>User</code></p> <p>Indexes: - Primary: <code>id</code> - Index: <code>userId</code></p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete codes when user is deleted</p> <p>Notes: - Codes are generated in sets of 10 - Each code can only be used once - Codes are hashed for security</p>"},{"location":"architecture/database-schema/#trusteddevice","title":"TrustedDevice","text":"<p>Devices that have been marked as trusted, allowing 2FA bypass for 30 days.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Device identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>deviceToken</code> String Unique, Not Null JWT device token <code>deviceName</code> String Nullable User-friendly name (e.g., \"iPhone 13\") <code>ipAddress</code> String Not Null IP when device was trusted <code>userAgent</code> String Not Null Browser/device info <code>expiresAt</code> Timestamp Not Null When trust expires (30 days) <code>createdAt</code> Timestamp Default: now() When device was trusted <code>lastUsedAt</code> Timestamp Default: now() Last login from device <p>Relationships: - Belongs to <code>User</code></p> <p>Indexes: - Primary: <code>id</code> - Unique: <code>deviceToken</code> - Index: <code>userId</code> - Index: <code>expiresAt</code> - For cleanup queries</p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete devices when user is deleted</p>"},{"location":"architecture/database-schema/#session","title":"Session","text":"<p>Active user sessions linked to refresh tokens.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Session identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>refreshToken</code> String Unique, Not Null Hashed refresh token <code>ipAddress</code> String Nullable Login IP address <code>userAgent</code> String Nullable Browser/device info <code>expiresAt</code> Timestamp Not Null Session expiry (7 days) <code>createdAt</code> Timestamp Default: now() Session start time <code>lastUsedAt</code> Timestamp Default: now() Last token refresh <p>Relationships: - Belongs to <code>User</code></p> <p>Indexes: - Primary: <code>id</code> - Unique: <code>refreshToken</code> - Index: <code>userId</code> - Index: <code>expiresAt</code> - For cleanup queries</p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete sessions when user is deleted</p> <p>Notes: - Supports session revocation (\"logout all devices\") - Expired sessions cleaned up by background job</p>"},{"location":"architecture/database-schema/#auditlog","title":"AuditLog","text":"<p>Security event tracking for compliance and monitoring.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Log entry identifier <code>userId</code> UUID Foreign Key, Nullable References <code>User.id</code> (NULL for system events) <code>action</code> String Not Null Event type (e.g., \"login\", \"2fa_enabled\") <code>details</code> String Nullable JSON string with additional context <code>ipAddress</code> String Nullable IP where event occurred <code>userAgent</code> String Nullable Browser/device info <code>success</code> Boolean Default: true Whether action succeeded <code>createdAt</code> Timestamp Default: now() Event timestamp <p>Relationships: - Belongs to <code>User</code> (optional)</p> <p>Indexes: - Primary: <code>id</code> - Index: <code>userId</code> - Index: <code>action</code> - For event type queries - Index: <code>createdAt</code> - For time-based queries</p> <p>Constraints: - <code>ON DELETE SET NULL</code> - Keep audit logs even if user is deleted</p> <p>Common Actions: - <code>user_registered</code> - <code>user_login</code> - <code>user_logout</code> - <code>2fa_enabled</code> - <code>2fa_disabled</code> - <code>2fa_verified</code> - <code>2fa_failed</code> - <code>password_reset_requested</code> - <code>password_reset_completed</code> - <code>api_key_created</code> - <code>api_key_revoked</code></p>"},{"location":"architecture/database-schema/#apikey","title":"ApiKey","text":"<p>API keys for third-party integration and programmatic access.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Key identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>name</code> String Not Null Human-readable name <code>keyHash</code> String Unique, Not Null Hashed API key (bcrypt) <code>keyPrefix</code> String Not Null First 8 chars for identification <code>scopes</code> String[] Not Null Permissions array <code>expiresAt</code> Timestamp Nullable Optional expiration <code>lastUsedAt</code> Timestamp Nullable Last API call with this key <code>isActive</code> Boolean Default: true Can be disabled without deletion <code>rateLimit</code> Int Default: 1000 Requests per hour <code>createdAt</code> Timestamp Default: now() Creation time <code>updatedAt</code> Timestamp Auto-update Last update time <p>Relationships: - Belongs to <code>User</code></p> <p>Indexes: - Primary: <code>id</code> - Unique: <code>keyHash</code> - Index: <code>userId</code> - Index: <code>isActive</code></p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete keys when user is deleted</p> <p>Scopes: - <code>2fa:read</code> - View 2FA status - <code>2fa:write</code> - Enable/disable 2FA - <code>webhooks:read</code> - View webhooks - <code>webhooks:write</code> - Create/update webhooks - <code>user:read</code> - View user profile - <code>user:write</code> - Update user profile</p>"},{"location":"architecture/database-schema/#webhook","title":"Webhook","text":"<p>Webhook endpoints for real-time event notifications.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Webhook identifier <code>userId</code> UUID Foreign Key, Not Null References <code>User.id</code> <code>url</code> String Not Null Webhook endpoint URL <code>events</code> String[] Not Null Subscribed events <code>secret</code> String Not Null HMAC secret for signature <code>isActive</code> Boolean Default: true Can be disabled <code>failureCount</code> Int Default: 0 Consecutive failures <code>lastSuccess</code> Timestamp Nullable Last successful delivery <code>lastFailure</code> Timestamp Nullable Last failed delivery <code>createdAt</code> Timestamp Default: now() Creation time <code>updatedAt</code> Timestamp Auto-update Last update time <p>Relationships: - Belongs to <code>User</code> - Has many <code>WebhookDelivery</code></p> <p>Indexes: - Primary: <code>id</code> - Index: <code>userId</code> - Index: <code>isActive</code></p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete webhooks when user is deleted</p> <p>Events: - <code>2fa.enabled</code> - User enabled 2FA - <code>2fa.disabled</code> - User disabled 2FA - <code>2fa.verified</code> - 2FA verification succeeded - <code>2fa.failed</code> - 2FA verification failed - <code>user.login</code> - User logged in - <code>user.logout</code> - User logged out</p> <p>Notes: - Webhooks auto-disabled after 10 consecutive failures - Deliveries retried with exponential backoff</p>"},{"location":"architecture/database-schema/#webhookdelivery","title":"WebhookDelivery","text":"<p>Logs of webhook delivery attempts for debugging and monitoring.</p> Column Type Constraints Description <code>id</code> UUID Primary Key Delivery identifier <code>webhookId</code> UUID Foreign Key, Not Null References <code>Webhook.id</code> <code>event</code> String Not Null Event type <code>payload</code> String Not Null JSON payload sent <code>statusCode</code> Int Nullable HTTP response code <code>response</code> String Nullable Response body <code>attempt</code> Int Default: 1 Retry attempt number <code>success</code> Boolean Default: false Delivery succeeded <code>error</code> String Nullable Error message if failed <code>deliveredAt</code> Timestamp Default: now() Attempt timestamp <p>Relationships: - Belongs to <code>Webhook</code></p> <p>Indexes: - Primary: <code>id</code> - Index: <code>webhookId</code> - Index: <code>deliveredAt</code> - For cleanup queries</p> <p>Constraints: - <code>ON DELETE CASCADE</code> - Delete logs when webhook is deleted</p> <p>Notes: - Kept for 30 days (configurable) - Used for debugging delivery issues</p>"},{"location":"architecture/database-schema/#redis-data-structures","title":"Redis Data Structures","text":"<p>The following data is stored in Redis (not PostgreSQL) for performance and automatic expiration:</p>"},{"location":"architecture/database-schema/#otp-codes","title":"OTP Codes","text":"<p>Key: <code>otp:{userId}:{type}</code> (e.g., <code>otp:uuid:sms</code>)</p> <p>Value: <pre><code>{\n  \"code\": \"123456\",\n  \"expiresAt\": \"2024-10-19T12:05:00Z\",\n  \"attempts\": 0\n}\n</code></pre></p> <p>TTL: 5 minutes</p>"},{"location":"architecture/database-schema/#rate-limiting","title":"Rate Limiting","text":"<p>Key: <code>ratelimit:{endpoint}:{identifier}</code> (e.g., <code>ratelimit:/auth/login:192.168.1.1</code>)</p> <p>Value: Request count</p> <p>TTL: 15 minutes</p>"},{"location":"architecture/database-schema/#session-cache","title":"Session Cache","text":"<p>Key: <code>session:{sessionId}</code></p> <p>Value: <pre><code>{\n  \"userId\": \"uuid\",\n  \"refreshToken\": \"hashed_token\",\n  \"expiresAt\": \"2024-10-26T00:00:00Z\"\n}\n</code></pre></p> <p>TTL: 7 days</p>"},{"location":"architecture/database-schema/#device-token-cache","title":"Device Token Cache","text":"<p>Key: <code>device:{deviceToken}</code></p> <p>Value: <pre><code>{\n  \"userId\": \"uuid\",\n  \"deviceId\": \"uuid\",\n  \"expiresAt\": \"2024-11-18T00:00:00Z\"\n}\n</code></pre></p> <p>TTL: 30 days</p>"},{"location":"architecture/database-schema/#migrations","title":"Migrations","text":"<p>Database migrations are managed by Prisma Migrate.</p>"},{"location":"architecture/database-schema/#run-migrations","title":"Run Migrations","text":"<pre><code># Development\nnpx prisma migrate dev\n\n# Production\nnpx prisma migrate deploy\n</code></pre>"},{"location":"architecture/database-schema/#create-migration","title":"Create Migration","text":"<pre><code>npx prisma migrate dev --name descriptive_name\n</code></pre>"},{"location":"architecture/database-schema/#reset-database","title":"Reset Database","text":"<pre><code># WARNING: Deletes all data\nnpx prisma migrate reset\n</code></pre>"},{"location":"architecture/database-schema/#indexes-and-performance","title":"Indexes and Performance","text":""},{"location":"architecture/database-schema/#critical-indexes","title":"Critical Indexes","text":"Table Column(s) Type Purpose User email Unique Fast user lookup by email User username Unique Fast user lookup by username TwoFactorMethod (userId, type) Unique Prevent duplicate methods Session refreshToken Unique Fast session lookup Session expiresAt Index Cleanup expired sessions TrustedDevice deviceToken Unique Fast device lookup TrustedDevice expiresAt Index Cleanup expired devices AuditLog createdAt Index Time-based queries AuditLog action Index Filter by event type ApiKey keyHash Unique Fast API key validation"},{"location":"architecture/database-schema/#query-optimization","title":"Query Optimization","text":"<ul> <li>Connection Pooling: Prisma manages connection pool (max 10 connections)</li> <li>Prepared Statements: All queries use parameterized queries</li> <li>Selective Loading: Only load required fields/relations</li> <li>Pagination: Use cursor-based pagination for large result sets</li> </ul>"},{"location":"architecture/database-schema/#data-retention","title":"Data Retention","text":"Data Type Retention Period Cleanup Method OTP Codes 5 minutes Redis TTL Rate Limit Counters 15 minutes Redis TTL Expired Sessions 7 days + 1 day grace Background job Expired Devices 30 days + 7 day grace Background job Audit Logs 1 year Background job (configurable) Webhook Deliveries 30 days Background job Used Backup Codes Indefinite Manual cleanup"},{"location":"architecture/database-schema/#security-considerations","title":"Security Considerations","text":""},{"location":"architecture/database-schema/#sensitive-data","title":"Sensitive Data","text":"Field Protection <code>User.passwordHash</code> Argon2id hashing <code>TwoFactorMethod.secret</code> Encrypted at application level <code>BackupCode.codeHash</code> Bcrypt hashing <code>ApiKey.keyHash</code> Bcrypt hashing <code>Webhook.secret</code> Encrypted at application level"},{"location":"architecture/database-schema/#best-practices","title":"Best Practices","text":"<ul> <li>Never log sensitive fields (passwords, tokens, secrets)</li> <li>Use database-level encryption for <code>TwoFactorMethod.secret</code> and <code>Webhook.secret</code></li> <li>Regularly rotate encryption keys</li> <li>Enable PostgreSQL audit logging in production</li> <li>Use read replicas for non-critical queries</li> <li>Enable SSL/TLS for database connections</li> </ul>"},{"location":"architecture/database-schema/#next-steps","title":"Next Steps","text":"<ul> <li>System Architecture - High-level architecture</li> <li>Authentication Flow - Auth process details</li> <li>Security Architecture - Security controls</li> <li>Deployment Guide - Deploy to production</li> </ul>"},{"location":"architecture/overview/","title":"System Architecture","text":""},{"location":"architecture/overview/#overview","title":"Overview","text":"<p>The 2FA Authentication Service is a production-ready microservice built on a modern, scalable architecture. It provides enterprise-grade two-factor authentication capabilities through a RESTful API.</p>"},{"location":"architecture/overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph \"Client Layer\"\n        WEB[Web Application]\n        MOBILE[Mobile App]\n        API_CLIENT[Third-party Client]\n    end\n\n    subgraph \"API Gateway Layer\"\n        LB[Load Balancer]\n        NGINX[Nginx / Reverse Proxy]\n    end\n\n    subgraph \"Application Layer\"\n        BE1[Backend Instance 1]\n        BE2[Backend Instance 2]\n        BE3[Backend Instance N]\n        WORKER[Background Workers]\n    end\n\n    subgraph \"Service Layer\"\n        AUTH[Auth Service]\n        TFA[2FA Service]\n        WEBHOOK[Webhook Service]\n        AUDIT[Audit Service]\n    end\n\n    subgraph \"Data Layer\"\n        PG[(PostgreSQL)]\n        REDIS[(Redis)]\n    end\n\n    subgraph \"External Services\"\n        TWILIO[Twilio SMS]\n        SMTP[SMTP Email]\n    end\n\n    WEB --&gt; LB\n    MOBILE --&gt; LB\n    API_CLIENT --&gt; LB\n    LB --&gt; NGINX\n    NGINX --&gt; BE1\n    NGINX --&gt; BE2\n    NGINX --&gt; BE3\n\n    BE1 --&gt; AUTH\n    BE2 --&gt; AUTH\n    BE3 --&gt; AUTH\n\n    BE1 --&gt; TFA\n    BE2 --&gt; TFA\n    BE3 --&gt; TFA\n\n    WORKER --&gt; WEBHOOK\n    WORKER --&gt; AUDIT\n\n    AUTH --&gt; PG\n    AUTH --&gt; REDIS\n    TFA --&gt; PG\n    TFA --&gt; REDIS\n    WEBHOOK --&gt; PG\n    AUDIT --&gt; PG\n\n    TFA -.-&gt;|SMS 2FA| TWILIO\n    TFA -.-&gt;|Email 2FA| SMTP\n    WEBHOOK -.-&gt;|Notifications| SMTP</code></pre>"},{"location":"architecture/overview/#component-breakdown","title":"Component Breakdown","text":""},{"location":"architecture/overview/#1-client-layer","title":"1. Client Layer","text":"<p>Purpose: Applications that consume the 2FA service</p> <ul> <li>Web Applications: Next.js frontend (included) or custom web apps</li> <li>Mobile Apps: iOS, Android, React Native, Flutter</li> <li>Third-party Clients: Services integrating via API keys</li> </ul>"},{"location":"architecture/overview/#2-api-gateway-layer","title":"2. API Gateway Layer","text":"<p>Purpose: Traffic routing and load balancing</p> <ul> <li>Load Balancer: Distributes requests across backend instances</li> <li>Reverse Proxy: Nginx for SSL termination, static content, rate limiting</li> <li>Features:</li> <li>SSL/TLS termination</li> <li>Request routing</li> <li>Static file serving</li> <li>Compression</li> </ul>"},{"location":"architecture/overview/#3-application-layer","title":"3. Application Layer","text":"<p>Purpose: Core business logic execution</p>"},{"location":"architecture/overview/#backend-instances","title":"Backend Instances","text":"<ul> <li>Node.js/Express applications</li> <li>Horizontally scalable</li> <li>Stateless design (sessions in Redis)</li> <li>JWT-based authentication</li> </ul>"},{"location":"architecture/overview/#background-workers","title":"Background Workers","text":"<ul> <li>BullMQ job processors</li> <li>Handles async operations:</li> <li>Webhook delivery</li> <li>Email sending</li> <li>Audit log processing</li> <li>Cleanup tasks</li> </ul>"},{"location":"architecture/overview/#4-service-layer","title":"4. Service Layer","text":"<p>Purpose: Domain-specific business logic</p>"},{"location":"architecture/overview/#authentication-service","title":"Authentication Service","text":"<ul> <li>User registration and login</li> <li>Password hashing (Argon2id)</li> <li>JWT token management</li> <li>Session management</li> </ul>"},{"location":"architecture/overview/#2fa-service","title":"2FA Service","text":"<ul> <li>TOTP generation and verification</li> <li>SMS OTP delivery</li> <li>Email OTP delivery</li> <li>Backup code management</li> <li>Trusted device tracking</li> </ul>"},{"location":"architecture/overview/#webhook-service","title":"Webhook Service","text":"<ul> <li>Event notification delivery</li> <li>HMAC signature generation</li> <li>Retry logic with exponential backoff</li> <li>Delivery tracking</li> </ul>"},{"location":"architecture/overview/#audit-service","title":"Audit Service","text":"<ul> <li>Security event logging</li> <li>User activity tracking</li> <li>Compliance monitoring</li> </ul>"},{"location":"architecture/overview/#5-data-layer","title":"5. Data Layer","text":"<p>Purpose: Persistent and transient data storage</p>"},{"location":"architecture/overview/#postgresql","title":"PostgreSQL","text":"<ul> <li>Primary data store</li> <li>User accounts</li> <li>2FA settings</li> <li>API keys</li> <li>Webhooks</li> <li>Audit logs</li> <li>Connection pooling via Prisma</li> </ul>"},{"location":"architecture/overview/#redis","title":"Redis","text":"<ul> <li>OTP code storage (temporary)</li> <li>Rate limiting counters</li> <li>Session storage</li> <li>Job queue (BullMQ)</li> <li>Cache layer</li> </ul>"},{"location":"architecture/overview/#6-external-services","title":"6. External Services","text":"<p>Purpose: Third-party integrations</p> <ul> <li>Twilio: SMS delivery for SMS 2FA</li> <li>SMTP: Email delivery for Email 2FA</li> <li>Optional: Can be disabled for TOTP-only deployments</li> </ul>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":""},{"location":"architecture/overview/#request-flow","title":"Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant LB as Load Balancer\n    participant API as Backend API\n    participant Service as Service Layer\n    participant DB as PostgreSQL\n    participant Cache as Redis\n\n    Client-&gt;&gt;LB: HTTP Request\n    LB-&gt;&gt;API: Route to instance\n    API-&gt;&gt;API: Validate request\n    API-&gt;&gt;Cache: Check cache\n    alt Cache hit\n        Cache--&gt;&gt;API: Return cached data\n    else Cache miss\n        API-&gt;&gt;Service: Process request\n        Service-&gt;&gt;DB: Query data\n        DB--&gt;&gt;Service: Return data\n        Service-&gt;&gt;Cache: Update cache\n        Service--&gt;&gt;API: Return result\n    end\n    API--&gt;&gt;LB: HTTP Response\n    LB--&gt;&gt;Client: Return response</code></pre>"},{"location":"architecture/overview/#authentication-flow","title":"Authentication Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant AuthSvc as Auth Service\n    participant DB as PostgreSQL\n    participant Redis\n\n    Client-&gt;&gt;API: POST /auth/login\n    API-&gt;&gt;AuthSvc: Validate credentials\n    AuthSvc-&gt;&gt;DB: Query user\n    DB--&gt;&gt;AuthSvc: User data\n    AuthSvc-&gt;&gt;AuthSvc: Verify password (Argon2)\n\n    alt Password valid\n        AuthSvc-&gt;&gt;DB: Check 2FA status\n        alt 2FA enabled\n            AuthSvc-&gt;&gt;Redis: Store temp token\n            AuthSvc--&gt;&gt;API: Return temp token\n            API--&gt;&gt;Client: 200 {tempToken, requires2FA: true}\n        else 2FA disabled\n            AuthSvc-&gt;&gt;AuthSvc: Generate JWT tokens\n            AuthSvc-&gt;&gt;Redis: Store session\n            AuthSvc--&gt;&gt;API: Return tokens\n            API--&gt;&gt;Client: 200 {accessToken, refreshToken}\n        end\n    else Password invalid\n        AuthSvc--&gt;&gt;API: Unauthorized\n        API--&gt;&gt;Client: 401 Unauthorized\n    end</code></pre>"},{"location":"architecture/overview/#deployment-architectures","title":"Deployment Architectures","text":""},{"location":"architecture/overview/#single-instance-development","title":"Single Instance (Development)","text":"<pre><code>graph LR\n    CLIENT[Client] --&gt; BACKEND[Backend + Frontend]\n    BACKEND --&gt; PG[(PostgreSQL)]\n    BACKEND --&gt; REDIS[(Redis)]</code></pre> <p>Use case: Local development, testing</p> <p>Resources: Docker Compose, 2GB RAM</p>"},{"location":"architecture/overview/#free-tier-zero-budget","title":"Free Tier (Zero Budget)","text":"<pre><code>graph LR\n    CLIENT[Client] --&gt; RAILWAY[Railway/Render]\n    RAILWAY --&gt; SUPABASE[(Supabase PG)]\n    RAILWAY --&gt; UPSTASH[(Upstash Redis)]</code></pre> <p>Use case: Small projects, POC, &lt; 100 users</p> <p>Cost: $0/month</p> <p>Limitations: - Single instance - 500-750 hours/month - 10MB Redis - Cold starts</p>"},{"location":"architecture/overview/#production-small-scale","title":"Production (Small Scale)","text":"<pre><code>graph TB\n    CLIENT[Client] --&gt; CF[Cloudflare CDN]\n    CF --&gt; LB[Load Balancer]\n    LB --&gt; BE1[Backend 1]\n    LB --&gt; BE2[Backend 2]\n    BE1 --&gt; PG[(PostgreSQL)]\n    BE2 --&gt; PG\n    BE1 --&gt; REDIS[(Redis)]\n    BE2 --&gt; REDIS\n    WORKER[Worker] --&gt; PG\n    WORKER --&gt; REDIS</code></pre> <p>Use case: Production apps, 1K-10K users</p> <p>Cost: $25-50/month</p> <p>Features: - Multiple instances - Auto-scaling - High availability - Monitoring</p>"},{"location":"architecture/overview/#production-enterprise","title":"Production (Enterprise)","text":"<pre><code>graph TB\n    CLIENT[Client] --&gt; CDN[CDN]\n    CDN --&gt; WAF[WAF]\n    WAF --&gt; ALB[Application Load Balancer]\n\n    subgraph \"Application Tier\"\n        BE1[Backend 1]\n        BE2[Backend 2]\n        BE3[Backend 3]\n    end\n\n    subgraph \"Worker Tier\"\n        W1[Worker 1]\n        W2[Worker 2]\n    end\n\n    subgraph \"Data Tier\"\n        PRIMARY[(Primary DB)]\n        REPLICA1[(Read Replica 1)]\n        REPLICA2[(Read Replica 2)]\n        REDIS_CLUSTER[Redis Cluster]\n    end\n\n    ALB --&gt; BE1\n    ALB --&gt; BE2\n    ALB --&gt; BE3\n\n    BE1 --&gt; PRIMARY\n    BE2 --&gt; PRIMARY\n    BE3 --&gt; PRIMARY\n\n    BE1 --&gt; REPLICA1\n    BE2 --&gt; REPLICA2\n    BE3 --&gt; REPLICA1\n\n    BE1 --&gt; REDIS_CLUSTER\n    BE2 --&gt; REDIS_CLUSTER\n    BE3 --&gt; REDIS_CLUSTER\n\n    W1 --&gt; PRIMARY\n    W2 --&gt; PRIMARY\n    W1 --&gt; REDIS_CLUSTER\n    W2 --&gt; REDIS_CLUSTER</code></pre> <p>Use case: Enterprise, 100K+ users</p> <p>Cost: $500+/month</p> <p>Features: - Multi-region deployment - Database replication - Redis cluster - WAF protection - DDoS mitigation - 99.9% SLA</p>"},{"location":"architecture/overview/#technology-stack","title":"Technology Stack","text":""},{"location":"architecture/overview/#backend","title":"Backend","text":"<ul> <li>Runtime: Node.js 18+</li> <li>Framework: Express.js</li> <li>Language: TypeScript</li> <li>ORM: Prisma</li> <li>Validation: Zod</li> <li>Authentication: JWT (jsonwebtoken)</li> <li>Password Hashing: Argon2id</li> <li>Job Queue: BullMQ</li> </ul>"},{"location":"architecture/overview/#frontend","title":"Frontend","text":"<ul> <li>Framework: Next.js 15</li> <li>Language: TypeScript</li> <li>Styling: Tailwind CSS</li> <li>UI Components: shadcn/ui</li> <li>State: React Context</li> <li>HTTP Client: Axios</li> </ul>"},{"location":"architecture/overview/#infrastructure","title":"Infrastructure","text":"<ul> <li>Database: PostgreSQL 14+</li> <li>Cache: Redis 6+</li> <li>Container: Docker</li> <li>Orchestration: Docker Compose / Kubernetes</li> <li>CI/CD: GitHub Actions</li> </ul>"},{"location":"architecture/overview/#external-services","title":"External Services","text":"<ul> <li>SMS: Twilio (optional)</li> <li>Email: SMTP / Nodemailer</li> <li>Monitoring: Custom health checks</li> </ul>"},{"location":"architecture/overview/#security-architecture","title":"Security Architecture","text":""},{"location":"architecture/overview/#defense-in-depth","title":"Defense in Depth","text":"<pre><code>graph TB\n    subgraph \"Layer 1: Network\"\n        FIREWALL[Firewall Rules]\n        DDOS[DDoS Protection]\n    end\n\n    subgraph \"Layer 2: Application\"\n        RATELIMIT[Rate Limiting]\n        CSRF[CSRF Protection]\n        HELMET[Security Headers]\n    end\n\n    subgraph \"Layer 3: Authentication\"\n        JWT[JWT Tokens]\n        TFA[2FA Verification]\n        SESSION[Session Management]\n    end\n\n    subgraph \"Layer 4: Authorization\"\n        RBAC[Role-Based Access]\n        APIKEY[API Key Scopes]\n    end\n\n    subgraph \"Layer 5: Data\"\n        ENCRYPTION[At-Rest Encryption]\n        HASHING[Password Hashing]\n        PARAMETERIZED[Parameterized Queries]\n    end\n\n    FIREWALL --&gt; RATELIMIT\n    DDOS --&gt; CSRF\n    RATELIMIT --&gt; JWT\n    CSRF --&gt; TFA\n    JWT --&gt; RBAC\n    TFA --&gt; APIKEY\n    RBAC --&gt; ENCRYPTION\n    APIKEY --&gt; HASHING</code></pre>"},{"location":"architecture/overview/#security-features","title":"Security Features","text":"<ul> <li>Password Security: Argon2id with configurable memory, iterations, parallelism</li> <li>JWT Security: Short-lived access tokens (15 min), rotating refresh tokens</li> <li>2FA Methods: TOTP, SMS, Email, Backup codes, Trusted devices</li> <li>Rate Limiting: Per-endpoint limits, IP-based, user-based</li> <li>CSRF Protection: Double-submit cookie pattern</li> <li>Security Headers: Helmet.js (CSP, HSTS, X-Frame-Options)</li> <li>Input Validation: Zod schemas, sanitization</li> <li>SQL Injection Prevention: Prisma ORM with parameterized queries</li> <li>Audit Logging: All security events tracked</li> </ul>"},{"location":"architecture/overview/#scalability","title":"Scalability","text":""},{"location":"architecture/overview/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>The service is designed for horizontal scaling:</p> <ul> <li>Stateless Design: All state in PostgreSQL/Redis</li> <li>Session Storage: Redis-backed sessions</li> <li>Load Balancing: Round-robin, least connections</li> <li>Auto-scaling: Based on CPU, memory, request rate</li> </ul>"},{"location":"architecture/overview/#performance-optimizations","title":"Performance Optimizations","text":"<ul> <li>Worker Pool: Piscina for CPU-intensive operations (password hashing)</li> <li>Connection Pooling: Prisma connection pool</li> <li>Caching: Redis for frequently accessed data</li> <li>Async Processing: BullMQ for background jobs</li> <li>Compression: gzip/brotli for responses</li> </ul>"},{"location":"architecture/overview/#resource-limits","title":"Resource Limits","text":"Deployment Users RPS Database Redis Free Tier 100 10 500MB 10MB Small 1,000 50 2GB 100MB Medium 10,000 200 10GB 1GB Large 100,000+ 1,000+ 100GB+ 10GB+"},{"location":"architecture/overview/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"architecture/overview/#health-checks","title":"Health Checks","text":"<ul> <li><code>/api/health</code> - Overall health</li> <li><code>/api/health/live</code> - Liveness probe</li> <li><code>/api/health/ready</code> - Readiness probe</li> </ul>"},{"location":"architecture/overview/#metrics","title":"Metrics","text":"<ul> <li>Request rate</li> <li>Response time (p50, p95, p99)</li> <li>Error rate</li> <li>Database query performance</li> <li>Redis hit/miss ratio</li> <li>Worker queue depth</li> </ul>"},{"location":"architecture/overview/#logging","title":"Logging","text":"<ul> <li>Application logs (Winston)</li> <li>Audit logs (database)</li> <li>Access logs (Nginx)</li> <li>Error tracking</li> </ul>"},{"location":"architecture/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication Flow - Detailed authentication process</li> <li>Database Schema - Data model and relationships</li> <li>Security Architecture - Security controls and best practices</li> <li>Deployment Guide - Deploy to production</li> </ul>"},{"location":"architecture/security/","title":"Security Architecture","text":""},{"location":"architecture/security/#security-overview","title":"Security Overview","text":"<p>The 2FA Authentication Service implements defense-in-depth security with multiple layers of protection:</p> <pre><code>graph TB\n    subgraph \"Layer 1: Network Security\"\n        FIREWALL[Firewall]\n        DDOS[DDoS Protection]\n        SSL[SSL/TLS]\n    end\n\n    subgraph \"Layer 2: Application Security\"\n        CORS[CORS Policy]\n        RATELIMIT[Rate Limiting]\n        CSRF[CSRF Protection]\n        HELMET[Security Headers]\n        VALIDATION[Input Validation]\n    end\n\n    subgraph \"Layer 3: Authentication\"\n        JWT[JWT Tokens]\n        ARGON[Argon2 Hashing]\n        TFA[Two-Factor Auth]\n    end\n\n    subgraph \"Layer 4: Authorization\"\n        RBAC[Scope-based Access]\n        APIKEY[API Key Validation]\n    end\n\n    subgraph \"Layer 5: Data Security\"\n        ENCRYPTION[Encryption at Rest]\n        PARAMETERIZED[Parameterized Queries]\n        AUDIT[Audit Logging]\n    end\n\n    FIREWALL --&gt; CORS\n    DDOS --&gt; RATELIMIT\n    SSL --&gt; CSRF\n    RATELIMIT --&gt; JWT\n    CSRF --&gt; ARGON\n    HELMET --&gt; TFA\n    VALIDATION --&gt; TFA\n    JWT --&gt; RBAC\n    ARGON --&gt; APIKEY\n    TFA --&gt; ENCRYPTION\n    RBAC --&gt; PARAMETERIZED\n    APIKEY --&gt; AUDIT</code></pre>"},{"location":"architecture/security/#authentication-security","title":"Authentication Security","text":""},{"location":"architecture/security/#password-security","title":"Password Security","text":""},{"location":"architecture/security/#hashing-algorithm","title":"Hashing Algorithm","text":"<p>Argon2id - Winner of the Password Hashing Competition (2015)</p> <pre><code>// Configuration\n{\n  type: argon2.argon2id,\n  memoryCost: 2 ** 16,  // 64 MB\n  timeCost: 3,           // 3 iterations\n  parallelism: 4         // 4 threads\n}\n</code></pre> <p>Why Argon2id? - Resistant to GPU cracking attacks (memory-hard) - Resistant to side-channel attacks - Configurable resource requirements - More secure than bcrypt, scrypt, or PBKDF2</p>"},{"location":"architecture/security/#worker-pool-pattern","title":"Worker Pool Pattern","text":"<p>Password hashing is CPU-intensive and can block the event loop:</p> <pre><code>sequenceDiagram\n    participant Request\n    participant API\n    participant Piscina as Worker Pool\n    participant Worker1 as Argon2 Worker\n\n    Request-&gt;&gt;API: Login request\n    API-&gt;&gt;Piscina: Queue hash verification\n    Piscina-&gt;&gt;Worker1: Assign to worker\n    Worker1-&gt;&gt;Worker1: Hash password (60-300ms)\n    Worker1--&gt;&gt;Piscina: Result\n    Piscina--&gt;&gt;API: Password verified\n    API--&gt;&gt;Request: Response\n\n    Note over API: Main thread never blocked</code></pre> <p>Benefits: - Main thread remains responsive - Multiple requests processed in parallel - CPU-intensive work isolated to worker threads</p>"},{"location":"architecture/security/#password-requirements","title":"Password Requirements","text":"<ul> <li>Minimum 8 characters</li> <li>At least one uppercase letter</li> <li>At least one lowercase letter</li> <li>At least one number</li> <li>At least one special character</li> </ul> <p>Validation: <pre><code>^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&amp;])[A-Za-z\\d@$!%*?&amp;]{8,}$\n</code></pre></p>"},{"location":"architecture/security/#jwt-security","title":"JWT Security","text":""},{"location":"architecture/security/#token-types","title":"Token Types","text":"Token Lifetime Storage Algorithm Access Token 15 minutes Client memory HS256 Refresh Token 7 days Database + HttpOnly cookie HS256 Temp Token 5 minutes Redis only HS256 Device Token 30 days Database + Client storage HS256"},{"location":"architecture/security/#token-structure","title":"Token Structure","text":"<p>Access Token: <pre><code>{\n  \"header\": {\n    \"alg\": \"HS256\",\n    \"typ\": \"JWT\"\n  },\n  \"payload\": {\n    \"userId\": \"uuid\",\n    \"email\": \"user@example.com\",\n    \"iat\": 1697654400,\n    \"exp\": 1697655300\n  }\n}\n</code></pre></p> <p>Refresh Token: <pre><code>{\n  \"payload\": {\n    \"userId\": \"uuid\",\n    \"sessionId\": \"uuid\",\n    \"tokenVersion\": 1,\n    \"iat\": 1697654400,\n    \"exp\": 1698259200\n  }\n}\n</code></pre></p>"},{"location":"architecture/security/#secret-requirements","title":"Secret Requirements","text":"<ul> <li>Minimum 64 characters</li> <li>Cryptographically random (crypto.randomBytes)</li> <li>Different secrets for each token type</li> <li>Stored in environment variables (never in code)</li> <li>Rotated periodically</li> </ul> <p>Generation: <pre><code>node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\n</code></pre></p>"},{"location":"architecture/security/#token-revocation","title":"Token Revocation","text":"<p>Refresh Tokens: - Stored in database - Can be revoked individually or all at once - Automatically cleaned up on expiration</p> <p>Access Tokens: - Cannot be revoked (short-lived by design) - Compromise mitigated by 15-minute expiration</p>"},{"location":"architecture/security/#two-factor-authentication","title":"Two-Factor Authentication","text":""},{"location":"architecture/security/#totp-time-based-one-time-password","title":"TOTP (Time-based One-Time Password)","text":"<pre><code>sequenceDiagram\n    participant User\n    participant App as Authenticator App\n    participant Server\n    participant Time as Time Source\n\n    Note over User,Time: Setup Phase\n    Server-&gt;&gt;Server: Generate secret key\n    Server-&gt;&gt;User: Display QR code\n    User-&gt;&gt;App: Scan QR code\n    App-&gt;&gt;App: Store secret\n\n    Note over User,Time: Verification Phase\n    Time-&gt;&gt;App: Current timestamp\n    App-&gt;&gt;App: HMAC-SHA1(secret, time/30)\n    App-&gt;&gt;App: Extract 6 digits\n    App-&gt;&gt;User: Display code\n    User-&gt;&gt;Server: Enter code\n\n    Time-&gt;&gt;Server: Current timestamp\n    Server-&gt;&gt;Server: HMAC-SHA1(secret, time/30)\n    Server-&gt;&gt;Server: Extract 6 digits\n    Server-&gt;&gt;Server: Compare codes (\u00b11 window)\n\n    alt Codes match\n        Server--&gt;&gt;User: Verified\n    else Codes mismatch\n        Server--&gt;&gt;User: Invalid code\n    end</code></pre> <p>Security Features: - Secret stored encrypted in database - 30-second time window - \u00b11 window drift tolerance (prevents clock skew issues) - Rate limiting (10 attempts per 15 minutes) - No internet connection required</p>"},{"location":"architecture/security/#sms-2fa","title":"SMS 2FA","text":"<p>Security Considerations: - Less secure than TOTP (vulnerable to SIM swapping) - 6-digit random code - 5-minute expiration - Stored in Redis with TTL - Rate limiting (5 SMS per hour) - Recommended only as fallback</p> <p>Twilio Integration: - Verified sender numbers - Message encryption in transit - Delivery confirmation</p>"},{"location":"architecture/security/#email-2fa","title":"Email 2FA","text":"<p>Security Features: - 6-digit random code - 5-minute expiration - Stored in Redis with TTL - Rate limiting (10 emails per hour) - From address verification (SPF/DKIM)</p>"},{"location":"architecture/security/#backup-codes","title":"Backup Codes","text":"<p>Generation: - 10 codes per set - 10-character alphanumeric - Cryptographically random - Hashed before storage (bcrypt)</p> <p>Usage: - Single-use only - Marked as used (not deleted) - Can regenerate new set - Recommended to store offline</p>"},{"location":"architecture/security/#trusted-devices","title":"Trusted Devices","text":"<p>Security: - 30-day JWT token - Bound to IP + User-Agent - Stored in database for revocation - Can be removed individually or all - Automatically expired</p>"},{"location":"architecture/security/#authorization-security","title":"Authorization Security","text":""},{"location":"architecture/security/#scope-based-access-control","title":"Scope-based Access Control","text":"<p>API keys can have limited scopes:</p> <pre><code>const scopes = [\n  '2fa:read',      // View 2FA status\n  '2fa:write',     // Enable/disable 2FA\n  'webhooks:read', // View webhooks\n  'webhooks:write',// Manage webhooks\n  'user:read',     // View profile\n  'user:write'     // Update profile\n]\n</code></pre> <p>Scope Validation: <pre><code>// Middleware checks required scope\nfunction requireScope(scope) {\n  return (req, res, next) =&gt; {\n    if (!req.apiKey.scopes.includes(scope)) {\n      return res.status(403).json({ error: 'Insufficient permissions' })\n    }\n    next()\n  }\n}\n</code></pre></p>"},{"location":"architecture/security/#api-key-security","title":"API Key Security","text":"<p>Format: <code>pk_live_&lt;random_32_chars&gt;</code></p> <p>Storage: - Full key shown only once on creation - Hashed before storage (bcrypt) - Prefix stored for identification - Last 4 characters shown in UI</p> <p>Validation Flow: <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant Cache as Redis\n    participant DB as PostgreSQL\n\n    Client-&gt;&gt;API: X-API-Key: pk_live_abc123...\n    API-&gt;&gt;Cache: Check cached key\n\n    alt Cache hit\n        Cache--&gt;&gt;API: Key data\n    else Cache miss\n        API-&gt;&gt;DB: Query by hash\n        DB--&gt;&gt;API: Key data\n        API-&gt;&gt;Cache: Cache (1 hour TTL)\n    end\n\n    API-&gt;&gt;API: Verify not expired\n    API-&gt;&gt;API: Verify isActive\n    API-&gt;&gt;API: Check scopes\n    API-&gt;&gt;API: Check rate limit\n\n    alt All checks pass\n        API-&gt;&gt;API: Process request\n    else Check fails\n        API--&gt;&gt;Client: 401/403 Error\n    end</code></pre></p>"},{"location":"architecture/security/#network-security","title":"Network Security","text":""},{"location":"architecture/security/#cors-cross-origin-resource-sharing","title":"CORS (Cross-Origin Resource Sharing)","text":"<pre><code>{\n  origin: process.env.CORS_ORIGINS?.split(',') || '*',\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-API-Key']\n}\n</code></pre> <p>Production Configuration: <pre><code>CORS_ORIGINS=https://app.example.com,https://admin.example.com\n</code></pre></p>"},{"location":"architecture/security/#csrf-protection","title":"CSRF Protection","text":"<p>Double-Submit Cookie Pattern:</p> <pre><code>// Generate CSRF token\nconst csrfToken = crypto.randomBytes(32).toString('hex')\n\n// Set in cookie\nres.cookie('csrf-token', csrfToken, {\n  httpOnly: true,\n  secure: true,\n  sameSite: 'strict'\n})\n\n// Client must send in header\nheaders: {\n  'X-CSRF-Token': csrfToken\n}\n</code></pre> <p>Protected Endpoints: - All state-changing operations (POST, PUT, DELETE) - Login, registration, 2FA operations</p>"},{"location":"architecture/security/#rate-limiting","title":"Rate Limiting","text":"<pre><code>graph TB\n    Request[Incoming Request] --&gt; Extract[Extract Identifier]\n    Extract --&gt; IP[IP Address]\n    Extract --&gt; User[User ID]\n    Extract --&gt; API[API Key]\n\n    IP --&gt; Check{Check Redis Counter}\n    User --&gt; Check\n    API --&gt; Check\n\n    Check --&gt;|Under Limit| Increment[Increment Counter]\n    Check --&gt;|Over Limit| Block[429 Too Many Requests]\n\n    Increment --&gt; Allow[Process Request]</code></pre> <p>Rate Limits:</p> Endpoint Limit Window <code>/auth/register</code> 5 requests 15 minutes <code>/auth/login</code> 5 requests 15 minutes <code>/2fa/verify</code> 10 requests 15 minutes <code>/2fa/send-code</code> 5 requests 1 hour Default 100 requests 15 minutes <p>Implementation: <pre><code>// Redis-based sliding window\nconst key = `ratelimit:${endpoint}:${identifier}`\nconst count = await redis.incr(key)\nif (count === 1) {\n  await redis.expire(key, windowSeconds)\n}\nif (count &gt; limit) {\n  throw new TooManyRequestsError()\n}\n</code></pre></p>"},{"location":"architecture/security/#security-headers-helmetjs","title":"Security Headers (Helmet.js)","text":"<pre><code>helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      scriptSrc: [\"'self'\", \"'unsafe-inline'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      imgSrc: [\"'self'\", 'data:', 'https:'],\n    }\n  },\n  hsts: {\n    maxAge: 31536000,\n    includeSubDomains: true,\n    preload: true\n  },\n  frameguard: { action: 'deny' },\n  noSniff: true,\n  xssFilter: true\n})\n</code></pre> <p>Headers Applied: - <code>Content-Security-Policy</code> - Prevent XSS - <code>Strict-Transport-Security</code> - Enforce HTTPS - <code>X-Frame-Options: DENY</code> - Prevent clickjacking - <code>X-Content-Type-Options: nosniff</code> - Prevent MIME sniffing - <code>X-XSS-Protection: 1; mode=block</code> - Browser XSS protection</p>"},{"location":"architecture/security/#data-security","title":"Data Security","text":""},{"location":"architecture/security/#input-validation","title":"Input Validation","text":"<p>Zod Schemas:</p> <pre><code>const registerSchema = z.object({\n  email: z.string().email(),\n  username: z.string().min(3).max(30).regex(/^[a-zA-Z0-9_]+$/),\n  password: z.string().min(8).regex(passwordRegex)\n})\n</code></pre> <p>Validation Flow: 1. Parse request body with Zod 2. Validate against schema 3. Sanitize inputs (trim, escape) 4. Type-safe usage in application</p>"},{"location":"architecture/security/#sql-injection-prevention","title":"SQL Injection Prevention","text":"<p>Prisma ORM - All queries are parameterized:</p> <pre><code>// Safe - parameterized query\nawait prisma.user.findUnique({\n  where: { email: userInput }\n})\n\n// Never do this - vulnerable to injection\nawait prisma.$executeRaw(`SELECT * FROM users WHERE email = '${userInput}'`)\n</code></pre>"},{"location":"architecture/security/#encryption-at-rest","title":"Encryption at Rest","text":"<p>Sensitive Fields: - <code>TwoFactorMethod.secret</code> - TOTP secrets - <code>Webhook.secret</code> - Webhook HMAC secrets</p> <p>Encryption: <pre><code>const algorithm = 'aes-256-gcm'\nconst key = crypto.scryptSync(ENCRYPTION_KEY, 'salt', 32)\n\nfunction encrypt(text) {\n  const iv = crypto.randomBytes(16)\n  const cipher = crypto.createCipheriv(algorithm, key, iv)\n  const encrypted = Buffer.concat([cipher.update(text, 'utf8'), cipher.final()])\n  const authTag = cipher.getAuthTag()\n  return iv.toString('hex') + ':' + authTag.toString('hex') + ':' + encrypted.toString('hex')\n}\n</code></pre></p>"},{"location":"architecture/security/#audit-logging","title":"Audit Logging","text":"<p>Logged Events: - All authentication attempts (success/failure) - 2FA enable/disable/verify - Password changes - API key creation/revocation - Webhook creation/modification - Session creation/deletion</p> <p>Log Format: <pre><code>{\n  \"id\": \"uuid\",\n  \"userId\": \"uuid\",\n  \"action\": \"2fa_enabled\",\n  \"details\": {\n    \"method\": \"totp\",\n    \"backupCodesGenerated\": 10\n  },\n  \"ipAddress\": \"192.168.1.1\",\n  \"userAgent\": \"Mozilla/5.0...\",\n  \"success\": true,\n  \"createdAt\": \"2024-10-19T12:00:00Z\"\n}\n</code></pre></p> <p>Retention: 1 year (configurable)</p>"},{"location":"architecture/security/#webhook-security","title":"Webhook Security","text":""},{"location":"architecture/security/#hmac-signatures","title":"HMAC Signatures","text":"<p>Every webhook request includes an HMAC signature:</p> <pre><code>const signature = crypto\n  .createHmac('sha256', webhookSecret)\n  .update(JSON.stringify(payload))\n  .digest('hex')\n\nheaders: {\n  'X-Webhook-Signature': `sha256=${signature}`\n}\n</code></pre> <p>Verification: <pre><code>function verifyWebhook(payload, signature, secret) {\n  const expected = crypto\n    .createHmac('sha256', secret)\n    .update(JSON.stringify(payload))\n    .digest('hex')\n\n  return crypto.timingSafeEqual(\n    Buffer.from(signature),\n    Buffer.from(expected)\n  )\n}\n</code></pre></p>"},{"location":"architecture/security/#webhook-security-best-practices","title":"Webhook Security Best Practices","text":"<ul> <li>Always verify HMAC signature</li> <li>Use HTTPS endpoints only</li> <li>Implement idempotency (webhook may be retried)</li> <li>Rate limit incoming webhooks</li> <li>Timeout requests after 5 seconds</li> </ul>"},{"location":"architecture/security/#compliance-best-practices","title":"Compliance &amp; Best Practices","text":""},{"location":"architecture/security/#owasp-top-10-protection","title":"OWASP Top 10 Protection","text":"Risk Mitigation A01: Broken Access Control JWT validation, scope-based authorization A02: Cryptographic Failures Argon2id, AES-256-GCM, TLS 1.2+ A03: Injection Parameterized queries, input validation A04: Insecure Design 2FA, rate limiting, audit logging A05: Security Misconfiguration Security headers, CORS, environment-based config A06: Vulnerable Components Automated dependency scanning, regular updates A07: Authentication Failures Strong password policy, 2FA, account lockout A08: Software and Data Integrity Webhook signatures, npm audit, SRI A09: Security Logging Failures Comprehensive audit logging, monitoring A10: Server-Side Request Forgery URL validation, webhook allowlist"},{"location":"architecture/security/#security-checklist","title":"Security Checklist","text":"<p>Development: - [ ] No secrets in code or version control - [ ] All dependencies up to date - [ ] npm audit passing - [ ] All tests passing - [ ] Code review completed</p> <p>Deployment: - [ ] SSL/TLS enabled (HTTPS only) - [ ] Strong JWT secrets (64+ chars) - [ ] CORS configured for production domains - [ ] Rate limiting enabled - [ ] Database backups automated - [ ] Audit logging enabled - [ ] Monitoring and alerting configured</p> <p>Ongoing: - [ ] Regular dependency updates - [ ] Security patch deployment - [ ] Audit log review - [ ] Penetration testing - [ ] Incident response plan</p>"},{"location":"architecture/security/#incident-response","title":"Incident Response","text":""},{"location":"architecture/security/#security-incident-workflow","title":"Security Incident Workflow","text":"<pre><code>graph TB\n    Detect[Detect Incident] --&gt; Assess[Assess Impact]\n    Assess --&gt; Contain[Contain Threat]\n    Contain --&gt; Investigate[Investigate]\n    Investigate --&gt; Remediate[Remediate]\n    Remediate --&gt; Learn[Post-Incident Review]\n\n    Contain --&gt; Notify{User Data&lt;br/&gt;Compromised?}\n    Notify --&gt;|Yes| NotifyUsers[Notify Affected Users]\n    Notify --&gt;|No| Document[Document Incident]\n    NotifyUsers --&gt; Document</code></pre>"},{"location":"architecture/security/#emergency-actions","title":"Emergency Actions","text":"<p>Suspected Token Compromise: <pre><code># Revoke all refresh tokens for user\nDELETE FROM sessions WHERE user_id = '&lt;user_id&gt;';\n\n# Rotate JWT secrets (invalidates all access tokens)\n# Update environment variables and restart service\n</code></pre></p> <p>Suspected Database Breach: <pre><code># Force password reset for all users\nUPDATE users SET password_hash = NULL, is_active = false;\n\n# Notify all users\n# Send password reset emails\n</code></pre></p> <p>DDoS Attack: <pre><code># Enable aggressive rate limiting\n# Block offending IP ranges at firewall level\n# Enable Cloudflare DDoS protection\n</code></pre></p>"},{"location":"architecture/security/#security-contacts","title":"Security Contacts","text":"<ul> <li>Security Issues: security@example.com</li> <li>Bug Reports: https://github.com/Ilia01/Aegis2FA/issues</li> <li>Security Policy: https://github.com/Ilia01/Aegis2FA/security/policy</li> </ul>"},{"location":"architecture/security/#next-steps","title":"Next Steps","text":"<ul> <li>System Architecture - High-level architecture</li> <li>Authentication Flow - Auth process details</li> <li>Database Schema - Data model</li> <li>Deployment Guide - Secure deployment</li> </ul>"},{"location":"getting-started/installation/","title":"Deployment Guide","text":"<p>Complete deployment guide for the 2FA Authentication Service with various deployment options.</p>"},{"location":"getting-started/installation/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Quick Deploy (Zero Budget)</li> <li>Production Deployment</li> <li>Cloud Platforms</li> <li>Environment Variables</li> <li>Database Setup</li> <li>SSL/HTTPS Configuration</li> <li>Monitoring</li> <li>Troubleshooting</li> </ol>"},{"location":"getting-started/installation/#quick-deploy-zero-budget","title":"Quick Deploy (Zero Budget)","text":"<p>Deploy with $0/month using TOTP 2FA (Google Authenticator) - no external services required!</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker &amp; Docker Compose installed</li> <li>1GB RAM minimum</li> <li>PostgreSQL-compatible database (free options below)</li> <li>Redis (free options below)</li> </ul>"},{"location":"getting-started/installation/#step-1-generate-secrets","title":"Step 1: Generate Secrets","text":"<pre><code># Generate 4 JWT secrets\nfor i in {1..4}; do\n  node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\ndone\n</code></pre>"},{"location":"getting-started/installation/#step-2-configure-environment","title":"Step 2: Configure Environment","text":"<pre><code># Copy example environment file\ncp .env.example .env\n\n# Edit with your secrets\nnano .env\n</code></pre> <p>Required variables: <pre><code>JWT_ACCESS_SECRET=&lt;generated-secret-1&gt;\nJWT_REFRESH_SECRET=&lt;generated-secret-2&gt;\nTEMP_TOKEN_SECRET=&lt;generated-secret-3&gt;\nDEVICE_TOKEN_SECRET=&lt;generated-secret-4&gt;\n\n# Use backend/.env.production.example for TOTP-only setup\n</code></pre></p>"},{"location":"getting-started/installation/#step-3-deploy-with-docker-compose","title":"Step 3: Deploy with Docker Compose","text":"<pre><code># Start all services\ndocker-compose up -d\n\n# Run database migrations\ndocker-compose exec backend npx prisma migrate deploy\n\n# Check health\ncurl http://localhost:3001/api/health\n</code></pre>"},{"location":"getting-started/installation/#free-hosting-options","title":"Free Hosting Options","text":""},{"location":"getting-started/installation/#railway-recommended","title":"Railway (Recommended)","text":"<ul> <li>Free tier: 500 hours/month</li> <li>Database: PostgreSQL 512MB free</li> <li>Redis: Upstash 10MB free via marketplace</li> </ul> <pre><code># Install Railway CLI\nnpm i -g @railway/cli\n\n# Deploy\nrailway login\nrailway init\nrailway up\n</code></pre>"},{"location":"getting-started/installation/#render","title":"Render","text":"<ul> <li>Free tier: 750 hours/month</li> <li>Database: PostgreSQL 1GB free (expires after 90 days)</li> </ul>"},{"location":"getting-started/installation/#flyio","title":"Fly.io","text":"<ul> <li>Free tier: 3 shared-cpu VMs</li> <li>Database: Fly Postgres 3GB free</li> </ul>"},{"location":"getting-started/installation/#production-deployment","title":"Production Deployment","text":""},{"location":"getting-started/installation/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Load Balancer \u2502 (nginx/Caddy with SSL)\n\u2502   (HTTPS:443)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502          \u2502          \u2502          \u2502\n\u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510\n\u2502Backend\u2502  \u2502Backend\u2502  \u2502Worker\u2502  \u2502Worker\u2502\n\u2502  :3001\u2502  \u2502  :3001\u2502  \u2502      \u2502  \u2502      \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n    \u2502         \u2502         \u2502          \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502         \u2502\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n      \u2502 PostgreSQL\u2502 \u2502  Redis \u2502\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/installation/#deployment-steps","title":"Deployment Steps","text":""},{"location":"getting-started/installation/#1-server-setup-ubuntu-2204","title":"1. Server Setup (Ubuntu 22.04)","text":"<pre><code># Update system\nsudo apt update &amp;&amp; sudo apt upgrade -y\n\n# Install Docker\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\n\n# Install Docker Compose\nsudo apt install docker-compose-plugin\n\n# Create deployment directory\nsudo mkdir -p /opt/2fa\ncd /opt/2fa\n</code></pre>"},{"location":"getting-started/installation/#2-clone-repository","title":"2. Clone Repository","text":"<pre><code>git clone https://github.com/Ilia01/Aegis2FA.git .\n</code></pre>"},{"location":"getting-started/installation/#3-configure-production-environment","title":"3. Configure Production Environment","text":"<pre><code>cp .env.example .env\nnano .env\n</code></pre> <p>Production <code>.env</code>: <pre><code>NODE_ENV=production\n\n# Database (use strong passwords!)\nPOSTGRES_PASSWORD=&lt;strong-random-password&gt;\nDATABASE_URL=postgresql://twofa_user:${POSTGRES_PASSWORD}@postgres:5432/twofa_db?schema=public&amp;connection_limit=20\n\n# Redis\nREDIS_HOST=redis\nREDIS_PORT=6379\n\n# JWT Secrets (64+ characters each)\nJWT_ACCESS_SECRET=&lt;secret-1&gt;\nJWT_REFRESH_SECRET=&lt;secret-2&gt;\nTEMP_TOKEN_SECRET=&lt;secret-3&gt;\nDEVICE_TOKEN_SECRET=&lt;secret-4&gt;\n\n# CORS\nCORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com\n\n# Optional: Email (free with Gmail)\nEMAIL_SERVICE=gmail\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\nEMAIL_USER=your-email@gmail.com\nEMAIL_PASSWORD=&lt;gmail-app-password&gt;\nEMAIL_FROM=noreply@yourdomain.com\n</code></pre></p>"},{"location":"getting-started/installation/#4-deploy-services","title":"4. Deploy Services","text":"<pre><code># Build and start\ndocker-compose up -d\n\n# Run migrations\ndocker-compose exec backend npx prisma migrate deploy\n\n# Check status\ndocker-compose ps\ndocker-compose logs -f\n</code></pre>"},{"location":"getting-started/installation/#5-setup-reverse-proxy-nginx","title":"5. Setup Reverse Proxy (nginx)","text":"<pre><code>sudo apt install nginx certbot python3-certbot-nginx\n\n# Create nginx config\nsudo nano /etc/nginx/sites-available/2fa\n</code></pre> <p>nginx configuration: <pre><code># Backend API\nserver {\n    listen 80;\n    server_name api.yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:3001;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n\n# Frontend\nserver {\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n</code></pre></p> <p>Enable site: <pre><code>sudo ln -s /etc/nginx/sites-available/2fa /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n</code></pre></p>"},{"location":"getting-started/installation/#6-enable-ssl-with-lets-encrypt","title":"6. Enable SSL with Let's Encrypt","text":"<pre><code>sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com -d api.yourdomain.com\n</code></pre>"},{"location":"getting-started/installation/#cloud-platforms","title":"Cloud Platforms","text":""},{"location":"getting-started/installation/#aws-deployment","title":"AWS Deployment","text":""},{"location":"getting-started/installation/#using-ecs-elastic-container-service","title":"Using ECS (Elastic Container Service)","text":"<pre><code># Install AWS CLI\naws configure\n\n# Create ECR repositories\naws ecr create-repository --repository-name 2fa/backend\naws ecr create-repository --repository-name 2fa/frontend\n\n# Build and push\ndocker build -t 2fa-backend ./backend\ndocker tag 2fa-backend:latest &lt;account-id&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com/2fa/backend:latest\ndocker push &lt;account-id&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com/2fa/backend:latest\n\n# Deploy via ECS task definition\naws ecs create-service --service-name 2fa-backend --task-definition 2fa-backend --desired-count 2\n</code></pre>"},{"location":"getting-started/installation/#using-ec2","title":"Using EC2","text":"<pre><code># Launch Ubuntu 22.04 instance\n# SSH into instance\nssh -i your-key.pem ubuntu@&lt;instance-ip&gt;\n\n# Follow Production Deployment steps above\n</code></pre>"},{"location":"getting-started/installation/#google-cloud-platform","title":"Google Cloud Platform","text":""},{"location":"getting-started/installation/#using-cloud-run","title":"Using Cloud Run","text":"<pre><code># Install gcloud CLI\ngcloud auth login\n\n# Build and deploy backend\ngcloud run deploy 2fa-backend \\\n  --source=./backend \\\n  --region=us-central1 \\\n  --allow-unauthenticated \\\n  --set-env-vars=\"NODE_ENV=production,DATABASE_URL=...\"\n\n# Build and deploy frontend\ngcloud run deploy 2fa-frontend \\\n  --source=./frontend \\\n  --region=us-central1 \\\n  --allow-unauthenticated\n</code></pre>"},{"location":"getting-started/installation/#azure","title":"Azure","text":""},{"location":"getting-started/installation/#using-container-instances","title":"Using Container Instances","text":"<pre><code>az login\n\n# Create resource group\naz group create --name 2fa-rg --location eastus\n\n# Deploy backend\naz container create \\\n  --resource-group 2fa-rg \\\n  --name 2fa-backend \\\n  --image ghcr.io/Ilia01/2fa/backend:latest \\\n  --ports 3001 \\\n  --environment-variables NODE_ENV=production\n</code></pre>"},{"location":"getting-started/installation/#environment-variables","title":"Environment Variables","text":""},{"location":"getting-started/installation/#required-variables","title":"Required Variables","text":"Variable Description Example <code>NODE_ENV</code> Environment <code>production</code> <code>DATABASE_URL</code> PostgreSQL connection <code>postgresql://user:pass@host:5432/db</code> <code>REDIS_HOST</code> Redis hostname <code>redis</code> or <code>localhost</code> <code>JWT_ACCESS_SECRET</code> Access token secret (64+ chars) <code>&lt;generated&gt;</code> <code>JWT_REFRESH_SECRET</code> Refresh token secret (64+ chars) <code>&lt;generated&gt;</code> <code>TEMP_TOKEN_SECRET</code> Temp token secret (64+ chars) <code>&lt;generated&gt;</code> <code>DEVICE_TOKEN_SECRET</code> Device token secret (64+ chars) <code>&lt;generated&gt;</code>"},{"location":"getting-started/installation/#optional-variables","title":"Optional Variables","text":"Variable Description Default <code>PORT</code> Backend port <code>3001</code> <code>CORS_ORIGINS</code> Allowed origins (comma-separated) <code>http://localhost:3000</code> <code>EMAIL_SERVICE</code> Email service provider <code>gmail</code> <code>EMAIL_HOST</code> SMTP host <code>smtp.gmail.com</code> <code>EMAIL_PORT</code> SMTP port <code>587</code> <code>EMAIL_USER</code> SMTP username - <code>EMAIL_PASSWORD</code> SMTP password/app password - <code>TWILIO_ACCOUNT_SID</code> Twilio SID (for SMS) - <code>TWILIO_AUTH_TOKEN</code> Twilio token - <code>TWILIO_PHONE_NUMBER</code> Twilio phone number -"},{"location":"getting-started/installation/#database-setup","title":"Database Setup","text":""},{"location":"getting-started/installation/#postgresql","title":"PostgreSQL","text":""},{"location":"getting-started/installation/#managed-services-recommended","title":"Managed Services (Recommended)","text":"<ul> <li>Supabase: 500MB free</li> <li>Railway: 512MB free</li> <li>Neon: 3GB free</li> <li>AWS RDS: Free tier 20GB</li> </ul>"},{"location":"getting-started/installation/#self-hosted","title":"Self-Hosted","text":"<pre><code># Install PostgreSQL\nsudo apt install postgresql postgresql-contrib\n\n# Create database\nsudo -u postgres psql\nCREATE DATABASE twofa_db;\nCREATE USER twofa_user WITH PASSWORD 'strong-password';\nGRANT ALL PRIVILEGES ON DATABASE twofa_db TO twofa_user;\n</code></pre>"},{"location":"getting-started/installation/#redis","title":"Redis","text":""},{"location":"getting-started/installation/#managed-services","title":"Managed Services","text":"<ul> <li>Upstash: 10MB free</li> <li>Redis Cloud: 30MB free</li> <li>Railway: Redis via marketplace</li> </ul>"},{"location":"getting-started/installation/#self-hosted_1","title":"Self-Hosted","text":"<pre><code># Install Redis\nsudo apt install redis-server\n\n# Configure persistence\nsudo nano /etc/redis/redis.conf\n# Set: appendonly yes\n\n# Restart\nsudo systemctl restart redis\n</code></pre>"},{"location":"getting-started/installation/#sslhttps-configuration","title":"SSL/HTTPS Configuration","text":""},{"location":"getting-started/installation/#lets-encrypt-free","title":"Let's Encrypt (Free)","text":"<pre><code># Install Certbot\nsudo apt install certbot python3-certbot-nginx\n\n# Obtain certificate\nsudo certbot --nginx -d yourdomain.com\n\n# Auto-renewal (crontab)\n0 0 * * * certbot renew --quiet\n</code></pre>"},{"location":"getting-started/installation/#cloudflare-free-ssl-cdn","title":"Cloudflare (Free SSL + CDN)","text":"<ol> <li>Add domain to Cloudflare</li> <li>Update DNS to Cloudflare nameservers</li> <li>Enable \"Full (Strict)\" SSL mode</li> <li>Enable \"Always Use HTTPS\"</li> </ol>"},{"location":"getting-started/installation/#monitoring","title":"Monitoring","text":""},{"location":"getting-started/installation/#health-checks","title":"Health Checks","text":"<pre><code># Backend health\ncurl https://api.yourdomain.com/api/health\n\n# Expected response\n{\n  \"status\": \"healthy\",\n  \"checks\": {\n    \"database\": \"up\",\n    \"redis\": \"up\"\n  }\n}\n</code></pre>"},{"location":"getting-started/installation/#logging","title":"Logging","text":"<pre><code># View logs\ndocker-compose logs -f backend\ndocker-compose logs -f worker\n\n# Export to file\ndocker-compose logs backend &gt; backend.log\n</code></pre>"},{"location":"getting-started/installation/#prometheus-grafana-optional","title":"Prometheus + Grafana (Optional)","text":"<p>See monitoring configuration in <code>/docs/MONITORING.md</code> (future)</p>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#common-issues","title":"Common Issues","text":""},{"location":"getting-started/installation/#database-connection-errors","title":"Database Connection Errors","text":"<pre><code># Check if PostgreSQL is running\ndocker-compose ps postgres\n\n# Check logs\ndocker-compose logs postgres\n\n# Verify connection string\ndocker-compose exec backend node -e \"console.log(process.env.DATABASE_URL)\"\n</code></pre>"},{"location":"getting-started/installation/#redis-connection-errors","title":"Redis Connection Errors","text":"<pre><code># Test Redis\ndocker-compose exec redis redis-cli ping\n# Should return: PONG\n</code></pre>"},{"location":"getting-started/installation/#port-already-in-use","title":"Port Already in Use","text":"<pre><code># Find process using port 3001\nsudo lsof -i :3001\n\n# Kill process\nsudo kill -9 &lt;PID&gt;\n</code></pre>"},{"location":"getting-started/installation/#out-of-memory","title":"Out of Memory","text":"<pre><code># Check memory usage\ndocker stats\n\n# Increase Docker memory limit\n# Or add swap space\nsudo fallocate -l 2G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\n</code></pre>"},{"location":"getting-started/installation/#backup-recovery","title":"Backup &amp; Recovery","text":""},{"location":"getting-started/installation/#database-backup","title":"Database Backup","text":"<pre><code># Backup\ndocker-compose exec postgres pg_dump -U twofa_user twofa_db &gt; backup-$(date +%Y%m%d).sql\n\n# Restore\ndocker-compose exec -T postgres psql -U twofa_user twofa_db &lt; backup-20241019.sql\n</code></pre>"},{"location":"getting-started/installation/#automated-backups-cron","title":"Automated Backups (cron)","text":"<pre><code># Add to crontab\n0 2 * * * cd /opt/2fa &amp;&amp; docker-compose exec postgres pg_dump -U twofa_user twofa_db | gzip &gt; /backups/2fa-$(date +\\%Y\\%m\\%d).sql.gz\n</code></pre>"},{"location":"getting-started/installation/#scaling","title":"Scaling","text":""},{"location":"getting-started/installation/#horizontal-scaling","title":"Horizontal Scaling","text":"<pre><code># Scale backend to 3 instances\ndocker-compose up -d --scale backend=3\n\n# Scale workers to 2 instances\ndocker-compose up -d --scale worker=2\n</code></pre>"},{"location":"getting-started/installation/#load-balancing","title":"Load Balancing","text":"<p>Use nginx or HAProxy for load balancing multiple backend instances.</p>"},{"location":"getting-started/installation/#security-checklist","title":"Security Checklist","text":"<ul> <li> Strong JWT secrets (64+ characters)</li> <li> HTTPS enabled</li> <li> Firewall configured (only 80/443 open)</li> <li> Database passwords changed</li> <li> CORS origins whitelist</li> <li> Regular security updates</li> <li> Backup strategy in place</li> <li> Monitoring enabled</li> </ul>"},{"location":"getting-started/installation/#support","title":"Support","text":"<ul> <li>Documentation: See <code>/docs</code></li> <li>Issues: GitHub Issues</li> <li>Community: GitHub Discussions</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get the 2FA Authentication Service running in 5 minutes with Docker.</p>"},{"location":"getting-started/quick-start/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ul> <li> Docker and Docker Compose installed</li> <li> 1GB RAM minimum</li> <li> Port 3000 and 3001 available</li> </ul> <p>Don't have Docker?</p> <p>Install Docker Desktop for your operating system.</p>"},{"location":"getting-started/quick-start/#step-1-clone-the-repository","title":"Step 1: Clone the Repository","text":"<pre><code>git clone https://github.com/Ilia01/Aegis2FA.git\ncd 2fa\n</code></pre>"},{"location":"getting-started/quick-start/#step-2-generate-jwt-secrets","title":"Step 2: Generate JWT Secrets","text":"<p>Generate 4 random secrets for JWT tokens:</p> <pre><code>for i in {1..4}; do\n  node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\ndone\n</code></pre> <p>Copy the 4 generated strings - you'll need them in the next step.</p>"},{"location":"getting-started/quick-start/#step-3-configure-environment","title":"Step 3: Configure Environment","text":"<p>Create your environment file:</p> <pre><code>cp .env.example .env\nnano .env  # Or use your preferred editor\n</code></pre> <p>Add the 4 secrets you generated:</p> .env<pre><code>JWT_ACCESS_SECRET=&lt;paste-first-secret-here&gt;\nJWT_REFRESH_SECRET=&lt;paste-second-secret-here&gt;\nTEMP_TOKEN_SECRET=&lt;paste-third-secret-here&gt;\nDEVICE_TOKEN_SECRET=&lt;paste-fourth-secret-here&gt;\n\n# Database will be created automatically by Docker\nDATABASE_URL=postgresql://postgres:postgres@postgres:5432/twofa_db?schema=public\n\n# Redis (already configured for Docker)\nREDIS_HOST=redis\nREDIS_PORT=6379\n</code></pre> <p>TOTP Only (No External Services)</p> <p>The configuration above is all you need for TOTP 2FA (Google Authenticator). No Twilio, no email service required!</p>"},{"location":"getting-started/quick-start/#step-4-start-the-services","title":"Step 4: Start the Services","text":"<pre><code>docker-compose up -d\n</code></pre> <p>This starts:</p> <ul> <li>\u2705 PostgreSQL database</li> <li>\u2705 Redis cache</li> <li>\u2705 Backend API (port 3001)</li> <li>\u2705 Frontend demo (port 3000)</li> <li>\u2705 Background workers</li> </ul>"},{"location":"getting-started/quick-start/#step-5-run-database-migrations","title":"Step 5: Run Database Migrations","text":"<pre><code>docker-compose exec backend npx prisma migrate deploy\n</code></pre>"},{"location":"getting-started/quick-start/#step-6-verify-installation","title":"Step 6: Verify Installation","text":"<p>Check that all services are healthy:</p> <pre><code># Check health endpoint\ncurl http://localhost:3001/api/health\n\n# Expected response:\n# {\n#   \"status\": \"healthy\",\n#   \"checks\": {\n#     \"database\": \"up\",\n#     \"redis\": \"up\",\n#     \"memory\": \"ok\"\n#   }\n# }\n</code></pre> <p>Visit the frontend demo:</p> <pre><code>http://localhost:3000\n</code></pre>"},{"location":"getting-started/quick-start/#step-7-test-the-service","title":"Step 7: Test the Service","text":""},{"location":"getting-started/quick-start/#register-a-user","title":"Register a User","text":"<pre><code>curl -X POST http://localhost:3001/api/auth/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"test@example.com\",\n    \"username\": \"testuser\",\n    \"password\": \"SecurePass123!\"\n  }'\n</code></pre>"},{"location":"getting-started/quick-start/#setup-totp-2fa","title":"Setup TOTP 2FA","text":"<ol> <li>Visit http://localhost:3000</li> <li>Register with the credentials above</li> <li>Navigate to \"Setup 2FA\"</li> <li>Choose \"TOTP (Google Authenticator)\"</li> <li>Scan the QR code with your authenticator app</li> <li>Enter the 6-digit code to complete setup</li> </ol> <p>\ud83c\udf89 Congratulations!</p> <p>Your 2FA service is now running! You can now integrate it into your application.</p>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"Integrate into Your AppDeploy to ProductionExplore the APISetup Other 2FA Methods <p>Learn how to integrate the 2FA service into your application</p> <p> Integration Guide</p> <p>Deploy the service to a cloud platform or your own server</p> <p> Deployment Guide</p> <p>Try out all the API endpoints with interactive documentation</p> <p> API Reference</p> <p>Configure SMS or Email 2FA</p> <p> SMS Setup  Email Setup</p>"},{"location":"getting-started/quick-start/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quick-start/#port-already-in-use","title":"Port Already in Use","text":"<p>If ports 3000 or 3001 are already in use, edit <code>docker-compose.yml</code>:</p> <pre><code>services:\n  backend:\n    ports:\n      - \"3002:3001\"  # Change 3001 to 3002\n  frontend:\n    ports:\n      - \"3001:3000\"  # Change 3000 to 3001\n</code></pre>"},{"location":"getting-started/quick-start/#database-connection-error","title":"Database Connection Error","text":"<p>Ensure PostgreSQL container is running:</p> <pre><code>docker-compose ps postgres\ndocker-compose logs postgres\n</code></pre> <p>If needed, restart the database:</p> <pre><code>docker-compose restart postgres\n</code></pre>"},{"location":"getting-started/quick-start/#redis-connection-error","title":"Redis Connection Error","text":"<p>Check Redis status:</p> <pre><code>docker-compose exec redis redis-cli ping\n# Should return: PONG\n</code></pre>"},{"location":"getting-started/quick-start/#view-logs","title":"View Logs","text":"<p>See what's happening in the backend:</p> <pre><code>docker-compose logs -f backend\n</code></pre>"},{"location":"getting-started/quick-start/#clean-up","title":"Clean Up","text":"<p>To stop and remove all containers:</p> <pre><code>docker-compose down\n</code></pre> <p>To also remove volumes (\u26a0\ufe0f deletes all data):</p> <pre><code>docker-compose down -v\n</code></pre>"},{"location":"getting-started/quick-start/#support","title":"Support","text":"<p>Need help? Check out:</p> <ul> <li>FAQ - Common questions and solutions</li> <li>GitHub Issues - Report bugs or request features</li> <li>GitHub Discussions - Ask questions</li> </ul>"},{"location":"getting-started/zero-budget/","title":"Zero-Budget Deployment ($0/month)","text":"<p>Deploy the 2FA Authentication Service with absolutely zero cost using TOTP 2FA and free hosting tiers.</p> <p>100% Free Components</p> <ul> <li>\u2705 TOTP (Google Authenticator) - No external service needed</li> <li>\u2705 Backup Codes - Built-in</li> <li>\u2705 Trusted Devices - Built-in</li> <li>\u2705 PostgreSQL - Free tier available</li> <li>\u2705 Redis - Free tier available</li> <li>\u2705 Hosting - Multiple free options</li> </ul>"},{"location":"getting-started/zero-budget/#what-works-for-free","title":"What Works for Free","text":"Feature Cost Details TOTP 2FA $0 Google Authenticator, Authy - 100% offline Backup Codes $0 Generated and stored in your database Trusted Devices $0 30-day device memory PostgreSQL $0 500MB-3GB free (varies by provider) Redis $0 10MB-30MB free (varies by provider) Hosting $0 500-750 hours/month free"},{"location":"getting-started/zero-budget/#what-doesnt-work-requires-payment","title":"What Doesn't Work (Requires Payment)","text":"<ul> <li>\u274c SMS 2FA (Twilio charges ~$0.0075 per SMS)</li> <li>\u274c Email 2FA if over 500 emails/day (Gmail free tier)</li> </ul>"},{"location":"getting-started/zero-budget/#step-by-step-setup","title":"Step-by-Step Setup","text":""},{"location":"getting-started/zero-budget/#step-1-choose-your-free-hosting-platform","title":"Step 1: Choose Your Free Hosting Platform","text":"Railway (Recommended)RenderFly.io <p>Free Tier: 500 hours/month</p> <pre><code># Install Railway CLI\nnpm i -g @railway/cli\n\n# Login and deploy\nrailway login\nrailway init\nrailway up\n</code></pre> <p>Add PostgreSQL: 1. Go to Railway dashboard 2. Click \"New\" \u2192 \"Database\" \u2192 \"PostgreSQL\" 3. Copy <code>DATABASE_URL</code> from variables</p> <p>Add Redis (via Upstash): 1. In Railway, click \"New\" \u2192 \"Empty Service\" 2. Connect to Upstash (10MB free) 3. Copy Redis URL</p> <p>Free Tier: 750 hours/month</p> <ol> <li>Sign up at render.com</li> <li>Create new \"Web Service\" from GitHub repo</li> <li>Add PostgreSQL (1GB free for 90 days)</li> <li>Set environment variables</li> </ol> <p>Free Tier: 3 shared-CPU VMs</p> <pre><code># Install Fly CLI\ncurl -L https://fly.io/install.sh | sh\n\n# Deploy\nfly launch\nfly postgres create\n</code></pre>"},{"location":"getting-started/zero-budget/#step-2-generate-jwt-secrets","title":"Step 2: Generate JWT Secrets","text":"<p>Generate 4 secrets locally:</p> <pre><code>for i in {1..4}; do\n  node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\ndone\n</code></pre>"},{"location":"getting-started/zero-budget/#step-3-configure-environment-variables","title":"Step 3: Configure Environment Variables","text":"<p>In your hosting platform dashboard, set these variables:</p> <pre><code># Required JWT Secrets (paste your generated secrets)\nJWT_ACCESS_SECRET=&lt;your-64-char-secret-1&gt;\nJWT_REFRESH_SECRET=&lt;your-64-char-secret-2&gt;\nTEMP_TOKEN_SECRET=&lt;your-64-char-secret-3&gt;\nDEVICE_TOKEN_SECRET=&lt;your-64-char-secret-4&gt;\n\n# Database (provided by hosting platform)\nDATABASE_URL=&lt;provided-by-platform&gt;\n\n# Redis (from Upstash or platform)\nREDIS_HOST=&lt;your-redis-host&gt;\nREDIS_PORT=6379\nREDIS_PASSWORD=&lt;provided-if-needed&gt;\n\n# IMPORTANT: Leave these UNSET for zero-budget\n# TWILIO_ACCOUNT_SID=  # \u2190 Not needed for TOTP\n# TWILIO_AUTH_TOKEN=   # \u2190 Not needed for TOTP\n# EMAIL_USER=          # \u2190 Optional, only if you want email\n# EMAIL_PASSWORD=      # \u2190 Optional, only if you want email\n</code></pre>"},{"location":"getting-started/zero-budget/#step-4-deploy","title":"Step 4: Deploy","text":""},{"location":"getting-started/zero-budget/#railway","title":"Railway","text":"<pre><code>railway up\nrailway run npx prisma migrate deploy\n</code></pre>"},{"location":"getting-started/zero-budget/#render","title":"Render","text":"<p>Render will auto-deploy on git push. Run migrations in the shell:</p> <pre><code>npx prisma migrate deploy\n</code></pre>"},{"location":"getting-started/zero-budget/#flyio","title":"Fly.io","text":"<pre><code>fly deploy\nfly ssh console\nnpx prisma migrate deploy\n</code></pre>"},{"location":"getting-started/zero-budget/#step-5-verify-deployment","title":"Step 5: Verify Deployment","text":"<p>Test your deployed service:</p> <pre><code>curl https://your-app.railway.app/api/health\n\n# Should return:\n# {\n#   \"status\": \"healthy\",\n#   \"checks\": {\n#     \"database\": \"up\",\n#     \"redis\": \"up\"\n#   }\n# }\n</code></pre>"},{"location":"getting-started/zero-budget/#free-database-options","title":"Free Database Options","text":""},{"location":"getting-started/zero-budget/#postgresql","title":"PostgreSQL","text":"Provider Free Tier Limits Supabase 500MB 2 projects, unlimited API requests Railway 512MB Shared CPU, 500hrs/month Neon 3GB 10 projects Render 1GB Expires after 90 days ElephantSQL 20MB Shared server"},{"location":"getting-started/zero-budget/#redis","title":"Redis","text":"Provider Free Tier Limits Upstash 10MB 10K commands/day Redis Cloud 30MB Shared server Railway Via marketplace 500hrs/month"},{"location":"getting-started/zero-budget/#optional-free-email-500-emailsday","title":"Optional: Free Email (500 emails/day)","text":"<p>If you want Email 2FA with Gmail's free tier:</p> <ol> <li>Enable 2-Step Verification on your Google account</li> <li>Generate App Password:</li> <li>Go to Google Account \u2192 Security \u2192 2-Step Verification</li> <li>Scroll to \"App passwords\"</li> <li> <p>Generate password for \"Mail\"</p> </li> <li> <p>Add to environment variables:</p> </li> </ol> <pre><code>EMAIL_SERVICE=gmail\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\nEMAIL_USER=your-email@gmail.com\nEMAIL_PASSWORD=&lt;16-char-app-password&gt;\nEMAIL_FROM=noreply@yourdomain.com\n</code></pre> <p>Limit: 500 emails/day (Google's free tier limit)</p>"},{"location":"getting-started/zero-budget/#cost-breakdown","title":"Cost Breakdown","text":""},{"location":"getting-started/zero-budget/#completely-free-setup-totp-only","title":"Completely Free Setup (TOTP Only)","text":"<pre><code>Railway/Render Hosting:     $0/month (free tier)\nPostgreSQL (Supabase):       $0/month (500MB free)\nRedis (Upstash):            $0/month (10MB free)\nTOTP 2FA:                   $0/month (no external service)\nBackup Codes:               $0/month (built-in)\nTrusted Devices:            $0/month (built-in)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTOTAL:                      $0/month\n</code></pre>"},{"location":"getting-started/zero-budget/#with-optional-email-gmail","title":"With Optional Email (Gmail)","text":"<pre><code>Everything above:           $0/month\nGmail (500 emails/day):     $0/month\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTOTAL:                      $0/month\n</code></pre>"},{"location":"getting-started/zero-budget/#limitations-of-free-tier","title":"Limitations of Free Tier","text":""},{"location":"getting-started/zero-budget/#what-you-get","title":"What You Get","text":"<ul> <li>\u2705 Full TOTP 2FA functionality</li> <li>\u2705 User registration and authentication</li> <li>\u2705 Backup codes</li> <li>\u2705 Trusted devices</li> <li>\u2705 API key management</li> <li>\u2705 Webhooks</li> <li>\u2705 Health checks</li> </ul>"},{"location":"getting-started/zero-budget/#what-you-dont-get","title":"What You Don't Get","text":"<ul> <li>\u274c SMS 2FA (requires paid Twilio account)</li> <li>\u274c Unlimited emails (Gmail limit: 500/day)</li> <li>\u274c High availability (free tiers may have downtime)</li> <li>\u274c Auto-scaling</li> <li>\u274c Dedicated resources</li> </ul>"},{"location":"getting-started/zero-budget/#scaling-beyond-free-tier","title":"Scaling Beyond Free Tier","text":"<p>When you outgrow the free tier:</p> Service Paid Tier Cost Railway Hobby $5/month + usage Render Starter $7/month Supabase Pro $25/month Upstash Redis Pay-as-you-go $0.20 per 100K commands Twilio SMS Pay-per-use $0.0075 per SMS"},{"location":"getting-started/zero-budget/#production-considerations","title":"Production Considerations","text":"<p>Free Tier vs Production</p> <p>Free tiers are great for:</p> <ul> <li>\u2705 Development</li> <li>\u2705 Testing</li> <li>\u2705 Small projects (&lt; 100 users)</li> <li>\u2705 Proof of concept</li> </ul> <p>Consider paid tiers for:</p> <ul> <li>\u26a0\ufe0f Production apps with &gt; 100 users</li> <li>\u26a0\ufe0f Mission-critical applications</li> <li>\u26a0\ufe0f Applications requiring 99.9% uptime</li> <li>\u26a0\ufe0f High-traffic applications</li> </ul>"},{"location":"getting-started/zero-budget/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/zero-budget/#database-connection-limit-reached","title":"Database Connection Limit Reached","text":"<p>Free PostgreSQL tiers have connection limits (usually 20-100).</p> <p>Solution: Reduce connection pool size in Prisma:</p> <pre><code>DATABASE_URL=postgresql://user:pass@host:5432/db?connection_limit=10\n</code></pre>"},{"location":"getting-started/zero-budget/#redis-memory-limit-exceeded","title":"Redis Memory Limit Exceeded","text":"<p>Upstash free tier is 10MB.</p> <p>Solution: - Reduce OTP expiry time (default 5 minutes) - Clear old rate limit keys more frequently - Upgrade to paid tier ($0.20 per 100K commands)</p>"},{"location":"getting-started/zero-budget/#service-sleeps-railwayrender","title":"Service Sleeps (Railway/Render)","text":"<p>Free tiers may sleep after inactivity.</p> <p>Solution: - Upgrade to paid tier - Use a free uptime monitor (UptimeRobot) to ping every 5 minutes - Accept the ~30-second cold start delay</p>"},{"location":"getting-started/zero-budget/#next-steps","title":"Next Steps","text":"<p>Once deployed:</p> <ol> <li>Test the API: API Reference</li> <li>Integrate into your app: Integration Guide</li> <li>Monitor your service: Monitoring Guide</li> <li>Scale when needed: Cloud Platforms</li> </ol> <p>Questions? Join our GitHub Discussions</p>"},{"location":"guides/integration/","title":"Integration Guide","text":"<p>Complete guide to integrating the 2FA Authentication Service into your application.</p>"},{"location":"guides/integration/#integration-approaches","title":"Integration Approaches","text":""},{"location":"guides/integration/#1-rest-api-recommended","title":"1. REST API (Recommended)","text":"<p>Call API endpoints directly from your application. Works with any language or framework.</p> <p>Pros: - Maximum flexibility - Works with any tech stack - Full control over UI/UX</p> <p>Cons: - More implementation work - Need to handle token management</p>"},{"location":"guides/integration/#2-sdk-coming-soon","title":"2. SDK (Coming Soon)","text":"<p>Use our official JavaScript/TypeScript SDK for easier integration.</p> <p>Pros: - Pre-built auth flows - Automatic token refresh - Type-safe - Less code to write</p> <p>Cons: - Currently in development</p>"},{"location":"guides/integration/#quick-start-integration","title":"Quick Start Integration","text":""},{"location":"guides/integration/#step-1-create-account","title":"Step 1: Create Account","text":"<pre><code>curl -X POST https://your-api.com/auth/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"user@example.com\",\n    \"username\": \"johndoe\",\n    \"password\": \"SecureP@ssw0rd123!\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGci...\",\n    \"refreshToken\": \"eyJhbGci...\",\n    \"user\": { \"id\": \"uuid\", \"email\": \"user@example.com\", ... }\n  }\n}\n</code></pre></p>"},{"location":"guides/integration/#step-2-enable-2fa","title":"Step 2: Enable 2FA","text":"<pre><code>curl -X POST https://your-api.com/2fa/totp/setup \\\n  -H \"Authorization: Bearer &lt;access_token&gt;\"\n</code></pre> <p>Response: <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"qrCode\": \"data:image/png;base64,...\",\n    \"secret\": \"JBSWY3DPEHPK3PXP\",\n    \"backupCodes\": [\"A1B2C3D4E5\", ...]\n  }\n}\n</code></pre></p>"},{"location":"guides/integration/#step-3-login-with-2fa","title":"Step 3: Login with 2FA","text":"<pre><code># 1. Initial login\ncurl -X POST https://your-api.com/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"user@example.com\", \"password\": \"SecureP@ssw0rd123!\"}'\n\n# Response: {\"tempToken\": \"...\", \"requires2FA\": true}\n\n# 2. Verify 2FA\ncurl -X POST https://your-api.com/2fa/verify \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"tempToken\": \"...\", \"code\": \"123456\"}'\n\n# Response: {\"accessToken\": \"...\", \"refreshToken\": \"...\"}\n</code></pre>"},{"location":"guides/integration/#framework-specific-integrations","title":"Framework-Specific Integrations","text":""},{"location":"guides/integration/#react-nextjs","title":"React / Next.js","text":""},{"location":"guides/integration/#installation","title":"Installation","text":"<pre><code>npm install axios\n</code></pre>"},{"location":"guides/integration/#create-api-client","title":"Create API Client","text":"<pre><code>// lib/api.ts\nimport axios from 'axios'\n\nconst api = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// Add access token to all requests\napi.interceptors.request.use(config =&gt; {\n  const token = localStorage.getItem('accessToken')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n})\n\n// Auto-refresh on 401\napi.interceptors.response.use(\n  response =&gt; response,\n  async error =&gt; {\n    if (error.response?.status === 401 &amp;&amp; !error.config._retry) {\n      error.config._retry = true\n      const refreshToken = localStorage.getItem('refreshToken')\n\n      try {\n        const { data } = await axios.post(`${process.env.NEXT_PUBLIC_API_URL}/auth/refresh`, {\n          refreshToken\n        })\n\n        localStorage.setItem('accessToken', data.data.accessToken)\n        localStorage.setItem('refreshToken', data.data.refreshToken)\n\n        error.config.headers.Authorization = `Bearer ${data.data.accessToken}`\n        return api(error.config)\n      } catch {\n        // Refresh failed, logout user\n        localStorage.removeItem('accessToken')\n        localStorage.removeItem('refreshToken')\n        window.location.href = '/login'\n      }\n    }\n    return Promise.reject(error)\n  }\n)\n\nexport default api\n</code></pre>"},{"location":"guides/integration/#authentication-context","title":"Authentication Context","text":"<pre><code>// contexts/AuthContext.tsx\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react'\nimport api from '@/lib/api'\n\ninterface User {\n  id: string\n  email: string\n  username: string\n  twoFactorEnabled: boolean\n}\n\ninterface AuthContextType {\n  user: User | null\n  login: (email: string, password: string) =&gt; Promise&lt;any&gt;\n  logout: () =&gt; Promise&lt;void&gt;\n  isLoading: boolean\n}\n\nconst AuthContext = createContext&lt;AuthContextType | undefined&gt;(undefined)\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState&lt;User | null&gt;(null)\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() =&gt; {\n    // Check if user is logged in on mount\n    const loadUser = async () =&gt; {\n      const token = localStorage.getItem('accessToken')\n      if (token) {\n        try {\n          const { data } = await api.get('/auth/me')\n          setUser(data.data)\n        } catch (error) {\n          localStorage.removeItem('accessToken')\n          localStorage.removeItem('refreshToken')\n        }\n      }\n      setIsLoading(false)\n    }\n    loadUser()\n  }, [])\n\n  const login = async (email: string, password: string) =&gt; {\n    const { data } = await api.post('/auth/login', { email, password })\n\n    if (data.data.requires2FA) {\n      // Return temp token for 2FA verification\n      return { requires2FA: true, tempToken: data.data.tempToken }\n    }\n\n    // No 2FA, login successful\n    localStorage.setItem('accessToken', data.data.accessToken)\n    localStorage.setItem('refreshToken', data.data.refreshToken)\n\n    const userResponse = await api.get('/auth/me')\n    setUser(userResponse.data.data)\n\n    return { requires2FA: false }\n  }\n\n  const logout = async () =&gt; {\n    try {\n      await api.post('/auth/logout')\n    } catch (error) {\n      console.error('Logout error:', error)\n    }\n\n    localStorage.removeItem('accessToken')\n    localStorage.removeItem('refreshToken')\n    setUser(null)\n  }\n\n  return (\n    &lt;AuthContext.Provider value={{ user, login, logout, isLoading }}&gt;\n      {children}\n    &lt;/AuthContext.Provider&gt;\n  )\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider')\n  }\n  return context\n}\n</code></pre>"},{"location":"guides/integration/#login-page","title":"Login Page","text":"<pre><code>// app/login/page.tsx\n'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [error, setError] = useState('')\n  const { login } = useAuth()\n  const router = useRouter()\n\n  const handleSubmit = async (e: React.FormEvent) =&gt; {\n    e.preventDefault()\n    setError('')\n\n    try {\n      const result = await login(email, password)\n\n      if (result.requires2FA) {\n        // Redirect to 2FA verification\n        router.push(`/verify-2fa?tempToken=${result.tempToken}`)\n      } else {\n        // Login successful\n        router.push('/dashboard')\n      }\n    } catch (err: any) {\n      setError(err.response?.data?.error || 'Login failed')\n    }\n  }\n\n  return (\n    &lt;div className=\"max-w-md mx-auto mt-8\"&gt;\n      &lt;h1 className=\"text-2xl font-bold mb-4\"&gt;Login&lt;/h1&gt;\n\n      {error &amp;&amp; (\n        &lt;div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\"&gt;\n          {error}\n        &lt;/div&gt;\n      )}\n\n      &lt;form onSubmit={handleSubmit} className=\"space-y-4\"&gt;\n        &lt;div&gt;\n          &lt;label className=\"block text-sm font-medium mb-1\"&gt;Email&lt;/label&gt;\n          &lt;input\n            type=\"email\"\n            value={email}\n            onChange={(e) =&gt; setEmail(e.target.value)}\n            className=\"w-full px-3 py-2 border rounded\"\n            required\n          /&gt;\n        &lt;/div&gt;\n\n        &lt;div&gt;\n          &lt;label className=\"block text-sm font-medium mb-1\"&gt;Password&lt;/label&gt;\n          &lt;input\n            type=\"password\"\n            value={password}\n            onChange={(e) =&gt; setPassword(e.target.value)}\n            className=\"w-full px-3 py-2 border rounded\"\n            required\n          /&gt;\n        &lt;/div&gt;\n\n        &lt;button\n          type=\"submit\"\n          className=\"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700\"\n        &gt;\n          Login\n        &lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  )\n}\n</code></pre>"},{"location":"guides/integration/#2fa-verification-page","title":"2FA Verification Page","text":"<pre><code>// app/verify-2fa/page.tsx\n'use client'\n\nimport { useState } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport api from '@/lib/api'\n\nexport default function Verify2FAPage() {\n  const [code, setCode] = useState('')\n  const [error, setError] = useState('')\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const tempToken = searchParams.get('tempToken')\n\n  const handleSubmit = async (e: React.FormEvent) =&gt; {\n    e.preventDefault()\n    setError('')\n\n    try {\n      const { data } = await api.post('/2fa/verify', {\n        tempToken,\n        code,\n        trustDevice: true\n      })\n\n      localStorage.setItem('accessToken', data.data.accessToken)\n      localStorage.setItem('refreshToken', data.data.refreshToken)\n      if (data.data.deviceToken) {\n        localStorage.setItem('deviceToken', data.data.deviceToken)\n      }\n\n      router.push('/dashboard')\n    } catch (err: any) {\n      setError(err.response?.data?.error || 'Verification failed')\n    }\n  }\n\n  return (\n    &lt;div className=\"max-w-md mx-auto mt-8\"&gt;\n      &lt;h1 className=\"text-2xl font-bold mb-4\"&gt;Two-Factor Authentication&lt;/h1&gt;\n      &lt;p className=\"mb-4 text-gray-600\"&gt;Enter the 6-digit code from your authenticator app.&lt;/p&gt;\n\n      {error &amp;&amp; (\n        &lt;div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\"&gt;\n          {error}\n        &lt;/div&gt;\n      )}\n\n      &lt;form onSubmit={handleSubmit} className=\"space-y-4\"&gt;\n        &lt;div&gt;\n          &lt;label className=\"block text-sm font-medium mb-1\"&gt;Verification Code&lt;/label&gt;\n          &lt;input\n            type=\"text\"\n            value={code}\n            onChange={(e) =&gt; setCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n            className=\"w-full px-3 py-2 border rounded text-center text-2xl tracking-widest\"\n            placeholder=\"123456\"\n            maxLength={6}\n            required\n          /&gt;\n        &lt;/div&gt;\n\n        &lt;button\n          type=\"submit\"\n          className=\"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700\"\n        &gt;\n          Verify\n        &lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  )\n}\n</code></pre>"},{"location":"guides/integration/#vuejs","title":"Vue.js","text":""},{"location":"guides/integration/#api-client","title":"API Client","text":"<pre><code>// src/api/client.js\nimport axios from 'axios'\n\nconst api = axios.create({\n  baseURL: import.meta.env.VITE_API_URL,\n  headers: { 'Content-Type': 'application/json' }\n})\n\napi.interceptors.request.use(config =&gt; {\n  const token = localStorage.getItem('accessToken')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n})\n\nexport default api\n</code></pre>"},{"location":"guides/integration/#composable","title":"Composable","text":"<pre><code>// src/composables/useAuth.js\nimport { ref, computed } from 'vue'\nimport api from '@/api/client'\n\nconst user = ref(null)\nconst isLoading = ref(false)\n\nexport function useAuth() {\n  const isAuthenticated = computed(() =&gt; !!user.value)\n\n  const login = async (email, password) =&gt; {\n    isLoading.value = true\n    try {\n      const { data } = await api.post('/auth/login', { email, password })\n\n      if (data.data.requires2FA) {\n        return { requires2FA: true, tempToken: data.data.tempToken }\n      }\n\n      localStorage.setItem('accessToken', data.data.accessToken)\n      localStorage.setItem('refreshToken', data.data.refreshToken)\n\n      const userResponse = await api.get('/auth/me')\n      user.value = userResponse.data.data\n\n      return { requires2FA: false }\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  const logout = async () =&gt; {\n    await api.post('/auth/logout')\n    localStorage.clear()\n    user.value = null\n  }\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated,\n    login,\n    logout\n  }\n}\n</code></pre>"},{"location":"guides/integration/#nodejs-express","title":"Node.js / Express","text":""},{"location":"guides/integration/#middleware","title":"Middleware","text":"<pre><code>// middleware/auth.js\nconst axios = require('axios')\n\nasync function authenticateUser(req, res, next) {\n  const token = req.headers.authorization?.split(' ')[1]\n\n  if (!token) {\n    return res.status(401).json({ error: 'Unauthorized' })\n  }\n\n  try {\n    const { data } = await axios.get(`${process.env.API_URL}/auth/me`, {\n      headers: { Authorization: `Bearer ${token}` }\n    })\n\n    req.user = data.data\n    next()\n  } catch (error) {\n    res.status(401).json({ error: 'Invalid token' })\n  }\n}\n\nmodule.exports = { authenticateUser }\n</code></pre>"},{"location":"guides/integration/#usage","title":"Usage","text":"<pre><code>// routes/protected.js\nconst express = require('express')\nconst { authenticateUser } = require('../middleware/auth')\n\nconst router = express.Router()\n\nrouter.get('/profile', authenticateUser, (req, res) =&gt; {\n  res.json({ user: req.user })\n})\n\nmodule.exports = router\n</code></pre>"},{"location":"guides/integration/#python-flask","title":"Python / Flask","text":""},{"location":"guides/integration/#client","title":"Client","text":"<pre><code># auth_client.py\nimport requests\nfrom typing import Optional, Dict\n\nclass AuthClient:\n    def __init__(self, base_url: str):\n        self.base_url = base_url\n        self.access_token: Optional[str] = None\n        self.refresh_token: Optional[str] = None\n\n    def register(self, email: str, username: str, password: str) -&gt; Dict:\n        response = requests.post(f'{self.base_url}/auth/register', json={\n            'email': email,\n            'username': username,\n            'password': password\n        })\n        response.raise_for_status()\n        data = response.json()['data']\n\n        self.access_token = data['accessToken']\n        self.refresh_token = data['refreshToken']\n\n        return data\n\n    def login(self, email: str, password: str) -&gt; Dict:\n        response = requests.post(f'{self.base_url}/auth/login', json={\n            'email': email,\n            'password': password\n        })\n        response.raise_for_status()\n        data = response.json()['data']\n\n        if 'accessToken' in data:\n            self.access_token = data['accessToken']\n            self.refresh_token = data['refreshToken']\n\n        return data\n\n    def verify_2fa(self, temp_token: str, code: str) -&gt; Dict:\n        response = requests.post(f'{self.base_url}/2fa/verify', json={\n            'tempToken': temp_token,\n            'code': code\n        })\n        response.raise_for_status()\n        data = response.json()['data']\n\n        self.access_token = data['accessToken']\n        self.refresh_token = data['refreshToken']\n\n        return data\n\n    def get_headers(self) -&gt; Dict:\n        return {\n            'Authorization': f'Bearer {self.access_token}'\n        }\n\n# Usage\nclient = AuthClient('https://your-api.com')\n\n# Register\nuser = client.register('user@example.com', 'johndoe', 'SecureP@ssw0rd123!')\n\n# Login\nresult = client.login('user@example.com', 'SecureP@ssw0rd123!')\n\nif result.get('requires2FA'):\n    code = input('Enter 2FA code: ')\n    client.verify_2fa(result['tempToken'], code)\n\n# Make authenticated requests\nresponse = requests.get('https://your-api.com/auth/me', headers=client.get_headers())\n</code></pre>"},{"location":"guides/integration/#mobile-react-native","title":"Mobile (React Native)","text":""},{"location":"guides/integration/#secure-storage","title":"Secure Storage","text":"<pre><code>npm install @react-native-async-storage/async-storage\n</code></pre>"},{"location":"guides/integration/#auth-service","title":"Auth Service","text":"<pre><code>// services/auth.ts\nimport AsyncStorage from '@react-native-async-storage/async-storage'\nimport axios from 'axios'\n\nconst API_URL = 'https://your-api.com'\n\nexport class AuthService {\n  static async login(email: string, password: string) {\n    const { data } = await axios.post(`${API_URL}/auth/login`, { email, password })\n\n    if (data.data.requires2FA) {\n      return { requires2FA: true, tempToken: data.data.tempToken }\n    }\n\n    await AsyncStorage.setItem('accessToken', data.data.accessToken)\n    await AsyncStorage.setItem('refreshToken', data.data.refreshToken)\n\n    return { requires2FA: false }\n  }\n\n  static async verify2FA(tempToken: string, code: string, trustDevice: boolean = false) {\n    const { data } = await axios.post(`${API_URL}/2fa/verify`, {\n      tempToken,\n      code,\n      trustDevice\n    })\n\n    await AsyncStorage.setItem('accessToken', data.data.accessToken)\n    await AsyncStorage.setItem('refreshToken', data.data.refreshToken)\n\n    if (data.data.deviceToken) {\n      await AsyncStorage.setItem('deviceToken', data.data.deviceToken)\n    }\n\n    return data.data\n  }\n\n  static async logout() {\n    const token = await AsyncStorage.getItem('accessToken')\n\n    if (token) {\n      await axios.post(`${API_URL}/auth/logout`, {}, {\n        headers: { Authorization: `Bearer ${token}` }\n      })\n    }\n\n    await AsyncStorage.multiRemove(['accessToken', 'refreshToken', 'deviceToken'])\n  }\n\n  static async getAccessToken() {\n    return await AsyncStorage.getItem('accessToken')\n  }\n}\n</code></pre>"},{"location":"guides/integration/#common-integration-patterns","title":"Common Integration Patterns","text":""},{"location":"guides/integration/#pattern-1-protected-routes","title":"Pattern 1: Protected Routes","text":"<pre><code>// middleware/requireAuth.ts\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  const token = request.cookies.get('accessToken')?.value\n\n  if (!token) {\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n\n  // Verify token with API\n  try {\n    const response = await fetch(`${process.env.API_URL}/auth/me`, {\n      headers: { Authorization: `Bearer ${token}` }\n    })\n\n    if (!response.ok) {\n      return NextResponse.redirect(new URL('/login', request.url))\n    }\n\n    return NextResponse.next()\n  } catch {\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n}\n\nexport const config = {\n  matcher: ['/dashboard/:path*', '/settings/:path*']\n}\n</code></pre>"},{"location":"guides/integration/#pattern-2-token-refresh","title":"Pattern 2: Token Refresh","text":"<pre><code>// utils/tokenRefresh.ts\nlet refreshPromise: Promise&lt;string&gt; | null = null\n\nexport async function refreshAccessToken(): Promise&lt;string&gt; {\n  // Prevent multiple simultaneous refresh requests\n  if (refreshPromise) {\n    return refreshPromise\n  }\n\n  refreshPromise = (async () =&gt; {\n    const refreshToken = localStorage.getItem('refreshToken')\n\n    const { data } = await axios.post('/auth/refresh', { refreshToken })\n\n    localStorage.setItem('accessToken', data.data.accessToken)\n    localStorage.setItem('refreshToken', data.data.refreshToken)\n\n    return data.data.accessToken\n  })()\n\n  try {\n    return await refreshPromise\n  } finally {\n    refreshPromise = null\n  }\n}\n</code></pre>"},{"location":"guides/integration/#pattern-3-remember-me","title":"Pattern 3: Remember Me","text":"<pre><code>// Use different storage based on \"remember me\" option\nfunction storeTokens(accessToken: string, refreshToken: string, rememberMe: boolean) {\n  const storage = rememberMe ? localStorage : sessionStorage\n\n  storage.setItem('accessToken', accessToken)\n  storage.setItem('refreshToken', refreshToken)\n}\n</code></pre>"},{"location":"guides/integration/#testing-your-integration","title":"Testing Your Integration","text":""},{"location":"guides/integration/#manual-testing-checklist","title":"Manual Testing Checklist","text":"<ul> <li> Registration creates account successfully</li> <li> Login without 2FA works</li> <li> Login with 2FA prompts for code</li> <li> Invalid 2FA code shows error</li> <li> Valid 2FA code logs in</li> <li> Access token expires after 15 minutes</li> <li> Refresh token renews access token</li> <li> Logout invalidates session</li> <li> Protected routes require authentication</li> <li> Token refresh happens automatically</li> </ul>"},{"location":"guides/integration/#automated-testing","title":"Automated Testing","text":"<pre><code>// Example Jest test\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport LoginPage from '@/app/login/page'\nimport api from '@/lib/api'\n\njest.mock('@/lib/api')\n\ntest('login with 2FA flow', async () =&gt; {\n  (api.post as jest.Mock)\n    .mockResolvedValueOnce({\n      data: {\n        data: {\n          requires2FA: true,\n          tempToken: 'temp_token_123'\n        }\n      }\n    })\n\n  render(&lt;LoginPage /&gt;)\n\n  fireEvent.change(screen.getByLabelText(/email/i), {\n    target: { value: 'user@example.com' }\n  })\n  fireEvent.change(screen.getByLabelText(/password/i), {\n    target: { value: 'SecureP@ssw0rd123!' }\n  })\n\n  fireEvent.click(screen.getByText(/login/i))\n\n  await waitFor(() =&gt; {\n    expect(api.post).toHaveBeenCalledWith('/auth/login', {\n      email: 'user@example.com',\n      password: 'SecureP@ssw0rd123!'\n    })\n  })\n})\n</code></pre>"},{"location":"guides/integration/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication API - API reference</li> <li>Two-Factor API - 2FA API reference</li> <li>Error Handling - Error codes and handling</li> <li>Security Best Practices - Security guidelines</li> </ul>"},{"location":"reference/error-codes/","title":"Error Codes Reference","text":"<p>Complete reference of all error codes and how to handle them.</p>"},{"location":"reference/error-codes/#error-response-format","title":"Error Response Format","text":"<p>All errors follow a consistent format:</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Human-readable error message\"\n}\n</code></pre>"},{"location":"reference/error-codes/#http-status-codes","title":"HTTP Status Codes","text":"Status Name When It Occurs 200 OK Request successful 201 Created Resource created successfully 400 Bad Request Validation error or malformed request 401 Unauthorized Missing or invalid authentication 403 Forbidden Authenticated but insufficient permissions 404 Not Found Resource doesn't exist 409 Conflict Resource already exists 429 Too Many Requests Rate limit exceeded 500 Internal Server Error Server-side error 503 Service Unavailable Service is down"},{"location":"reference/error-codes/#authentication-errors","title":"Authentication Errors","text":""},{"location":"reference/error-codes/#400-validation-error","title":"400: Validation Error","text":"<p>When: Invalid input format</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Validation error: email must be a valid email address\"\n}\n</code></pre> <p>Common causes: - Invalid email format - Password doesn't meet requirements - Missing required fields - Invalid field types</p> <p>How to fix: - Validate input on client side - Check password requirements - Ensure all required fields are provided</p>"},{"location":"reference/error-codes/#401-invalid-credentials","title":"401: Invalid Credentials","text":"<p>When: Email or password incorrect during login</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid email or password\"\n}\n</code></pre> <p>How to fix: - Verify email is correct - Verify password is correct - Check if account exists - Consider password reset if user forgot password</p>"},{"location":"reference/error-codes/#401-invalid-or-expired-token","title":"401: Invalid or Expired Token","text":"<p>When: Access token is invalid, malformed, or expired</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid or expired token\"\n}\n</code></pre> <p>How to fix: - Refresh access token using refresh token - If refresh fails, redirect to login - Ensure <code>Authorization: Bearer &lt;token&gt;</code> header is set correctly</p> <p>Example fix:</p> <pre><code>try {\n  await api.get('/auth/me')\n} catch (error) {\n  if (error.response?.status === 401) {\n    // Try to refresh token\n    try {\n      const newToken = await refreshAccessToken()\n      // Retry original request\n    } catch {\n      // Refresh failed, redirect to login\n      router.push('/login')\n    }\n  }\n}\n</code></pre>"},{"location":"reference/error-codes/#401-invalid-refresh-token","title":"401: Invalid Refresh Token","text":"<p>When: Refresh token is invalid, expired, or revoked</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid refresh token\"\n}\n</code></pre> <p>How to fix: - Redirect user to login page - Clear stored tokens - User must re-authenticate</p>"},{"location":"reference/error-codes/#409-email-already-registered","title":"409: Email Already Registered","text":"<p>When: Registration with existing email</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Email already registered\"\n}\n</code></pre> <p>How to fix: - Prompt user to login instead - Offer \"Forgot password?\" link - Check if user meant to login</p>"},{"location":"reference/error-codes/#409-username-already-taken","title":"409: Username Already Taken","text":"<p>When: Registration with existing username</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Username already taken\"\n}\n</code></pre> <p>How to fix: - Prompt user to choose different username - Suggest available usernames - Validate username availability before submission</p>"},{"location":"reference/error-codes/#2fa-errors","title":"2FA Errors","text":""},{"location":"reference/error-codes/#400-invalid-2fa-code","title":"400: Invalid 2FA Code","text":"<p>When: TOTP/SMS/Email code is incorrect</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid verification code\"\n}\n</code></pre> <p>Common causes: - Code expired (5-minute window) - User typed wrong code - Time sync issue (TOTP) - Code already used</p> <p>How to fix: - Ask user to try again - For TOTP: Check device time is synced - For SMS/Email: Offer to resend code - Suggest using backup code</p> <p>Example:</p> <pre><code>try {\n  await api.post('/2fa/verify', { tempToken, code })\n} catch (error) {\n  if (error.response?.status === 400) {\n    setError('Invalid code. Please try again.')\n    // Offer to resend\n    showResendButton()\n  }\n}\n</code></pre>"},{"location":"reference/error-codes/#400-backup-code-already-used","title":"400: Backup Code Already Used","text":"<p>When: Attempting to reuse a backup code</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"This backup code has already been used\"\n}\n</code></pre> <p>How to fix: - Each backup code is single-use - Try a different backup code - If no codes remain, contact support</p>"},{"location":"reference/error-codes/#400-setup-not-initiated","title":"400: Setup Not Initiated","text":"<p>When: Verifying 2FA setup without calling setup first</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"2FA setup not initiated\"\n}\n</code></pre> <p>How to fix: - Call <code>/2fa/totp/setup</code> first - Then call <code>/2fa/totp/verify-setup</code></p>"},{"location":"reference/error-codes/#400-no-2fa-method-available","title":"400: No 2FA Method Available","text":"<p>When: User has no 2FA methods enabled</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"No 2FA method available\"\n}\n</code></pre> <p>How to fix: - Enable at least one 2FA method - Setup TOTP, SMS, or Email 2FA</p>"},{"location":"reference/error-codes/#rate-limiting-errors","title":"Rate Limiting Errors","text":""},{"location":"reference/error-codes/#429-too-many-requests","title":"429: Too Many Requests","text":"<p>When: Rate limit exceeded</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Too many requests. Please try again later.\"\n}\n</code></pre> <p>Response headers: <pre><code>X-RateLimit-Limit: 5\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1697654700\n</code></pre></p> <p>Common triggers: - Multiple failed login attempts - Spamming 2FA code verification - Automated bot traffic</p> <p>How to fix: - Wait for reset time (check <code>X-RateLimit-Reset</code> header) - Implement exponential backoff - Show countdown timer to user - Cache requests on client side</p> <p>Example:</p> <pre><code>try {\n  await api.post('/auth/login', { email, password })\n} catch (error) {\n  if (error.response?.status === 429) {\n    const resetTime = error.response.headers['x-ratelimit-reset']\n    const waitSeconds = resetTime - Math.floor(Date.now() / 1000)\n\n    setError(`Too many attempts. Please wait ${waitSeconds} seconds.`)\n  }\n}\n</code></pre>"},{"location":"reference/error-codes/#permission-errors","title":"Permission Errors","text":""},{"location":"reference/error-codes/#403-insufficient-permissions","title":"403: Insufficient Permissions","text":"<p>When: API key lacks required scope</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Insufficient permissions. Required scope: 2fa:write\"\n}\n</code></pre> <p>How to fix: - Check API key scopes - Create new API key with required permissions - Use correct API key for the operation</p>"},{"location":"reference/error-codes/#resource-errors","title":"Resource Errors","text":""},{"location":"reference/error-codes/#404-not-found","title":"404: Not Found","text":"<p>When: Requested resource doesn't exist</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Resource not found\"\n}\n</code></pre> <p>Common causes: - Invalid user ID - Invalid 2FA method ID - Invalid device ID - Invalid API key ID</p> <p>How to fix: - Verify resource ID is correct - Check if resource was deleted - List available resources first</p>"},{"location":"reference/error-codes/#server-errors","title":"Server Errors","text":""},{"location":"reference/error-codes/#500-internal-server-error","title":"500: Internal Server Error","text":"<p>When: Unexpected server error</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Internal server error\"\n}\n</code></pre> <p>What to do: - Retry request (may be temporary) - Check service status - Contact support if persists - Check logs if self-hosted</p>"},{"location":"reference/error-codes/#503-service-unavailable","title":"503: Service Unavailable","text":"<p>When: Service is down or unhealthy</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Service unavailable\"\n}\n</code></pre> <p>Common causes: - Database connection lost - Redis connection lost - Service restarting - Maintenance mode</p> <p>What to do: - Retry with exponential backoff - Check health endpoint: <code>GET /api/health</code> - Check service status page - Wait for service to recover</p>"},{"location":"reference/error-codes/#webhook-errors","title":"Webhook Errors","text":""},{"location":"reference/error-codes/#400-invalid-webhook-signature","title":"400: Invalid Webhook Signature","text":"<p>When: HMAC signature verification failed</p> <pre><code>{\n  \"success\": false,\n  \"error\": \"Invalid webhook signature\"\n}\n</code></pre> <p>How to fix: - Verify signature using webhook secret - Check HMAC calculation - Ensure using correct secret</p> <p>Signature verification:</p> <pre><code>import crypto from 'crypto'\n\nfunction verifyWebhook(payload: string, signature: string, secret: string): boolean {\n  const expected = crypto\n    .createHmac('sha256', secret)\n    .update(payload)\n    .digest('hex')\n\n  return crypto.timingSafeEqual(\n    Buffer.from(signature.replace('sha256=', '')),\n    Buffer.from(expected)\n  )\n}\n</code></pre>"},{"location":"reference/error-codes/#error-handling-best-practices","title":"Error Handling Best Practices","text":""},{"location":"reference/error-codes/#client-side","title":"Client-Side","text":"<pre><code>async function handleApiCall() {\n  try {\n    const response = await api.post('/endpoint', data)\n    return response.data\n  } catch (error) {\n    if (axios.isAxiosError(error)) {\n      const status = error.response?.status\n      const message = error.response?.data?.error\n\n      switch (status) {\n        case 400:\n          // Validation error - show to user\n          showError(message)\n          break\n\n        case 401:\n          // Unauthorized - try refresh or logout\n          await handleUnauthorized()\n          break\n\n        case 429:\n          // Rate limited - show retry timer\n          showRateLimitError(error.response.headers)\n          break\n\n        case 500:\n        case 503:\n          // Server error - retry with backoff\n          return retryWithBackoff(handleApiCall)\n\n        default:\n          showError('An error occurred. Please try again.')\n      }\n    }\n\n    throw error\n  }\n}\n</code></pre>"},{"location":"reference/error-codes/#retry-logic","title":"Retry Logic","text":"<pre><code>async function retryWithBackoff&lt;T&gt;(\n  fn: () =&gt; Promise&lt;T&gt;,\n  maxRetries: number = 3,\n  baseDelay: number = 1000\n): Promise&lt;T&gt; {\n  for (let i = 0; i &lt; maxRetries; i++) {\n    try {\n      return await fn()\n    } catch (error) {\n      if (i === maxRetries - 1) throw error\n\n      const delay = baseDelay * Math.pow(2, i)\n      await new Promise(resolve =&gt; setTimeout(resolve, delay))\n    }\n  }\n\n  throw new Error('Max retries exceeded')\n}\n</code></pre>"},{"location":"reference/error-codes/#user-friendly-messages","title":"User-Friendly Messages","text":"<pre><code>const errorMessages: Record&lt;string, string&gt; = {\n  'Invalid email or password': 'The email or password you entered is incorrect. Please try again.',\n  'Email already registered': 'An account with this email already exists. Try logging in instead.',\n  'Too many requests': 'Too many attempts. Please wait a moment and try again.',\n  'Invalid verification code': 'The code you entered is incorrect or expired. Please try again.',\n  'Service unavailable': 'Our service is temporarily unavailable. Please try again in a few moments.'\n}\n\nfunction getUserFriendlyError(error: string): string {\n  return errorMessages[error] || 'An unexpected error occurred. Please try again.'\n}\n</code></pre>"},{"location":"reference/error-codes/#rate-limit-reference","title":"Rate Limit Reference","text":"Endpoint Limit Window Identifier <code>/auth/register</code> 5 15 min IP <code>/auth/login</code> 5 15 min IP <code>/auth/refresh</code> 10 15 min User ID <code>/2fa/verify</code> 10 15 min IP <code>/2fa/send-code</code> (SMS) 5 1 hour User ID <code>/2fa/send-code</code> (Email) 10 1 hour User ID <code>/2fa/*/setup</code> 10 15 min User ID Default 100 15 min IP"},{"location":"reference/error-codes/#debugging-tips","title":"Debugging Tips","text":""},{"location":"reference/error-codes/#check-request-format","title":"Check Request Format","text":"<pre><code># Verify your request is correctly formatted\ncurl -v -X POST https://your-api.com/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"user@example.com\",\"password\":\"SecureP@ssw0rd123!\"}'\n</code></pre>"},{"location":"reference/error-codes/#check-token","title":"Check Token","text":"<pre><code># Decode JWT token (don't use in production!)\nnode -e \"console.log(JSON.parse(Buffer.from('YOUR_TOKEN'.split('.')[1], 'base64').toString()))\"\n</code></pre>"},{"location":"reference/error-codes/#check-health","title":"Check Health","text":"<pre><code># Verify service is healthy\ncurl https://your-api.com/api/health\n\n# Response should be:\n# {\"status\":\"healthy\",\"checks\":{\"database\":\"up\",\"redis\":\"up\"}}\n</code></pre>"},{"location":"reference/error-codes/#support","title":"Support","text":"<p>If you encounter an error not documented here:</p> <ol> <li>Check server logs (if self-hosted)</li> <li>Search GitHub Issues</li> <li>Create new issue with:</li> <li>Error message</li> <li>Steps to reproduce</li> <li>Expected vs actual behavior</li> <li>Request/response details (remove sensitive data!)</li> </ol>"},{"location":"reference/error-codes/#next-steps","title":"Next Steps","text":"<ul> <li>API Reference - Complete API documentation</li> <li>Integration Guide - Integration examples</li> <li>Troubleshooting - Common issues</li> </ul>"}]}